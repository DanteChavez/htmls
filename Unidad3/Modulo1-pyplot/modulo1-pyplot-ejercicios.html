<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicios: Elige el gráfico adecuado con pyplot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.6/Sortable.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'surface-main': '#ffffff',
                        'surface-muted': '#f1f5f9',
                        'brand-primary': '#003c58',
                        'brand-accent': '#06717e',
                        'action-default': '#0055ad',
                        'action-hover': '#399be2',
                        'surface-dark': '#0f6cbf',
                        'text-sky': '#6ea2ee',
                        'text-muted': '#6da8e9',
                        'text-deep': '#1e293b',
                        'border-light': '#e2e8f0',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #ffffff;
            color: #1e293b;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden;
        }

        .slide {
            display: none;
        }

        .slide.active {
            display: flex;
        }

        .sortable-ghost {
            opacity: 0.4;
            background-color: #e2e8f0 !important;
        }

        .sortable-drag {
            cursor: grabbing !important;
        }

        .tarjeta {
            cursor: grab;
        }

        .tarjeta:active {
            cursor: grabbing;
        }

        .macos-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }

        .macos-close {
            background-color: #ff5f56;
        }

        .macos-min {
            background-color: #ffbd2e;
        }

        .macos-max {
            background-color: #27c93f;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dropzone {
            min-height: 120px;
            transition: background-color 0.2s;
        }
    </style>
</head>

<body class="bg-surface-main text-text-deep h-screen w-screen relative">

    <main id="app" class="flex flex-col h-full w-full relative">

        <!-- Slides Content -->
        <div id="slides-wrapper" class="flex-grow relative overflow-hidden">

            <!-- Slide 1: Portada -->
            <section id="slide-1"
                class="slide active absolute inset-0 flex-col items-center justify-center p-8 text-center bg-surface-main overflow-y-auto custom-scrollbar">
                <div
                    class="text-action-default font-bold tracking-wider mb-3 text-lg uppercase flex items-center gap-2 justify-center">
                    <span class="w-8 h-0.5 bg-action-default opacity-50 block"></span>
                    Unidad 3
                    <span class="w-8 h-0.5 bg-action-default opacity-50 block"></span>
                </div>
                <h1
                    class="text-4xl md:text-5xl font-extrabold text-brand-primary mb-6 drop-shadow-sm leading-tight max-w-5xl">
                    Módulo 01: pyplot ejercicios
                </h1>
                <p class="text-xl md:text-2xl text-text-deep mb-4 max-w-4xl leading-relaxed">Practica distinguiendo qué
                    tipo de gráfico usar según el problema y los datos (plot, bar, scatter, step).</p>
                <div
                    class="bg-surface-muted border border-border-light rounded-2xl p-6 md:p-8 max-w-2xl mt-8 mb-12 shadow-sm">
                    <p class="text-lg text-text-deep mb-3 font-medium">Instrucciones de la actividad:</p>
                    <ol class="text-left py-2 px-4 list-decimal list-inside space-y-3 text-text-deep text-lg">
                        <li><strong>Arrastra</strong> cada tarjeta al contenedor que le corresponda.</li>
                        <li>Haz <strong>click sobre una tarjeta</strong> en cualquier momento para expandir su
                            descripción y ver un ejemplo simplificado de las variables <code>x</code> e <code>y</code>
                            asociadas.</li>
                        <li>Haz click en <strong>Verificar Tarjetas</strong> cuando quieras corroborar tus respuestas.
                        </li>
                    </ol>
                </div>
                <button onclick="nextSlide()"
                    class="px-10 py-5 bg-action-default hover:bg-action-hover text-white text-xl rounded-xl shadow-md font-bold transition-all transform hover:scale-105"
                    aria-label="Comenzar">Comenzar Ejercicios</button>
            </section>

            <!-- Slides 2, 3, 4 se insertarán aquí dinámicamente -->

            <!-- Slide 5: Cierre -->
            <section id="slide-5"
                class="slide absolute inset-0 flex-col items-center justify-center p-8 text-center bg-surface-main overflow-y-auto custom-scrollbar">

                <div class="max-w-3xl w-full flex flex-col items-center z-10 mb-16">
                    <div
                        class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-8 text-green-600 shadow-inner">
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>

                    <h1 class="text-3xl md:text-5xl font-extrabold text-brand-primary mb-6 tracking-tight">¡Módulo
                        Completado!</h1>
                    <p class="text-xl md:text-2xl text-text-deep mb-12 leading-relaxed font-medium">Has practicado con
                        éxito la
                        selección del gráfico adecuado según la estructura subyacente de los datos y el objetivo del
                        problema.</p>

                    <button onclick="reiniciarModulo()"
                        class="px-10 py-4 bg-text-deep hover:bg-black text-white text-lg rounded-xl shadow-md font-bold transition-transform transform hover:scale-105 flex items-center gap-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        Reiniciar Módulo
                    </button>
                </div>

                <!-- Footer Institucional de Módulo -->
                <div
                    class="absolute bottom-0 w-full px-6 py-5 md:px-10 md:py-8 flex flex-col md:flex-row justify-between items-end bg-surface-muted border-t border-border-light text-sm text-text-muted font-medium z-0">
                    <div class="text-left w-full md:w-auto mb-4 md:mb-0">
                        <p class="font-bold text-brand-primary text-base mb-0.5 tracking-tight">Universidad de
                            Valparaíso</p>
                        <p>Escuela de Ingeniería Civil</p>
                    </div>
                    <div class="text-left md:text-right w-full md:w-auto">
                        <p class="text-text-deep mb-0.5 font-bold tracking-tight">Programación 1 | PRO121</p>
                        <p class="mt-1">Unidad 3: ejercicios pyplot (Finalizado)</p>
                    </div>
                </div>

        </div>

        </section>

        </div>

    </main>

    <script>
        // Data and State
        let currentSlide = 1;
        const totalSlides = 5;

        const ejercicios = {
            lvl1: [
                {
                    id: '1-1',
                    title: 'Tendencia de temperatura diaria',
                    desc: 'Monitoreo de temperatura en una ciudad durante 31 días consecutivos. Se busca observar la evolución temporal continua.',
                    data_x: "[1, 2, 3, 4, ...]",
                    data_y: "[22.5, 23.1, 21.8, 24.0, ...]",
                    correct: 'plot',
                    failMsg: 'Fíjate en los datos: representan una secuencia ininterrumpida en el tiempo. ¿Qué gráfico es el estándar para unir estos puntos y revelar la tendencia?'
                },
                {
                    id: '1-2',
                    title: 'Ventas por producto',
                    desc: 'Comparativa de ventas totales acumuladas de 6 productos diferentes en un trimestre. Queremos comparar magnitudes independientes.',
                    data_x: "['Laptop', 'Mouse', 'Teclado', 'Monitor', ...]",
                    data_y: "[150, 320, 120, 85, ...]",
                    correct: 'bar',
                    failMsg: 'Observa el eje X. Son categorías de texto (nombres), no una secuencia numérica. ¿Cuál es la mejor forma de comparar el tamaño o volumen de grupos separados?'
                },
                {
                    id: '1-3',
                    title: 'Evolución del precio del dólar',
                    desc: 'Valor oficial del dólar día a día durante el año. Se busca ver las fluctuaciones uniendo los puntos.',
                    data_x: "['01-Ene', '02-Ene', '03-Ene', '04-Ene', ...]",
                    data_y: "[850.5, 852.1, 849.0, 855.3, ...]",
                    correct: 'plot',
                    failMsg: 'Esta es una serie de tiempo clásica. Para apreciar cómo sube y baja un valor día a día, necesitamos un gráfico que trace un camino continuo.'
                },
                {
                    id: '1-4',
                    title: 'Puntaje promedio por sección',
                    desc: 'Rendimiento en una prueba estandarizada de 4 secciones independientes (A, B, C y D) de un mismo nivel. Se comparan grupos.',
                    data_x: "['Sección A', 'Sección B', 'Sección C', 'Sección D']",
                    data_y: "[85, 92, 78, 88]",
                    correct: 'bar',
                    failMsg: 'Cada sección es un grupo discreto que no tiene relación secuencial con el siguiente. Piensa en cómo se visualizan mejor las cantidades por categoría.'
                },
                {
                    id: '1-5',
                    title: 'Crecimiento de una planta',
                    desc: 'Altura de un brote medida cada fin de semana durante 2 meses para registrar su desarrollo como progreso continuo.',
                    data_x: "['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', ...]",
                    data_y: "[2.1, 4.5, 7.8, 12.0, ...]",
                    correct: 'plot',
                    failMsg: 'El crecimiento es un proceso que no se detiene. ¿Qué herramienta visual te permite mostrar esa continuidad temporal?'
                }
            ],
            lvl2: [
                {
                    id: '2-1',
                    title: 'Horas de estudio vs Notas',
                    desc: 'Analizar la posible correlación y dispersión entre cuánto estudia cada alumno y la nota final que obtuvo, sin agrupar.',
                    data_x: "[2.5, 4.0, 1.5, 6.0, ...]",
                    data_y: "[4.5, 6.0, 3.2, 7.0, ...]",
                    correct: 'scatter',
                    failMsg: 'Buscamos ver si existe un patrón o relación entre dos variables numéricas independientes para muchos individuos. ¿Qué gráfico dibuja puntos libres en el plano?'
                },
                {
                    id: '2-2',
                    title: 'Cantidad de matriculados por carrera',
                    desc: 'Comparación del total de alumnos inscritos en las diferentes carreras de una facultad.',
                    data_x: "['Medicina', 'Ingeniería', 'Leyes', 'Arte', ...]",
                    data_y: "[450, 600, 320, 150, ...]",
                    correct: 'bar',
                    failMsg: 'Las carreras son categorías distintas y queremos comparar el tamaño de cada grupo. Una línea sugeriría continuidad temporal entre carreras, lo cual es incorrecto.'
                },
                {
                    id: '2-3',
                    title: 'Nivel de stock en bodega',
                    desc: 'Inventario de una pieza que se mantiene constante durante el tiempo hasta que ocurre un consumo, cayendo abruptamente.',
                    data_x: "[1, 2, 3, 4, 5, ...]",
                    data_y: "[100, 100, 85, 85, 50, ...]",
                    correct: 'step',
                    failMsg: 'Piensa en cómo cambia el stock: no disminuye poco a poco de forma diagonal y fluida, sino que se mantiene plano y da "saltos" cuando alguien saca materiales.'
                },
                {
                    id: '2-4',
                    title: 'Rendimiento de 5 modelos de IA',
                    desc: 'Tasa de éxito (Accuracy) comparativa para evaluar cuál de los algoritmos A, B, C, D o E es mejor en un mismo problema.',
                    data_x: "['Modelo A', 'Modelo B', 'Modelo C', 'Modelo D', 'Modelo E']",
                    data_y: "[85.2, 91.4, 78.9, 88.1, 95.0]",
                    correct: 'bar',
                    failMsg: 'Estamos comparando el desempeño final de entidades separadas. Al igual que con las ventas por producto, necesitamos visualizar magnitudes independientes.'
                },
                {
                    id: '2-5',
                    title: 'Ganancias mensuales esperadas vs reales',
                    desc: 'Evolución cronológica del dinero a lo largo del año calendario actual para ver la curva de crecimiento.',
                    data_x: "['Ene', 'Feb', 'Mar', 'Abr', ...]",
                    data_y: "[1.2, 1.5, 1.4, 1.8, ...]",
                    correct: 'plot',
                    failMsg: 'El tiempo avanza mes a mes formando una secuencia ininterrumpida. Queremos ver la "ruta" o el camino que trazaron las ganancias.'
                },
                {
                    id: '2-6',
                    title: 'Edad vs Frecuencia Cardíaca',
                    desc: 'Mediciones tomadas a 100 personas distintas para descubrir si las edades y las pulsaciones se agrupan formando algún patrón biológico.',
                    data_x: "[25, 42, 18, 65, 30, ...]",
                    data_y: "[75, 82, 68, 90, 72, ...]",
                    correct: 'scatter',
                    failMsg: 'Tenemos pares de datos numéricos de personas aleatorias, sin un orden temporal. Queremos ver dónde se ubica y concentra cada individuo en el gráfico.'
                }
            ],
            lvl3: [
                {
                    id: '3-1',
                    title: 'Producción anual de Cobre',
                    desc: 'Reporte ejecutivo para premiar el mejor año de la década en la mina. Requiere contrastar el volumen total extraído en cada año de forma aislada para ver rápidamente al ganador.',
                    data_x: "[2015, 2016, 2017, 2018, ...]",
                    data_y: "[1.2, 1.1, 1.5, 1.4, ...]",
                    correct: 'bar',
                    failMsg: '¡Cuidado con la trampa! Aunque el eje X tiene años, el objetivo del negocio no es ver la tendencia continua, sino aislar cada año como un "bloque" independiente para premiar un volumen total.'
                },
                {
                    id: '3-2',
                    title: 'Tarifa de estacionamiento',
                    desc: 'Sistema de cobro automático. La tarifa aumenta $1000 al cumplirse cada bloque exacto de 60 minutos, sin cobros proporcionales intermedios.',
                    data_x: "[15, 45, 60, 61, 110, 120, 121, ...]",
                    data_y: "[1000, 1000, 1000, 2000, 2000, 2000, 3000, ...]",
                    correct: 'step',
                    failMsg: 'El costo no sube diagonalmente minuto a minuto. Analiza cómo el precio se congela y luego cambia drásticamente al cruzar el límite de la hora.'
                },
                {
                    id: '3-3',
                    title: 'Onda sonora de motor industrial',
                    desc: 'Registro de la vibración mecánica de una turbina muestreada cada milisegundo para análisis de frecuencias.',
                    data_x: "[1, 2, 3, 4, 5, ...]",
                    data_y: "[0.1, 0.8, -0.4, -0.9, 0.2, ...]",
                    correct: 'plot',
                    failMsg: 'Hablamos de una señal analógica digitalizada de alta frecuencia. Los datos describen la forma física ininterrumpida de una onda.'
                },
                {
                    id: '3-4',
                    title: 'Mapa de eventos microsísmicos',
                    desc: 'Coordenadas topográficas (Este y Norte) donde se han detectado liberaciones de energía subterránea durante el último mes.',
                    data_x: "[450200, 450250, 450180, ...]",
                    data_y: "[6350100, 6350150, 6350120, ...]",
                    correct: 'scatter',
                    failMsg: 'Las variables son coordenadas espaciales. Unir los puntos con una línea crearía un garabato sin sentido, necesitamos posicionar cada evento libremente en el plano.'
                },
                {
                    id: '3-5',
                    title: 'Bugs fatales en Microservicios',
                    desc: 'Auditoría del sistema del mes pasado. Total de caídas detectadas en el Backend, Auth, DB, Frontend y Queue.',
                    data_x: "['Backend', 'Auth', 'DB', 'Frontend', 'Queue']",
                    data_y: "[12, 3, 0, 5, 2]",
                    correct: 'bar',
                    failMsg: 'Analiza los elementos del eje X. No tienen relación temporal ni espacial entre ellos, son subsistemas distintos.'
                },
                {
                    id: '3-6',
                    title: 'Métricas biométricas en atletas',
                    desc: 'Cruce de mediciones de peso y altura tomadas a 200 competidores olímpicos en la fase de clasificación.',
                    data_x: "[70.5, 82.1, 65.3, 90.0, ...]",
                    data_y: "[175, 188, 160, 195, ...]",
                    correct: 'scatter',
                    failMsg: 'Considera que los datos de un atleta no dependen del anterior ni del siguiente. Estamos buscando cómo se distribuye una población respecto a dos variables continuas.'
                },
                {
                    id: '3-7',
                    title: 'Señales lógicas de control',
                    desc: 'Monitoreo de un bus de datos digital donde el voltaje alterna instantáneamente entre nivel bajo (0V) y alto (5V) según el reloj.',
                    data_x: "[10, 20, 30, 40, 50, ...]",
                    data_y: "[0, 5, 5, 0, 5, ...]",
                    correct: 'step',
                    failMsg: 'En electrónica digital las transiciones son (teóricamente) instantáneas, no hay voltajes intermedios válidos. Se requiere representar estados retenidos y cambios abruptos.'
                }
            ]
        };

        const slidesData = [
            { nivel: 1, id: 'lvl1', titulo: 'Ejercicios: Nivel Fácil' },
            { nivel: 2, id: 'lvl2', titulo: 'Ejercicios: Nivel Medio' },
            { nivel: 3, id: 'lvl3', titulo: 'Ejercicios: Nivel Difícil' }
        ];

        // Generator functions
        function generarHTMLNiveles() {
            const slide5 = document.getElementById('slide-5');

            slidesData.forEach((sd, index) => {
                const slideIndex = index + 2;
                const html = `
                <section id="slide-${slideIndex}" class="slide absolute inset-0 flex-col pt-6 px-4 md:px-8 bg-surface-main pb-[110px] overflow-hidden">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4 flex-shrink-0">
                        <h2 class="text-3xl lg:text-4xl font-extrabold text-brand-primary drop-shadow-sm">${sd.titulo}</h2>
                        <button onclick="verificarNivel('${sd.nivel}', '${sd.id}')" class="px-8 py-3 bg-text-deep text-white rounded-xl hover:bg-black font-semibold shadow-md transition-transform transform hover:-translate-y-0.5 focus:ring-4 focus:ring-gray-300">Verificar Resultados</button>
                    </div>
                    
                    <div class="flex flex-col lg:flex-row gap-6 flex-grow min-h-0 overflow-hidden">
                        
                        <!-- Panel Izquierdo: Pool -->
                        <div class="lg:w-1/3 flex flex-col bg-surface-muted border border-border-light rounded-xl shadow-sm overflow-hidden min-h-[220px] lg:min-h-0 flex-shrink-0 lg:flex-shrink">
                            <div class="p-3 bg-white border-b border-border-light shadow-sm z-10 font-bold text-text-deep text-lg flex items-center justify-between gap-2">
                                <div class="flex items-center gap-2">
                                    <svg class="w-5 h-5 text-action-default" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 002-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                                    Arrastra las tarjetas:
                                </div>
                                <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded-full px-2" id="badge-${sd.id}">${ejercicios[sd.id].length}</span>
                            </div>
                            <div id="pool-${sd.id}" class="flex-grow p-3 sm:p-4 overflow-y-auto overflow-x-hidden space-y-3 sortable-list custom-scrollbar bg-[#f8fafc]"></div>
                        </div>
                        
                        <!-- Panel Derecho: Dropzones -->
                        <div class="lg:w-2/3 flex flex-col gap-4 overflow-y-auto overflow-x-hidden custom-scrollbar pr-1 lg:pr-3 lg:h-full pb-4 relative">
                            
                            <!-- Floating Feedback Modal -->
                            <div id="feedback-${sd.id}" class="hidden fixed top-8 left-1/2 -translate-x-1/2 w-[90%] md:w-auto max-w-2xl z-[100] rounded-xl p-5 shadow-2xl border-2 transition-all duration-300 transform -translate-y-8 opacity-0" role="alert" aria-live="polite">
                                <div class="flex justify-between items-start gap-4 mb-2">
                                    <div id="feedback-${sd.id}-content" class="w-full"></div>
                                    <button onclick="closeFeedback('${sd.id}')" class="text-gray-400 hover:text-gray-700 transition-colors bg-white rounded-full p-1 shadow-sm border border-gray-100 flex-shrink-0" aria-label="Cerrar mensaje">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow min-h-0">
                                <!-- Plot -->
                                <div class="flex flex-col bg-surface-muted border-2 border-brand-primary rounded-xl overflow-hidden shadow-sm lg:h-full">
                                    <div class="bg-brand-primary text-white font-bold py-2.5 px-4 text-center tracking-wider flex justify-center items-center gap-2 text-[15px] z-10 shadow-sm">
                                        <svg class="w-5 h-5 opacity-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                                        plot <span class="font-normal opacity-80">(líneas)</span>
                                    </div>
                                    <div id="${sd.id}-plot" class="flex-grow p-3 space-y-3 sortable-list dropzone bg-white/60 custom-scrollbar" data-tipo="plot"></div>
                                </div>
                                
                                <!-- Bar -->
                                <div class="flex flex-col bg-surface-muted border-2 border-brand-accent rounded-xl overflow-hidden shadow-sm lg:h-full">
                                    <div class="bg-brand-accent text-white font-bold py-2.5 px-4 text-center tracking-wider flex justify-center items-center gap-2 text-[15px] z-10 shadow-sm">
                                        <svg class="w-5 h-5 opacity-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                        bar <span class="font-normal opacity-80">(barras)</span>
                                    </div>
                                    <div id="${sd.id}-bar" class="flex-grow p-3 space-y-3 sortable-list dropzone bg-white/60 custom-scrollbar" data-tipo="bar"></div>
                                </div>
                                
                                <!-- Scatter -->
                                <div class="flex flex-col bg-surface-muted border-2 border-action-default rounded-xl overflow-hidden shadow-sm lg:h-full">
                                    <div class="bg-action-default text-white font-bold py-2.5 px-4 text-center tracking-wider flex justify-center items-center gap-2 text-[15px] z-10 shadow-sm">
                                        <svg class="w-5 h-5 opacity-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"></path></svg>
                                        scatter <span class="font-normal opacity-80" style="letter-spacing: -0.01em;">(dispersión)</span>
                                    </div>
                                    <div id="${sd.id}-scatter" class="flex-grow p-3 space-y-3 sortable-list dropzone bg-white/60 custom-scrollbar" data-tipo="scatter"></div>
                                </div>
                                
                                <!-- Step -->
                                <div class="flex flex-col bg-surface-muted border-2 border-action-hover rounded-xl overflow-hidden shadow-sm lg:h-full">
                                    <div class="bg-action-hover text-white font-bold py-2.5 px-4 text-center tracking-wider flex justify-center items-center gap-2 text-[15px] z-10 shadow-sm">
                                        <svg class="w-5 h-5 opacity-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                                        step <span class="font-normal opacity-80">(escalera)</span>
                                    </div>
                                    <div id="${sd.id}-step" class="flex-grow p-3 space-y-3 sortable-list dropzone bg-white/60 custom-scrollbar" data-tipo="step"></div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </section>
                `;
                slide5.insertAdjacentHTML('beforebegin', html);
            });
        }

        function createCard(item, dataKey) {
            return `
                <div class="tarjeta relative bg-white border border-border-light rounded-lg shadow-sm cursor-move select-none transition-all hover:border-brand-accent focus:outline-none focus:ring-2 focus:ring-brand-accent group" data-id="${item.id}" data-correct="${item.correct}" tabindex="0" role="button" aria-expanded="false" title="Arrastra esta tarjeta o haz click para ver detalles">
                    <div class="p-3.5 font-bold text-text-deep pointer-events-none pr-10 text-[15px] leading-tight">
                        ${item.title}
                    </div>
                    <!-- Toggle icon -->
                    <div class="absolute right-3.5 top-3.5 text-text-muted transition-transform duration-300 pointer-events-none toggle-icon group-hover:text-action-default group-hover:scale-110">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    
                    <div class="hidden overflow-hidden transition-all duration-300 card-details border-t border-border-light bg-[#f8fafc]">
                        <div class="p-3.5">
                            <p class="mb-3 text-[14px] text-text-deep leading-snug">${item.desc}</p>
                            
                            <!-- VScode Light+ / Mac Console estilo minimamente integrado -->
                            <div class="bg-[#ffffff] border border-[#e2e8f0] rounded-lg overflow-hidden shadow-sm shadow-inner transition-colors">
                                <div class="bg-[#f1f5f9] border-b border-[#e2e8f0] px-3 py-1.5 flex items-center h-7 gap-2">
                                    <div class="flex gap-1.5 opacity-80">
                                        <span class="macos-btn macos-close m-0"></span>
                                        <span class="macos-btn macos-min m-0"></span>
                                        <span class="macos-btn macos-max m-0"></span>
                                    </div>
                                    <span class="ml-1 text-[11px] text-gray-500 font-sans tracking-tight font-medium opacity-90">datos.py</span>
                                </div>
                                <div class="p-2.5 font-mono text-sm tracking-tight space-y-1">
                                    <div><span class="text-[#0000ff]">x</span> <span class="text-gray-500">=</span> <span class="text-[#098658]">${item.data_x || '\'' + item.x + '\''}</span></div>
                                    <div><span class="text-[#0000ff]">y</span> <span class="text-gray-500">=</span> <span class="text-[#098658]">${item.data_y || '\'' + item.y + '\''}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function poblarTarjetas() {
            slidesData.forEach(sd => {
                const pool = document.getElementById(`pool-${sd.id}`);
                ejercicios[sd.id].forEach(item => {
                    pool.insertAdjacentHTML('beforeend', createCard(item, sd.id));
                });
            });
        }

        // Behavior Handlers
        function setupHandlers() {
            // Expand card details on click
            document.addEventListener('click', (e) => {
                const tarjeta = e.target.closest('.tarjeta');
                if (tarjeta) {
                    // Do not expand if card is inside a dropzone
                    if (tarjeta.closest('.dropzone')) return;

                    const details = tarjeta.querySelector('.card-details');
                    const icon = tarjeta.querySelector('.toggle-icon');
                    if (details) {
                        const isHidden = details.classList.contains('hidden');
                        if (isHidden) {
                            details.classList.remove('hidden');
                            icon.classList.add('rotate-180');
                            tarjeta.setAttribute('aria-expanded', 'true');
                        } else {
                            details.classList.add('hidden');
                            icon.classList.remove('rotate-180');
                            tarjeta.setAttribute('aria-expanded', 'false');
                        }
                    }
                }
            });

            // Init Sortables
            slidesData.forEach(sd => {
                const containers = [
                    document.getElementById(`pool-${sd.id}`),
                    document.getElementById(`${sd.id}-plot`),
                    document.getElementById(`${sd.id}-bar`),
                    document.getElementById(`${sd.id}-scatter`),
                    document.getElementById(`${sd.id}-step`)
                ];

                containers.forEach(container => {
                    if (container) {
                        new Sortable(container, {
                            group: `ejercicios-${sd.id}`,
                            animation: 150,
                            ghostClass: 'sortable-ghost',
                            easing: "cubic-bezier(1, 0, 0, 1)",
                            delay: window.innerWidth < 1024 ? 120 : 0,
                            delayOnTouchOnly: true,
                            onStart: function (evt) {
                                // Close card if dragged
                                const details = evt.item.querySelector('.card-details');
                                const icon = evt.item.querySelector('.toggle-icon');
                                if (details && !details.classList.contains('hidden')) {
                                    details.classList.add('hidden');
                                    icon.classList.remove('rotate-180');
                                    evt.item.setAttribute('aria-expanded', 'false');
                                }
                                document.body.style.cursor = 'grabbing';
                            },
                            onEnd: function () {
                                document.body.style.cursor = 'default';
                                updateCountBadge(sd.id);
                            }
                        });
                    }
                });
            });
        }

        function updateCountBadge(levelId) {
            const badge = document.getElementById(`badge-${levelId}`);
            if (badge) {
                const poolCount = document.getElementById(`pool-${levelId}`).children.length;
                badge.innerText = poolCount;
                if (poolCount === 0) {
                    badge.classList.remove('bg-gray-200', 'text-gray-700');
                    badge.classList.add('bg-green-100', 'text-green-700');
                } else {
                    badge.classList.add('bg-gray-200', 'text-gray-700');
                    badge.classList.remove('bg-green-100', 'text-green-700');
                }
            }
        }

        function findItem(dataKey, id) {
            return ejercicios[dataKey].find(item => item.id === id);
        }

        function closeFeedback(levelId) {
            const feedbackDiv = document.getElementById(`feedback-${levelId}`);
            if (feedbackDiv) {
                feedbackDiv.classList.add('opacity-0', '-translate-y-8');
                setTimeout(() => {
                    feedbackDiv.classList.add('hidden');
                }, 300);
            }
        }

        // Logic
        function verificarNivel(nivelNum, levelId) {
            const pool = document.getElementById(`pool-${levelId}`);
            let errores = 0;
            const retroalimentacion = [];
            const types = ['plot', 'bar', 'scatter', 'step'];

            // Loop through containers and validate
            types.forEach(type => {
                const container = document.getElementById(`${levelId}-${type}`);
                const cards = Array.from(container.children);

                cards.forEach(card => {
                    if (card.dataset.correct !== type) {
                        pool.appendChild(card); // Move visual card to pool
                        errores++;
                        const item = findItem(levelId, card.dataset.id);
                        retroalimentacion.push(`<li class="mb-3 border-b border-gray-200 pb-2 last:border-0"><strong class="text-gray-800">${item.title}:</strong> ${item.failMsg}</li>`);
                    }
                });
            });

            // Trigger reflow for animations
            updateCountBadge(levelId);

            // Compose Feedback Message
            const feedbackDiv = document.getElementById(`feedback-${levelId}`);
            const feedbackContent = document.getElementById(`feedback-${levelId}-content`);

            feedbackDiv.classList.remove('hidden');

            // Force reflow for enter animation
            void feedbackDiv.offsetWidth;
            feedbackDiv.classList.remove('opacity-0', '-translate-y-8');

            // Reset colors
            feedbackDiv.className = feedbackDiv.className.replace(/\bbg-\w+-\d+\b/g, '')
                .replace(/\bborder-\w+-\d+\b/g, '')
                .replace(/\bsideboard-\w+-\d+\b/g, '');

            if (errores === 0 && pool.children.length === 0) {
                const btnText = levelId === 'lvl3' ? 'Ir al cierre' : 'Siguiente dificultad';
                feedbackDiv.classList.add('bg-white', 'border-green-500');
                feedbackContent.innerHTML = `
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6 w-full">
                        <div class="flex items-start gap-4">
                            <div class="bg-green-100 rounded-full p-2 flex-shrink-0 mt-1">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <div>
                                <p class="font-bold text-xl text-green-800 mb-1 tracking-tight">¡Misión Cumplida!</p>
                                <p class="text-gray-600 font-medium">Has clasificado todas las tarjetas correctamente en este nivel.</p>
                            </div>
                        </div>
                        <button onclick="nextSlide(); closeFeedback('${levelId}')" class="w-full sm:w-auto self-end sm:self-auto px-8 py-3 bg-action-default hover:bg-action-hover text-white text-lg font-bold rounded-xl shadow-md transition-all transform hover:scale-105 whitespace-nowrap">${btnText}</button>
                    </div>
                `;
            } else if (errores === 0 && pool.children.length > 0) {
                feedbackDiv.classList.add('bg-white', 'border-yellow-400');
                feedbackContent.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="bg-yellow-100 rounded-full p-2 flex-shrink-0 mt-1">
                            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                        </div>
                        <div>
                            <p class="font-bold text-xl text-yellow-800 mb-1 tracking-tight">Vas por buen camino</p>
                            <p class="text-gray-600 font-medium">La clasificación actual es correcta, pero aún te faltan <span class="font-bold text-gray-800 bg-gray-100 px-2 py-0.5 rounded">${pool.children.length}</span> tarjetas por colocar.</p>
                        </div>
                    </div>
                `;
            } else {
                feedbackDiv.classList.add('bg-white', 'border-red-500');
                feedbackContent.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="bg-red-100 rounded-full p-2 flex-shrink-0 mt-1">
                            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div class="w-full">
                            <p class="font-bold text-xl text-red-800 mb-2 tracking-tight">Oops! ${errores} tarjeta(s) en la categoría equivocada</p>
                            <p class="mb-4 font-medium text-gray-600">Las tarjetas incorrectas han vuelto al panel lateral. Revisa los siguientes consejos e inténtalo de nuevo:</p>
                            <ul class="list-none text-[14.5px] leading-snug bg-gray-50 p-4 border border-gray-100 rounded-lg shadow-inner max-h-[30vh] overflow-y-auto">${retroalimentacion.join('')}</ul>
                        </div>
                    </div>
                `;
            }
        }

        // Navigation Controller
        function switchSlide(targetIdx) {
            document.querySelectorAll('.slide').forEach((slide, index) => {
                if (index + 1 === targetIdx) {
                    slide.classList.add('active');
                    slide.classList.remove('hidden');
                } else {
                    slide.classList.remove('active');
                    slide.classList.add('hidden');
                }
            });
        }

        function nextSlide() {
            if (currentSlide < totalSlides) {
                currentSlide++;
                switchSlide(currentSlide);
            }
        }

        function reiniciarModulo() {
            // Reinicia todo localmente recargando la página, o simplemente volviendo a la slide 1
            location.reload();
        }

        // Debug helper in console
        window.finishModule = function () {
            currentSlide = totalSlides;
            switchSlide(currentSlide);
            console.log("Módulo finalizado vía consola. Mostrando diapositiva de cierre.");
        };

        // Initialize execution chain
        document.addEventListener('DOMContentLoaded', () => {
            generarHTMLNiveles();
            poblarTarjetas();
            setupHandlers();
        });
    </script>
</body>

</html>