<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 01: Gráficos Matemáticos con pyplot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        surface: { main: '#ffffff', muted: '#f1f5f9', dark: '#0f6cbf' },
                        brand: { primary: '#003c58', accent: '#06717e' },
                        action: { default: '#0055ad', hover: '#399be2' },
                        text: { sky: '#6ea2ee', muted: '#6da8e9', deep: '#1e293b' },
                        border: { light: '#e2e8f0' }
                    },
                    fontFamily: { mono: ['Courier New', 'Consolas', 'monospace'] }
                }
            }
        }
    </script>
    <style>
        .code-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .code-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .code-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #0055ad;
            cursor: pointer;
            margin-top: -6px;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
    </style>
</head>

<body class="bg-surface-main text-text-deep font-sans min-h-screen flex flex-col overflow-hidden">
    <main id="app" class="flex-grow flex flex-col relative h-screen">
        <div id="slide-container" class="flex-grow flex flex-col p-4 md:p-8 overflow-y-auto pb-20"></div>
        <footer
            class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur border-t border-border-light p-4 flex justify-between items-center z-50">
            <button id="prev-btn"
                class="px-4 py-2 bg-slate-200 text-slate-600 rounded hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed font-medium">&larr;
                Anterior</button>
            <span class="text-text-muted text-sm font-medium" id="slide-counter">Diapositiva 1 de 13</span>
            <button id="next-btn"
                class="px-4 py-2 bg-action-default text-white rounded hover:bg-action-hover disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-sm">Siguiente
                &rarr;</button>
        </footer>
    </main>
    <script>
        let currentSlide = 0;
        let chartInstance = null;
        let subChartInstances = [];

        const slides = [
            {
                id: 'intro', render: () => `
                <div class="flex flex-col items-center justify-center h-full text-center space-y-6">
                    <div class="w-24 h-24 bg-brand-primary/10 rounded-full flex items-center justify-center mb-4">
                        <svg class="w-12 h-12 text-brand-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold text-brand-primary">Módulo 01: Gráficos Matemáticos con pyplot</h1>
                    <h2 class="text-xl md:text-2xl text-brand-accent max-w-2xl">Introducción práctica a matplotlib.pyplot</h2>
                    <p class="text-text-deep/80 max-w-lg text-lg">Aprende a crear gráficos de líneas, barras, dispersión y más de forma interactiva.</p>
                    <button onclick="nextSlide()" class="mt-8 px-8 py-3 bg-action-default text-white rounded-lg hover:bg-action-hover shadow-lg font-semibold text-lg">Comenzar</button>
                </div>`
            },
            {
                id: 'what-is', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8">
                    <div class="md:w-1/2 space-y-6 flex flex-col justify-center text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">¿Qué es pyplot?</h2>
                        <div class="space-y-4">
                            <p class="text-lg leading-relaxed">
                                <code class="bg-gray-100 px-2 py-1 rounded text-brand-accent font-bold">pyplot</code> es un sub-módulo de <span class="font-bold">Matplotlib</span> diseñado para crear gráficos de forma secuencial.
                            </p>
                            <p class="text-lg leading-relaxed">
                                Funciona como una <strong>máquina de estados</strong>: cada comando sobre <code class="font-mono text-brand-primary">plt</code> modifica la figura actual agregando líneas, etiquetas o títulos.
                            </p>
                        </div>
                        
                        <div class="rounded-lg overflow-hidden border border-border-light shadow-sm bg-white font-mono text-sm mt-4">
                            <div class="bg-gray-100 px-4 py-2 flex gap-2 border-b border-gray-200">
                                <div class="w-3 h-3 rounded-full bg-red-400"></div>
                                <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                                <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            </div>
                            <div class="p-4 overflow-x-auto code-scroll">
                                <div class="text-gray-400 mb-1"># Importamos y definimos datos</div>
                                <div><span class="text-blue-600">import</span> matplotlib.pyplot <span class="text-blue-600">as</span> plt</div>
                                <div>datos = [10, 20, 15, 30, 25]</div>
                                <br>
                                <div class="text-gray-400 mb-1"># Trazamos y agregamos eje Y</div>
                                <div>plt.<span class="text-blue-600">plot</span>(datos)</div>
                                <div>plt.<span class="text-blue-600">ylabel</span>(<span class="text-green-600">'Valores'</span>)</div>
                                <div>plt.<span class="text-blue-600">show</span>()</div>
                            </div>
                        </div>
                    </div>
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-[350px] relative">
                            <canvas id="chart-basic"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-basic', {
                    type: 'line',
                    data: {
                        labels: [0, 1, 2, 3, 4],
                        datasets: [{
                            label: 'Datos Generales',
                            data: [10, 20, 15, 30, 25],
                            borderColor: '#0055ad',
                            backgroundColor: 'rgba(0, 85, 173, 0.1)',
                            borderWidth: 3,
                            pointRadius: 6,
                            pointBackgroundColor: '#0055ad',
                            tension: 0.2,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { display: true, title: { display: true, text: 'Valores', font: { size: 14, weight: 'bold' } }, grid: { color: '#e2e8f0' } },
                            x: { grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'workflow', render: () => `
                <div class="flex flex-col h-full space-y-8">
                    <div class="text-center space-y-2">
                        <h2 class="text-3xl font-bold text-brand-primary">El Ciclo de Vida de un Gráfico</h2>
                        <p class="text-lg text-text-deep/80">Crear una visualización en <code class="font-mono">pyplot</code> sigue siempre un orden lógico de 5 pasos.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 relative">
                        <!-- Step 1 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">1</div>
                            <h3 class="font-bold text-brand-primary">Importar</h3>
                            <p class="text-xs text-text-deep">Traer el submódulo <code class="text-brand-accent">plt</code>.</p>
                        </div>
                        <!-- Step 2 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">2</div>
                            <h3 class="font-bold text-brand-primary">Datos</h3>
                            <p class="text-xs text-text-deep">Definir listas para los ejes <code class="text-brand-accent">X</code> e <code class="text-brand-accent">Y</code>.</p>
                        </div>
                        <!-- Step 3 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">3</div>
                            <h3 class="font-bold text-brand-primary">Trazar</h3>
                            <p class="text-xs text-text-deep">Usar <code class="text-blue-600">.plot()</code> para cargar los datos.</p>
                        </div>
                        <!-- Step 4 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">4</div>
                            <h3 class="font-bold text-brand-primary">Configurar</h3>
                            <p class="text-xs text-text-deep">Añadir títulos, etiquetas y estilos.</p>
                        </div>
                        <!-- Step 5 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-accent text-white rounded-full flex items-center justify-center font-bold">5</div>
                            <h3 class="font-bold text-brand-primary">Mostrar</h3>
                            <p class="text-xs text-text-deep">Ejecutar <code class="text-blue-600">.show()</code> para ver el resultado.</p>
                        </div>
                        <!-- Connector line (desktop only) -->
                        <div class="hidden md:block absolute top-1/2 left-0 right-0 h-0.5 bg-border-light -translate-y-12 z-0"></div>
                    </div>

                    <div class="rounded-lg overflow-hidden border border-border-light shadow-md bg-white font-mono text-sm max-w-2xl mx-auto w-full">
                        <div class="bg-slate-800 px-4 py-2 flex gap-2">
                            <div class="w-3 h-3 rounded-full bg-red-400"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                            <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            <span class="text-slate-400 text-xs ml-2">script.py</span>
                        </div>
                        <div class="p-6 space-y-2 bg-slate-900 text-slate-300">
                            <div><span class="text-pink-400">import</span> matplotlib.pyplot <span class="text-pink-400">as</span> plt <span class="text-slate-500 italic ml-4"># 1. Importar</span></div>
                            <br>
                            <div>xParams = [<span class="text-purple-400">1, 2, 3</span>] <span class="text-slate-500 italic ml-4"># 2. Datos</span></div>
                            <div>yParams = [<span class="text-purple-400">10, 20, 15</span>]</div>
                            <br>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">plot</span>(xParams, yParams) <span class="text-slate-500 italic ml-4"># 3. Trazar</span></div>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">title</span>(<span class="text-green-400">'Mi Gráfico'</span>) <span class="text-slate-500 italic ml-4"># 4. Configurar</span></div>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">show</span>() <span class="text-slate-500 italic ml-4 text-brand-accent font-bold"># 5. Mostrar</span></div>
                        </div>
                    </div>
                </div>`
            },
            {
                id: 'data-input', render: () => `
                <div class="flex flex-col md:flex-row gap-6 min-h-0">
                    <div class="md:w-2/5 space-y-6 flex flex-col">
                        <h2 class="text-2xl font-bold text-brand-primary">Datos a graficar</h2>
                        <div class="space-y-3">
                            <p class="text-base leading-relaxed text-text-deep">
                                En <code class="bg-gray-100 px-1 rounded">pyplot</code>, los datos se pasan como listas o arreglos. El <strong>eje X</strong> suele representar categorías o tiempo, mientras que el <strong>eje Y</strong> contiene los valores numéricos correspondientes.
                            </p>
                            <div class="p-3 bg-amber-50 border-l-4 border-amber-400 rounded text-sm text-amber-800 italic">
                                <strong>Importante:</strong> Ambas listas deben tener exactamente la misma longitud.
                            </div>
                        </div>

                        <div class="space-y-4 bg-white p-4 rounded-lg border border-border-light shadow-sm">
                            <div>
                                <label class="flex justify-between text-sm font-semibold mb-1">
                                    <span>Eje X (Categorías)</span>
                                    <span id="size-x-container" class="text-xs transition-colors">Cant: <span id="size-x">5</span></span>
                                </label>
                                <input type="text" id="input-x" value="1, 2, 3, 4, 5" class="w-full p-2 border rounded font-mono text-sm focus:ring-2 focus:ring-action-default outline-none">
                            </div>
                            <div>
                                <label class="flex justify-between text-sm font-semibold mb-1">
                                    <span>Eje Y (Valores)</span>
                                    <span id="size-y-container" class="text-xs transition-colors">Cant: <span id="size-y">5</span></span>
                                </label>
                                <input type="text" id="input-y" value="2, 3, 5, 7, 11" class="w-full p-2 border rounded font-mono text-sm focus:ring-2 focus:ring-action-default outline-none">
                            </div>
                        </div>

                        <div class="rounded-lg overflow-hidden border border-border-light shadow-sm bg-white font-mono text-sm mt-auto">
                            <div class="bg-gray-100 px-4 py-2 flex gap-2 border-b border-gray-200">
                                <div class="w-3 h-3 rounded-full bg-red-400"></div>
                                <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                                <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            </div>
                            <div class="p-4 overflow-x-auto code-scroll">
                                <div>x = [<span id="code-x" class="text-purple-600 bg-yellow-50 px-1 rounded">1, 2, 3, 4, 5</span>]</div>
                                <div>y = [<span id="code-y" class="text-purple-600 bg-yellow-50 px-1 rounded">2, 3, 5, 7, 11</span>]</div>
                                <br>
                                <div>plt.<span class="text-blue-600">plot</span>(x, y)</div>
                                <div>plt.<span class="text-blue-600">show</span>()</div>
                            </div>
                        </div>
                    </div>
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-6 flex items-center justify-center min-h-[350px] relative self-start md:self-stretch">
                        <div class="w-full h-full relative">
                            <canvas id="chart-data"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const ctx = document.getElementById('chart-data').getContext('2d');
                    const updateData = () => {
                        const valX = document.getElementById('input-x').value.split(',').filter(s => s.trim() !== "").map(s => s.trim());
                        const valY = document.getElementById('input-y').value.split(',').filter(s => s.trim() !== "").map(s => parseFloat(s.trim()));

                        const lenX = valX.length;
                        const lenY = valY.length;

                        // UI Feedback
                        const szX = document.getElementById('size-x');
                        const szY = document.getElementById('size-y');
                        const contX = document.getElementById('size-x-container');
                        const contY = document.getElementById('size-y-container');

                        szX.textContent = lenX;
                        szY.textContent = lenY;

                        if (lenX !== lenY) {
                            contX.classList.add('text-red-500', 'font-bold');
                            contY.classList.add('text-red-500', 'font-bold');
                        } else {
                            contX.classList.remove('text-red-500', 'font-bold');
                            contY.classList.remove('text-red-500', 'font-bold');
                            contX.classList.add('text-text-muted');
                            contY.classList.add('text-text-muted');
                        }

                        // Update Code
                        document.getElementById('code-x').textContent = valX.join(', ');
                        document.getElementById('code-y').textContent = valY.filter(n => !isNaN(n)).join(', ');

                        if (lenX > 0 && lenY > 0 && lenX === lenY) {
                            if (chartInstance) {
                                chartInstance.data.labels = valX;
                                chartInstance.data.datasets[0].data = valY;
                                chartInstance.update('none');
                            } else {
                                initChart('chart-data', {
                                    type: 'line',
                                    data: {
                                        labels: valX,
                                        datasets: [{
                                            label: 'Valores',
                                            data: valY,
                                            borderColor: '#0055ad',
                                            borderWidth: 3,
                                            pointRadius: 5,
                                            tension: 0.1,
                                            fill: false
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: { legend: { display: false } },
                                        scales: {
                                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                                            x: { grid: { color: '#e2e8f0' } }
                                        }
                                    }
                                });
                            }
                        }
                    };
                    document.getElementById('input-x').addEventListener('input', updateData);
                    document.getElementById('input-y').addEventListener('input', updateData);
                    updateData();
                }
            },
            {
                id: 'plot-params', render: () => `
                <div class="flex flex-col md:flex-row gap-6 min-h-0">
                    <div class="md:w-2/5 space-y-4 flex flex-col">
                        <h2 class="text-2xl font-bold text-brand-primary">Personalización con .plot()</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed">
                            <p>
                                <strong class="text-brand-primary">Definición:</strong> Un <strong>gráfico de línea</strong> es una representación visual que conecta una serie de puntos de datos con una línea continua sobre un plano cartesiano de dos ejes.
                            </p>
                            <p>
                                La función <code class="bg-gray-100 px-1 rounded font-bold">plt.plot(x, y, ...)</code> es la encargada de dibujar estos puntos y líneas. Aunque permite una gran personalización, recuerde que <strong>solo las listas X e Y son obligatorias</strong>.
                            </p>
                            <ul class="space-y-1 text-xs bg-blue-50 p-3 rounded-lg border border-blue-100">
                                <li class="font-bold text-brand-primary mb-1">Parámetros Opcionales Comunes:</li>
                                <li><strong>marker:</strong> Forma del punto <span class="text-text-muted">(ej. 'o', 's')</span>.</li>
                                <li><strong>linestyle:</strong> Tipo de línea <span class="text-text-muted">(ej. '-', '--')</span>.</li>
                                <li><strong>color:</strong> Color del trazo.</li>
                                <li><strong>linewidth / markersize:</strong> Tamaño de línea y puntos.</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div><label class="text-xs font-semibold block mb-1">Color</label><select id="p-color" class="w-full border rounded text-sm p-1"><option value="#0055ad">blue</option><option value="#ef4444">red</option><option value="#22c55e">green</option><option value="#a855f7">purple</option></select></div>
                                <div><label class="text-xs font-semibold block mb-1">Marker</label><select id="p-marker" class="w-full border rounded text-sm p-1"><option value="circle">o (Círculo)</option><option value="rect">s (Cuadrado)</option><option value="triangle">^ (Triángulo)</option><option value="star">★ (Estrella)</option></select></div>
                            </div>
                            <div><label class="text-xs font-semibold block mb-1">Linestyle</label><select id="p-style" class="w-full border rounded text-sm p-1"><option value="solid">- (Sólido)</option><option value="dashed">-- (Dashed)</option><option value="dotted">: (Dotted)</option></select></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-xs font-semibold flex justify-between text-[10px]">Linewidth: <span id="v-lw">3</span></label><input type="range" id="p-lw" min="1" max="10" value="3" class="w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer"></div>
                                <div><label class="text-xs font-semibold flex justify-between text-[10px]">Markersize: <span id="v-ms">10</span></label><input type="range" id="p-ms" min="2" max="25" value="10" class="w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer"></div>
                            </div>
                        </div>

                        <div class="rounded-lg overflow-hidden border shadow-sm bg-white font-mono text-[11px] p-3 mt-auto">
                            <div class="leading-tight text-slate-700">
                                <span class="text-pink-600">import</span> matplotlib.pyplot <span class="text-pink-600">as</span> plt<br><br>
                                x = [1, 2, 3, 4, 5]<br>
                                y = [5, 15, 10, 25, 20]<br><br>
                                plt.<span class="text-blue-600 font-bold">plot</span>(x, y, <br>
                                &nbsp;&nbsp;color='<span id="c-color" class="text-green-600 font-bold">blue</span>', <br>
                                &nbsp;&nbsp;marker='<span id="c-marker" class="text-orange-600">o</span>', <br>
                                &nbsp;&nbsp;linestyle='<span id="c-style" class="text-orange-600">-</span>', <br>
                                &nbsp;&nbsp;linewidth =<span id="c-lw" class="text-purple-600">3</span>, markersize =<span id="c-ms" class="text-purple-600">10</span>)<br><br>
                                plt.<span class="text-blue-600 font-bold">show</span>()
                            </div>
                        </div>
                    </div>
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex items-center justify-center min-h-[300px] h-[300px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-params"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const update = () => {
                        const color = document.getElementById('p-color').value;
                        const marker = document.getElementById('p-marker').value;
                        const style = document.getElementById('p-style').value;
                        const lw = document.getElementById('p-lw').value;
                        const ms = document.getElementById('p-ms').value;

                        // UI Update
                        document.getElementById('v-lw').textContent = lw;
                        document.getElementById('v-ms').textContent = ms;
                        document.getElementById('c-lw').textContent = lw;
                        document.getElementById('c-ms').textContent = ms;

                        document.getElementById('c-color').textContent = document.getElementById('p-color').options[document.getElementById('p-color').selectedIndex].text;
                        document.getElementById('c-marker').textContent = marker === 'circle' ? 'o' : (marker === 'rect' ? 's' : (marker === 'triangle' ? '^' : '*'));
                        document.getElementById('c-style').textContent = style === 'solid' ? '-' : (style === 'dashed' ? '--' : ':');

                        const lDash = style === 'dashed' ? [10, 5] : (style === 'dotted' ? [2, 2] : []);

                        if (chartInstance) {
                            chartInstance.data.datasets[0].borderColor = color;
                            chartInstance.data.datasets[0].backgroundColor = color;
                            chartInstance.data.datasets[0].pointBackgroundColor = color;
                            chartInstance.data.datasets[0].pointBorderColor = color;
                            chartInstance.data.datasets[0].pointStyle = marker;
                            chartInstance.data.datasets[0].borderDash = lDash;
                            chartInstance.data.datasets[0].borderWidth = parseInt(lw);
                            chartInstance.data.datasets[0].pointRadius = parseInt(ms);
                            chartInstance.data.datasets[0].pointHoverRadius = parseInt(ms) + 2;
                            chartInstance.update();
                        } else {
                            initChart('chart-params', {
                                type: 'line',
                                data: {
                                    labels: [1, 2, 3, 4, 5],
                                    datasets: [{
                                        data: [5, 15, 10, 25, 20],
                                        borderColor: color,
                                        backgroundColor: color,
                                        pointStyle: marker,
                                        pointRadius: parseInt(ms),
                                        borderDash: lDash,
                                        borderWidth: parseInt(lw),
                                        fill: false
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        y: { grid: { color: '#e2e8f0' } },
                                        x: { grid: { color: '#e2e8f0' } }
                                    }
                                }
                            });
                        }
                    };
                    ['p-color', 'p-marker', 'p-style', 'p-lw', 'p-ms'].forEach(id => {
                        document.getElementById(id).addEventListener('input', update);
                    });
                    update();
                }
            },
            {
                id: 'labels', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-6">
                    <div class="md:w-1/3 space-y-4 pr-2">
                        <h2 class="text-2xl font-bold text-brand-primary">Títulos y Etiquetas</h2>
                        <div class="bg-white p-4 rounded-lg border shadow-sm space-y-3">
                            <div><label class="text-xs font-semibold">Título</label><input type="text" id="l-ti" value="Ventas" class="w-full border rounded text-sm p-1"></div>
                            <div class="grid grid-cols-2 gap-2">
                                <div><label class="text-xs font-semibold">X</label><input type="text" id="l-x" value="Mes" class="w-full border rounded text-sm p-1"></div>
                                <div><label class="text-xs font-semibold">Y</label><input type="text" id="l-y" value="$" class="w-full border rounded text-sm p-1"></div>
                            </div>
                        </div>
                        <div class="rounded-lg bg-white font-mono text-xs p-3 border">
                            <div>plt.title('<span id="c-ti" class="text-green-600">Ventas</span>')</div>
                            <div>plt.xlabel('<span id="c-x" class="text-green-600">Mes</span>')</div>
                            <div>plt.ylabel('<span id="c-y" class="text-green-600">$</span>')</div>
                        </div>
                    </div>
                    <div class="md:w-2/3 bg-surface-muted rounded-xl p-4 flex items-center justify-center relative min-h-[300px]"><canvas id="chart-labels"></canvas></div>
                </div>`,
                script: () => {
                    const update = () => {
                        const t = document.getElementById('l-ti').value, x = document.getElementById('l-x').value, y = document.getElementById('l-y').value;
                        document.getElementById('c-ti').textContent = t; document.getElementById('c-x').textContent = x; document.getElementById('c-y').textContent = y;
                        if (chartInstance) { chartInstance.options.plugins.title.text = t; chartInstance.options.scales.x.title.text = x; chartInstance.options.scales.y.title.text = y; chartInstance.update('none'); }
                        else { initChart('chart-labels', { type: 'line', data: { labels: ['En', 'Fb', 'Mr'], datasets: [{ data: [10, 20, 15], borderColor: '#0055ad' }] }, options: { maintainAspectRatio: false, plugins: { title: { display: true, text: t } }, scales: { x: { display: true, title: { display: true, text: x } }, y: { display: true, title: { display: true, text: y } } } } }); }
                    };
                    ['l-ti', 'l-x', 'l-y'].forEach(id => document.getElementById(id).addEventListener('input', update)); update();
                }
            },
            {
                id: 'grid-legend', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-6">
                    <div class="md:w-1/3 space-y-4 pr-2">
                        <h2 class="text-2xl font-bold text-brand-primary">Grid & Legend</h2>
                        <div class="bg-white p-4 rounded-lg border shadow-sm space-y-3">
                            <label class="flex items-center gap-2"><input type="checkbox" id="chk-g" checked> Grid</label>
                            <label class="flex items-center gap-2"><input type="checkbox" id="chk-l" checked> Legend</label>
                            <div><label class="text-xs font-semibold">Label Serie</label><input type="text" id="inp-lg" value="Data 1" class="w-full border rounded text-sm p-1"></div>
                        </div>
                        <div class="rounded-lg bg-white font-mono text-xs p-3 border">
                            <div>plt.plot(x, y, label='<span id="c-lg" class="text-green-600">Data 1</span>')</div>
                            <div>plt.grid(<span id="c-gd" class="text-purple-600">True</span>)</div>
                            <div id="c-showl">plt.legend()</div>
                        </div>
                    </div>
                    <div class="md:w-2/3 bg-surface-muted rounded-xl p-4 flex items-center justify-center relative min-h-[300px]"><canvas id="chart-gl"></canvas></div>
                </div>`,
                script: () => {
                    const update = () => {
                        const g = document.getElementById('chk-g').checked, l = document.getElementById('chk-l').checked, txt = document.getElementById('inp-lg').value;
                        document.getElementById('c-gd').textContent = g ? 'True' : 'False'; document.getElementById('c-lg').textContent = txt;
                        document.getElementById('c-showl').style.opacity = l ? 1 : 0.3;
                        if (chartInstance) { chartInstance.options.scales.x.grid.display = g; chartInstance.options.scales.y.grid.display = g; chartInstance.data.datasets[0].label = txt; chartInstance.options.plugins.legend.display = l; chartInstance.update('none'); }
                        else { initChart('chart-gl', { type: 'line', data: { labels: [1, 2, 3], datasets: [{ label: txt, data: [5, 10, 8], borderColor: 'red' }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: l } }, scales: { x: { grid: { display: g } }, y: { grid: { display: g } } } } }); }
                    };
                    ['chk-g', 'chk-l', 'inp-lg'].forEach(id => document.getElementById(id).addEventListener('input', update)); update();
                }
            },
            {
                id: 'bar', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-6">
                    <div class="md:w-1/3 space-y-4 pr-2">
                        <h2 class="text-2xl font-bold text-brand-primary">Barras (bar)</h2>
                        <div class="bg-white p-4 rounded-lg border shadow-sm space-y-3">
                            <div><label class="text-xs font-semibold">Cats</label><input type="text" id="b-c" value="A, B, C" class="w-full border rounded text-sm p-1"></div>
                            <div><label class="text-xs font-semibold">Vals</label><input type="text" id="b-v" value="10, 25, 15" class="w-full border rounded text-sm p-1"></div>
                        </div>
                        <div class="rounded-lg bg-white font-mono text-xs p-3 border">
                            <div>plt.<span class="text-blue-600">bar</span>(cats, vals)</div>
                        </div>
                    </div>
                    <div class="md:w-2/3 bg-surface-muted rounded-xl p-4 flex items-center justify-center relative min-h-[300px]"><canvas id="chart-bar"></canvas></div>
                </div>`,
                script: () => {
                    const update = () => {
                        const c = document.getElementById('b-c').value.split(','), v = document.getElementById('b-v').value.split(',').map(Number);
                        if (chartInstance) { chartInstance.data.labels = c; chartInstance.data.datasets[0].data = v; chartInstance.update(); }
                        else { initChart('chart-bar', { type: 'bar', data: { labels: c, datasets: [{ data: v, backgroundColor: '#0055ad' }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } }); }
                    };
                    ['b-c', 'b-v'].forEach(id => document.getElementById(id).addEventListener('input', update)); update();
                }
            },
            {
                id: 'barh', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-6">
                    <div class="md:w-1/3 space-y-4 pr-2">
                        <h2 class="text-2xl font-bold text-brand-primary">Barras H (barh)</h2>
                        <div class="bg-white p-4 rounded-lg border shadow-sm space-y-3">
                            <div><label class="text-xs font-semibold">Cats</label><input type="text" id="bh-c" value="P1, P2, P3" class="w-full border rounded text-sm p-1"></div>
                            <div><label class="text-xs font-semibold">Vals</label><input type="text" id="bh-v" value="50, 80, 60" class="w-full border rounded text-sm p-1"></div>
                        </div>
                        <div class="rounded-lg bg-white font-mono text-xs p-3 border">
                            <div>plt.<span class="text-blue-600">barh</span>(cats, vals)</div>
                        </div>
                    </div>
                    <div class="md:w-2/3 bg-surface-muted rounded-xl p-4 flex items-center justify-center relative min-h-[300px]"><canvas id="chart-barh"></canvas></div>
                </div>`,
                script: () => {
                    const update = () => {
                        const c = document.getElementById('bh-c').value.split(','), v = document.getElementById('bh-v').value.split(',').map(Number);
                        if (chartInstance) { chartInstance.data.labels = c; chartInstance.data.datasets[0].data = v; chartInstance.update(); }
                        else { initChart('chart-barh', { type: 'bar', data: { labels: c, datasets: [{ data: v, backgroundColor: '#06717e', axis: 'y' }] }, options: { indexAxis: 'y', maintainAspectRatio: false, plugins: { legend: { display: false } } } }); }
                    };
                    ['bh-c', 'bh-v'].forEach(id => document.getElementById(id).addEventListener('input', update)); update();
                }
            },
            {
                id: 'scatter', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-6">
                    <div class="md:w-1/3 space-y-4 pr-2">
                        <h2 class="text-2xl font-bold text-brand-primary">Dispersión (scatter)</h2>
                        <div class="bg-white p-4 rounded-lg border shadow-sm space-y-3">
                            <div><label class="text-xs font-semibold">X</label><input type="text" id="s-x" value="1,2,3,4,5" class="w-full border rounded text-sm p-1"></div>
                            <div><label class="text-xs font-semibold">Y</label><input type="text" id="s-y" value="5,4,6,2,7" class="w-full border rounded text-sm p-1"></div>
                            <div><label class="text-xs font-semibold">Size</label><input type="range" id="s-s" min="10" max="100" value="50"></div>
                        </div>
                        <div class="rounded-lg bg-white font-mono text-xs p-3 border">
                            <div>plt.scatter(x, y, s=<span id="c-s">50</span>)</div>
                        </div>
                    </div>
                    <div class="md:w-2/3 bg-surface-muted rounded-xl p-4 flex items-center justify-center relative min-h-[300px]"><canvas id="chart-sc"></canvas></div>
                </div>`,
                script: () => {
                    const update = () => {
                        const x = document.getElementById('s-x').value.split(',').map(Number), y = document.getElementById('s-y').value.split(',').map(Number), s = document.getElementById('s-s').value;
                        const d = x.map((v, i) => ({ x: v, y: y[i] || 0 })); document.getElementById('c-s').textContent = s;
                        if (chartInstance) { chartInstance.data.datasets[0].data = d; chartInstance.data.datasets[0].pointRadius = Math.sqrt(s); chartInstance.update(); }
                        else { initChart('chart-sc', { type: 'scatter', data: { datasets: [{ data: d, backgroundColor: '#ff5722', pointRadius: Math.sqrt(s) }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } }); }
                    };
                    ['s-x', 's-y', 's-s'].forEach(id => document.getElementById(id).addEventListener('input', update)); update();
                }
            },
            {
                id: 'area', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-6">
                    <div class="md:w-1/3 space-y-4 pr-2">
                        <h2 class="text-2xl font-bold text-brand-primary">Área (fill_between)</h2>
                        <div class="bg-white p-4 rounded-lg border shadow-sm space-y-3">
                            <div><label class="text-xs font-semibold">Alpha: <span id="v-a">0.3</span></label><input type="range" id="a-al" min="0.1" max="1" step="0.1" value="0.3"></div>
                            <div><label class="text-xs font-semibold">Color</label><input type="color" id="a-c" value="#0f6cbf" class="w-full h-8 cursor-pointer rounded"></div>
                        </div>
                        <div class="rounded-lg bg-white font-mono text-xs p-3 border">
                            <div>plt.fill_between(x, y, color='<span id="c-ac">#0f6cbf</span>')</div>
                        </div>
                    </div>
                    <div class="md:w-2/3 bg-surface-muted rounded-xl p-4 flex items-center justify-center relative min-h-[300px]"><canvas id="chart-ar"></canvas></div>
                </div>`,
                script: () => {
                    const update = () => {
                        const a = document.getElementById('a-al').value, c = document.getElementById('a-c').value;
                        document.getElementById('v-a').textContent = a; document.getElementById('c-ac').textContent = c;
                        const rgba = `rgba(${parseInt(c.slice(1, 3), 16)}, ${parseInt(c.slice(3, 5), 16)}, ${parseInt(c.slice(5, 7), 16)}, ${a})`;
                        if (chartInstance) { chartInstance.data.datasets[0].backgroundColor = rgba; chartInstance.data.datasets[0].borderColor = c; chartInstance.update(); }
                        else { initChart('chart-ar', { type: 'line', data: { labels: [0, 1, 2, 3, 4], datasets: [{ data: [1, 3, 2, 5, 4], borderColor: c, backgroundColor: rgba, fill: true }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, elements: { line: { tension: 0.4 } } } }); }
                    };
                    ['a-al', 'a-c'].forEach(id => document.getElementById(id).addEventListener('input', update)); update();
                }
            },
            {
                id: 'step', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-6">
                    <div class="md:w-1/3 space-y-4 pr-2">
                        <h2 class="text-2xl font-bold text-brand-primary">Escalera (step)</h2>
                        <div class="bg-white p-4 rounded-lg border shadow-sm space-y-3">
                            <div><label class="text-xs font-semibold">Where</label><select id="st-w" class="w-full border rounded p-1"><option value="mid">mid</option><option value="before">pre</option><option value="after">post</option></select></div>
                        </div>
                        <div class="rounded-lg bg-white font-mono text-xs p-3 border">
                            <div>plt.step(x, y, where='<span id="c-w" class="text-green-600">mid</span>')</div>
                        </div>
                    </div>
                    <div class="md:w-2/3 bg-surface-muted rounded-xl p-4 flex items-center justify-center relative min-h-[300px]"><canvas id="chart-st"></canvas></div>
                </div>`,
                script: () => {
                    const update = () => {
                        const w = document.getElementById('st-w').value;
                        const cjsW = w === 'before' ? 'before' : (w === 'after' ? 'after' : 'middle');
                        document.getElementById('c-w').textContent = w;
                        if (chartInstance) { chartInstance.data.datasets[0].stepped = cjsW; chartInstance.update(); }
                        else { initChart('chart-st', { type: 'line', data: { labels: [1, 2, 3, 4, 5], datasets: [{ data: [10, 15, 10, 20, 25], borderColor: '#6ea2ee', stepped: cjsW, pointRadius: 0 }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } }); }
                    };
                    document.getElementById('st-w').addEventListener('change', update); update();
                }
            },
            {
                id: 'subplot', render: () => `
                <div class="flex flex-col h-full gap-4">
                    <h2 class="text-2xl font-bold text-brand-primary">Subplots</h2>
                    <div class="flex-grow bg-surface-muted rounded-xl p-4 grid grid-cols-2 gap-4 h-full">
                        <div class="bg-white p-2 rounded shadow-sm relative"><div class="absolute top-2 left-2 text-xs font-bold text-gray-400">ax[0]</div><canvas id="c-s1"></canvas></div>
                        <div class="bg-white p-2 rounded shadow-sm relative"><div class="absolute top-2 left-2 text-xs font-bold text-gray-400">ax[1]</div><canvas id="c-s2"></canvas></div>
                    </div>
                </div>`,
                script: () => {
                    if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
                    subChartInstances = [
                        new Chart(document.getElementById('c-s1'), { type: 'line', data: { labels: [1, 2, 3], datasets: [{ data: [1, 3, 2], borderColor: 'blue' }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } }),
                        new Chart(document.getElementById('c-s2'), { type: 'bar', data: { labels: ['A', 'B'], datasets: [{ data: [10, 20], backgroundColor: 'orange' }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } })
                    ];
                }
            },
            {
                id: 'end', render: () => `
                <div class="flex flex-col items-center justify-center h-full text-center space-y-6">
                    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-4xl mb-4">✓</div>
                    <h1 class="text-4xl font-bold text-brand-primary">¡Módulo Completado!</h1>
                    <button onclick="goToSlide(0)" class="mt-8 px-8 py-3 bg-action-default text-white rounded-lg hover:bg-action-hover shadow-lg font-bold">Volver al Inicio</button>
                </div>`
            }
        ];

        function renderSlide(idx) {
            if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
            subChartInstances.forEach(c => c.destroy()); subChartInstances = [];
            const d = slides[idx];
            document.getElementById('slide-container').innerHTML = d.render();
            if (d.script) setTimeout(d.script, 0);
            document.getElementById('slide-counter').textContent = `Diapositiva ${idx + 1} de ${slides.length}`;
            document.getElementById('prev-btn').disabled = idx === 0;
            document.getElementById('next-btn').disabled = idx === slides.length - 1;
        }

        window.nextSlide = () => { if (currentSlide < slides.length - 1) renderSlide(++currentSlide); };
        window.prevSlide = () => { if (currentSlide > 0) renderSlide(--currentSlide); };
        window.goToSlide = (idx) => { currentSlide = idx; renderSlide(idx); };
        document.getElementById('next-btn').addEventListener('click', window.nextSlide);
        document.getElementById('prev-btn').addEventListener('click', window.prevSlide);
        document.addEventListener('keydown', e => { if (e.key === 'ArrowRight') window.nextSlide(); if (e.key === 'ArrowLeft') window.prevSlide(); });

        // Global Chart Init Helper
        function initChart(canvasId, config) {
            const el = document.getElementById(canvasId);
            if (!el) return;
            const ctx = el.getContext('2d');
            chartInstance = new Chart(ctx, config);
        }

        // Init
        renderSlide(0);
    </script>
</body>

</html>