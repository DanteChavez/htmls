<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 01: Gráficos Matemáticos con pyplot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        surface: { main: '#ffffff', muted: '#f1f5f9', dark: '#0f6cbf' },
                        brand: { primary: '#003c58', accent: '#06717e' },
                        action: { default: '#0055ad', hover: '#399be2' },
                        text: { sky: '#6ea2ee', muted: '#6da8e9', deep: '#1e293b' },
                        border: { light: '#e2e8f0' }
                    },
                    fontFamily: { mono: ['Courier New', 'Consolas', 'monospace'] }
                }
            }
        }
    </script>
    <style>
        .code-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .code-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .code-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #0055ad;
            cursor: pointer;
            margin-top: -6px;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        @keyframes bounce-soft {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes bounce-lateral {

            0%,
            100% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(-10px);
            }
        }

        @keyframes bounce-right {

            0%,
            100% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(10px);
            }
        }

        .animate-bounce-soft {
            animation: bounce-soft 1s infinite ease-in-out;
        }

        .animate-bounce-lateral {
            animation: bounce-lateral 1s infinite ease-in-out;
        }

        .animate-bounce-right {
            animation: bounce-right 1s infinite ease-in-out;
        }
    </style>
</head>

<body class="bg-surface-main text-text-deep font-sans min-h-screen flex flex-col overflow-hidden">
    <main id="app" class="flex-grow flex flex-col relative h-screen">
        <div id="slide-container" class="flex-grow flex flex-col p-4 md:px-8 md:pt-4 md:pb-20 overflow-y-auto"></div>
        <footer
            class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur border-t border-border-light p-4 flex justify-between items-center z-50">
            <button id="prev-btn"
                class="px-4 py-2 bg-slate-200 text-slate-600 rounded hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed font-medium">&larr;
                Anterior</button>
            <span class="text-text-muted text-sm font-medium" id="slide-counter">Diapositiva 1 de 13</span>
            <button id="next-btn"
                class="px-4 py-2 bg-action-default text-white rounded hover:bg-action-hover disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-sm">Siguiente
                &rarr;</button>
        </footer>
    </main>
    <script>
        let currentSlide = 0;
        let chartInstance = null;
        let subChartInstances = [];

        const slides = [
            {
                id: 'intro', render: () => `
                <div class="flex flex-col items-center justify-center h-full text-center space-y-4">
                    <div class="w-20 h-20 bg-brand-primary/10 rounded-full flex items-center justify-center mb-2">
                        <svg class="w-10 h-10 text-brand-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                    </div>
                    <div class="space-y-1">
                        <h3 class="text-base font-bold text-brand-accent uppercase tracking-widest">Unidad 3</h3>
                        <h1 class="text-4xl md:text-5xl font-extrabold text-brand-primary">Módulo 01: pyplot</h1>
                    </div>
                    <h2 class="text-xl md:text-2xl text-text-deep font-semibold max-w-2xl">Introducción práctica a matplotlib.pyplot</h2>
                    <p class="text-text-deep/80 max-w-lg text-lg">Aprende a crear gráficos de líneas, barras, dispersión y más de forma interactiva.</p>
                    <button onclick="nextSlide()" class="mt-6 px-10 py-4 bg-action-default text-white rounded-xl hover:bg-action-hover shadow-xl font-bold text-lg transition-transform hover:scale-105 active:scale-95">Comenzar</button>
                </div>`
            },
            {
                id: 'what-is', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8">
                    <div class="md:w-1/2 space-y-6 flex flex-col justify-center text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">¿Qué es pyplot?</h2>
                        <div class="space-y-4">
                            <p class="text-lg leading-relaxed">
                                <code class="bg-gray-100 px-2 py-1 rounded text-brand-accent font-bold">pyplot</code> es un sub-módulo de <span class="font-bold">Matplotlib</span> diseñado para crear gráficos de forma secuencial.
                            </p>
                            <p class="text-lg leading-relaxed">
                                Funciona como una <strong>máquina de estados</strong>: cada comando sobre <code class="font-mono text-brand-primary">plt</code> modifica la figura actual agregando líneas, etiquetas o títulos.
                            </p>
                        </div>
                        
                        <div class="rounded-lg overflow-hidden border border-border-light shadow-sm bg-white font-mono text-sm mt-4">
                            <div class="bg-gray-100 px-4 py-2 flex gap-2 border-b border-gray-200">
                                <div class="w-3 h-3 rounded-full bg-red-400"></div>
                                <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                                <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            </div>
                            <div class="p-4 overflow-x-auto code-scroll">
                                <div class="text-gray-400 mb-1"># Importamos y definimos datos</div>
                                <div><span class="text-blue-600">import</span> matplotlib.pyplot <span class="text-blue-600">as</span> plt</div>
                                <div>datos = [10, 20, 15, 30, 25]</div>
                                <br>
                                <div class="text-gray-400 mb-1"># Trazamos y agregamos eje Y</div>
                                <div>plt.<span class="text-blue-600">plot</span>(datos)</div>
                                <div>plt.<span class="text-blue-600">ylabel</span>(<span class="text-green-600">'Valores'</span>)</div>
                                <div>plt.<span class="text-blue-600">show</span>()</div>
                            </div>
                        </div>
                    </div>
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-[350px] relative">
                            <canvas id="chart-basic"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-basic', {
                    type: 'line',
                    data: {
                        labels: [0, 1, 2, 3, 4],
                        datasets: [{
                            label: 'Datos Generales',
                            data: [10, 20, 15, 30, 25],
                            borderColor: '#0055ad',
                            backgroundColor: 'rgba(0, 85, 173, 0.1)',
                            borderWidth: 3,
                            pointRadius: 6,
                            pointBackgroundColor: '#0055ad',
                            tension: 0.2,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { display: true, title: { display: true, text: 'Valores', font: { size: 14, weight: 'bold' } }, grid: { color: '#e2e8f0' } },
                            x: { grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'workflow', render: () => `
                <div class="flex flex-col h-full space-y-8">
                    <div class="text-center space-y-2">
                        <h2 class="text-3xl font-bold text-brand-primary">El Ciclo de Vida de un Gráfico</h2>
                        <p class="text-lg text-text-deep/80">Crear una visualización en <code class="font-mono">pyplot</code> sigue siempre un orden lógico de 5 pasos.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 relative">
                        <!-- Step 1 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">1</div>
                            <h3 class="font-bold text-brand-primary">Importar</h3>
                            <p class="text-xs text-text-deep">Traer el submódulo <code class="text-brand-accent">plt</code>.</p>
                        </div>
                        <!-- Step 2 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">2</div>
                            <h3 class="font-bold text-brand-primary">Datos</h3>
                            <p class="text-xs text-text-deep">Definir listas para los ejes <code class="text-brand-accent">X</code> e <code class="text-brand-accent">Y</code>.</p>
                        </div>
                        <!-- Step 3 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">3</div>
                            <h3 class="font-bold text-brand-primary">Trazar</h3>
                            <p class="text-xs text-text-deep">Usar <code class="text-blue-600">.plot()</code> para cargar los datos.</p>
                        </div>
                        <!-- Step 4 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">4</div>
                            <h3 class="font-bold text-brand-primary">Configurar</h3>
                            <p class="text-xs text-text-deep">Añadir títulos, etiquetas y estilos.</p>
                        </div>
                        <!-- Step 5 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-accent text-white rounded-full flex items-center justify-center font-bold">5</div>
                            <h3 class="font-bold text-brand-primary">Mostrar</h3>
                            <p class="text-xs text-text-deep">Ejecutar <code class="text-blue-600">.show()</code> para ver el resultado.</p>
                        </div>
                        <!-- Connector line (desktop only) -->
                        <div class="hidden md:block absolute top-1/2 left-0 right-0 h-0.5 bg-border-light -translate-y-12 z-0"></div>
                    </div>

                    <div class="rounded-lg overflow-hidden border border-border-light shadow-md bg-white font-mono text-sm max-w-2xl mx-auto w-full">
                        <div class="bg-slate-800 px-4 py-2 flex gap-2">
                            <div class="w-3 h-3 rounded-full bg-red-400"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                            <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            <span class="text-slate-400 text-xs ml-2">script.py</span>
                        </div>
                        <div class="p-6 space-y-2 bg-slate-900 text-slate-300">
                            <div><span class="text-pink-400">import</span> matplotlib.pyplot <span class="text-pink-400">as</span> plt <span class="text-slate-500 italic ml-4"># 1. Importar</span></div>
                            <br>
                            <div>xParams = [<span class="text-purple-400">1, 2, 3</span>] <span class="text-slate-500 italic ml-4"># 2. Datos</span></div>
                            <div>yParams = [<span class="text-purple-400">10, 20, 15</span>]</div>
                            <br>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">plot</span>(xParams, yParams) <span class="text-slate-500 italic ml-4"># 3. Trazar</span></div>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">title</span>(<span class="text-green-400">'Mi Gráfico'</span>) <span class="text-slate-500 italic ml-4"># 4. Configurar</span></div>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">show</span>() <span class="text-slate-500 italic ml-4 text-brand-accent font-bold"># 5. Mostrar</span></div>
                        </div>
                    </div>
                </div>`
            },
            {
                id: 'chart-types', render: () => `
                <div class="flex flex-col h-full space-y-6">
                    <div class="text-center space-y-2">
                        <h2 class="text-3xl font-bold text-brand-primary">Variedad de Gráficos</h2>
                        <p class="text-lg text-text-deep/80 text-balance max-w-2xl mx-auto">
                            Pyplot permite cambiar radicalmente la visualización simplemente llamando a un método distinto bajo la sintaxis <code class="font-mono text-brand-accent font-bold">plt.metodo()</code>.
                        </p>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 flex-grow overflow-y-auto custom-scroll p-1 content-center">
                        <!-- plot -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-blue-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.plot()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Líneas</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">El más común. Ideal para mostrar tendencias y cambios a lo largo del tiempo o de una secuencia numérica.</p>
                        </div>
                        <!-- bar -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-teal-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.bar()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Barras</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Perfecto para comparar cantidades o magnitudes entre diferentes categorías discretas.</p>
                        </div>
                        <!-- barh -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-indigo-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.barh()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Barras Horizontales</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Útil cuando los nombres de las categorías son largos o para mostrar rankings de mayor a menor.</p>
                        </div>
                        <!-- scatter -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-orange-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.scatter()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Dispersión</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Muestra la relación o correlación entre dos variables numéricas mediante puntos aislados.</p>
                        </div>
                        <!-- fill_between -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-cyan-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.fill_between()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Área</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Rellena el espacio bajo una línea. Ideal para resaltar volúmenes acumulados o áreas de interés.</p>
                        </div>
                        <!-- step -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-purple-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.step()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Escalones</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Muestra cambios que ocurren en puntos específicos del tiempo, como señales o stock.</p>
                        </div>
                    </div>
                </div>`
            },
            {
                id: 'data-input', render: () => `
                <div class="flex flex-col md:flex-row gap-6 min-h-0">
                    <div class="md:w-2/5 space-y-6 flex flex-col">
                        <h2 class="text-2xl font-bold text-brand-primary">Datos a graficar</h2>
                        <div class="space-y-3">
                            <p class="text-base leading-relaxed text-text-deep">
                                En <code class="bg-gray-100 px-1 rounded">pyplot</code>, los datos se pasan como listas o arreglos. El <strong>eje X</strong> suele representar categorías o tiempo, mientras que el <strong>eje Y</strong> contiene los valores numéricos correspondientes.
                            </p>
                            <div class="p-3 bg-amber-50 border-l-4 border-amber-400 rounded text-sm text-amber-800 italic">
                                <strong>Importante:</strong> Ambas listas deben tener exactamente la misma longitud.
                            </div>
                        </div>

                        <div class="space-y-4 bg-white p-4 rounded-lg border border-border-light shadow-sm">
                            <div>
                                <label class="flex justify-between text-sm font-semibold mb-1">
                                    <span>Eje X (Categorías)</span>
                                    <span id="size-x-container" class="text-xs transition-colors">Cant: <span id="size-x">5</span></span>
                                </label>
                                <input type="text" id="input-x" value="1, 2, 3, 4, 5" class="w-full p-2 border rounded font-mono text-sm focus:ring-2 focus:ring-action-default outline-none">
                            </div>
                            <div>
                                <label class="flex justify-between text-sm font-semibold mb-1">
                                    <span>Eje Y (Valores)</span>
                                    <span id="size-y-container" class="text-xs transition-colors">Cant: <span id="size-y">5</span></span>
                                </label>
                                <input type="text" id="input-y" value="2, 3, 5, 7, 11" class="w-full p-2 border rounded font-mono text-sm focus:ring-2 focus:ring-action-default outline-none">
                            </div>
                        </div>

                        <!-- Inline Code Block (Slide 6 Style) -->
                        <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 shrink-0 custom-scroll">
                            <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                x = [<span id="code-x" class="text-green-600 font-bold">1, 2, 3, 4, 5</span>]<br>
                                y = [<span id="code-y" class="text-green-600 font-bold">2, 3, 5, 7, 11</span>]<br><br>
                                plt.<span class="text-blue-600 font-bold">plot</span>(x, y)<br>
                                plt.<span class="text-blue-600 font-bold">show</span>()
                            </div>
                        </div>
                    </div>
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-6 flex items-center justify-center min-h-[350px] relative self-start md:self-stretch">
                        <div class="w-full h-full relative">
                            <canvas id="chart-data"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const ctx = document.getElementById('chart-data').getContext('2d');
                    const updateData = () => {
                        const valX = document.getElementById('input-x').value.split(',').filter(s => s.trim() !== "").map(s => s.trim());
                        const valY = document.getElementById('input-y').value.split(',').filter(s => s.trim() !== "").map(s => parseFloat(s.trim()));

                        const lenX = valX.length;
                        const lenY = valY.length;

                        // UI Feedback
                        const szX = document.getElementById('size-x');
                        const szY = document.getElementById('size-y');
                        const contX = document.getElementById('size-x-container');
                        const contY = document.getElementById('size-y-container');

                        szX.textContent = lenX;
                        szY.textContent = lenY;

                        if (lenX !== lenY) {
                            contX.classList.add('text-red-500', 'font-bold');
                            contY.classList.add('text-red-500', 'font-bold');
                        } else {
                            contX.classList.remove('text-red-500', 'font-bold');
                            contY.classList.remove('text-red-500', 'font-bold');
                            contX.classList.add('text-text-muted');
                            contY.classList.add('text-text-muted');
                        }

                        // Update Code
                        document.getElementById('code-x').textContent = valX.join(', ');
                        document.getElementById('code-y').textContent = valY.filter(n => !isNaN(n)).join(', ');

                        if (lenX > 0 && lenY > 0 && lenX === lenY) {
                            if (chartInstance) {
                                chartInstance.data.labels = valX;
                                chartInstance.data.datasets[0].data = valY;
                                chartInstance.update('none');
                            } else {
                                initChart('chart-data', {
                                    type: 'line',
                                    data: {
                                        labels: valX,
                                        datasets: [{
                                            label: 'Valores',
                                            data: valY,
                                            borderColor: '#0055ad',
                                            borderWidth: 3,
                                            pointRadius: 5,
                                            tension: 0.1,
                                            fill: false
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: { legend: { display: false } },
                                        scales: {
                                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                                            x: { grid: { color: '#e2e8f0' } }
                                        }
                                    }
                                });
                            }
                        }
                    };
                    document.getElementById('input-x').addEventListener('input', updateData);
                    document.getElementById('input-y').addEventListener('input', updateData);
                    updateData();
                }
            },
            {
                id: 'line-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Líneas — plt.plot()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de líneas representa datos conectando puntos mediante segmentos rectos.
                                Se utiliza para mostrar cómo cambian los valores en un orden específico.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Visualizar evolución o tendencia, especialmente a lo largo del tiempo o en secuencias lógicas.</p>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <p>Cada punto del gráfico representa un par de valores:</p>
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> representa el orden (tiempo, etapas o secuencia).
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene los valores numéricos asociados.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada punto corresponde a un par (X, Y).</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Continuidad</h3>
                                <p>Al conectar los puntos se asume que existe una relación continua entre ellos, permitiendo observar tendencias generales.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos no representan algo continuo, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-line-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-line-intro', {
                    type: 'line',
                    data: {
                        labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                        datasets: [{
                            data: [12, 19, 15, 25, 22, 30],
                            borderColor: '#0055ad',
                            borderWidth: 4,
                            pointRadius: 6,
                            pointBackgroundColor: '#fff',
                            pointBorderWidth: 3,
                            tension: 0.3,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { grid: { color: '#e2e8f0' }, ticks: { font: { weight: 'bold' } } },
                            x: { grid: { color: '#e2e8f0' }, ticks: { font: { weight: 'bold' } } }
                        }
                    }
                })
            },
            {
                id: 'plot-params', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls (Scrollable) -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay (Hidden by default) -->
                        <div id="code-overlay" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código Generado</h3>
                                <button id="hide-code" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    x = [1, 2, 3, 4, 5]<br>
                                    y = [5, 15, 10, 25, 20]<br><br>
                                    plt.<span class="text-blue-600 font-bold">plot</span>(x, y, <br>
                                    &nbsp;&nbsp;color='<span id="c-color" class="text-green-600 font-bold">blue</span>', <br>
                                    &nbsp;&nbsp;marker='<span id="c-marker" class="text-orange-600 font-bold">o</span>', <br>
                                    &nbsp;&nbsp;linestyle='<span id="c-style" class="text-orange-600 font-bold">-</span>', <br>
                                    &nbsp;&nbsp;linewidth=<span id="c-lw" class="text-purple-600 font-bold">3</span>, <br>
                                    &nbsp;&nbsp;markersize=<span id="c-ms" class="text-purple-600 font-bold">10</span>)<br><br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Personalización con .plot()</h2>
                        
                        <div class="space-y-3 text-[13px] text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Definición:</strong> Un gráfico de línea conecta puntos de datos con una línea continua sobre un plano cartesiano. Usamos <code class="bg-gray-100 px-1 rounded font-bold text-xs">plt.plot(x, y, ...)</code>.
                            </p>
                            <p>Solo las listas <strong>x</strong> e <strong>y</strong> son obligatorias; los demás parámetros permiten estilizar el gráfico:</p>
                            <ul class="list-none space-y-1 ml-1 text-[12px]">
                                <li><span class="text-brand-accent font-bold">• color:</span> define el color de la línea y los marcadores.</li>
                                <li><span class="text-brand-accent font-bold">• marker:</span> coloca un símbolo (como un círculo 'o') en cada punto.</li>
                                <li><span class="text-brand-accent font-bold">• linestyle:</span> define el estilo de la línea (sólida, punteada, etc).</li>
                                <li><span class="text-brand-accent font-bold">• linewidth:</span> controla el grosor de la línea.</li>
                                <li><span class="text-brand-accent font-bold">• markersize:</span> ajusta el tamaño del marcador.</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3 shrink-0">
                            <div class="grid grid-cols-2 gap-3">
                                <div><label class="text-xs font-semibold block mb-1">Color</label><select id="p-color" class="w-full border rounded text-sm p-1"><option value="#0055ad">blue</option><option value="#ef4444">red</option><option value="#22c55e">green</option><option value="#a855f7">purple</option></select></div>
                                <div><label class="text-xs font-semibold block mb-1">Marker</label><select id="p-marker" class="w-full border rounded text-sm p-1"><option value="circle">o (Círculo)</option><option value="rect">s (Cuadrado)</option><option value="triangle">^ (Triángulo)</option><option value="star">★ (Estrella)</option></select></div>
                            </div>
                            <div><label class="text-xs font-semibold block mb-1">Linestyle</label><select id="p-style" class="w-full border rounded text-sm p-1"><option value="solid">- (Sólido)</option><option value="dashed">-- (Dashed)</option><option value="dotted">: (Dotted)</option></select></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-xs font-semibold flex justify-between text-[10px]">Linewidth: <span id="v-lw">3</span></label><input type="range" id="p-lw" min="1" max="10" value="3" class="w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer"></div>
                                <div><label class="text-xs font-semibold flex justify-between text-[10px]">Markersize: <span id="v-ms">10</span></label><input type="range" id="p-ms" min="2" max="25" value="10" class="w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer"></div>
                            </div>
                        </div>

                        <button id="show-code" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm transition-all flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization (Fixed Height on Mobile, Flexible on Desktop) -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-params"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay');
                    document.getElementById('show-code').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const color = document.getElementById('p-color').value;
                        const marker = document.getElementById('p-marker').value;
                        const style = document.getElementById('p-style').value;
                        const lw = document.getElementById('p-lw').value;
                        const ms = document.getElementById('p-ms').value;

                        // UI Update
                        document.getElementById('v-lw').textContent = lw;
                        document.getElementById('v-ms').textContent = ms;
                        document.getElementById('c-lw').textContent = lw;
                        document.getElementById('c-ms').textContent = ms;

                        document.getElementById('c-color').textContent = document.getElementById('p-color').options[document.getElementById('p-color').selectedIndex].text;
                        document.getElementById('c-marker').textContent = marker === 'circle' ? 'o' : (marker === 'rect' ? 's' : (marker === 'triangle' ? '^' : '*'));
                        document.getElementById('c-style').textContent = style === 'solid' ? '-' : (style === 'dashed' ? '--' : ':');

                        const lDash = style === 'dashed' ? [10, 5] : (style === 'dotted' ? [2, 2] : []);

                        if (chartInstance) {
                            chartInstance.data.datasets[0].borderColor = color;
                            chartInstance.data.datasets[0].backgroundColor = color;
                            chartInstance.data.datasets[0].pointBackgroundColor = color;
                            chartInstance.data.datasets[0].pointBorderColor = color;
                            chartInstance.data.datasets[0].pointStyle = marker;
                            chartInstance.data.datasets[0].borderDash = lDash;
                            chartInstance.data.datasets[0].borderWidth = parseInt(lw);
                            chartInstance.data.datasets[0].pointRadius = parseInt(ms);
                            chartInstance.data.datasets[0].pointHoverRadius = parseInt(ms) + 2;
                            chartInstance.update();
                        } else {
                            initChart('chart-params', {
                                type: 'line',
                                data: {
                                    labels: [1, 2, 3, 4, 5],
                                    datasets: [{
                                        data: [5, 15, 10, 25, 20],
                                        borderColor: color,
                                        backgroundColor: color,
                                        pointStyle: marker,
                                        pointRadius: parseInt(ms),
                                        borderDash: lDash,
                                        borderWidth: parseInt(lw),
                                        fill: false
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        y: { grid: { color: '#e2e8f0' } },
                                        x: { grid: { color: '#e2e8f0' } }
                                    }
                                }
                            });
                        }
                    };
                    ['p-color', 'p-marker', 'p-style', 'p-lw', 'p-ms'].forEach(id => {
                        document.getElementById(id).addEventListener('input', update);
                    });
                    update();
                }
            },
            {
                id: 'labels', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Títulos y Etiquetas</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Importancia Contextual:</strong> Un gráfico sin etiquetas es solo una línea sin significado. Los títulos y etiquetas de los ejes (labels) proporcionan el contexto necesario para interpretar qué datos estamos observando.
                            </p>
                            <ul class="space-y-2 text-xs">
                                <li><strong class="text-brand-accent">plt.title():</strong> Define el título principal de la visualización.</li>
                                <li><strong class="text-brand-accent">plt.xlabel() / plt.ylabel():</strong> Identifican la magnitud de los ejes horizontal y vertical.</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Título del Gráfico</label>
                                <input type="text" id="l-ti" value="Rendimiento del Proyecto" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Eje X</label>
                                    <input type="text" id="l-x" value="Tiempo (meses)" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Eje Y</label>
                                    <input type="text" id="l-y" value="Progreso (%)" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- Inline Code Block -->
                        <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 shrink-0 custom-scroll">
                            <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                meses = ['Ene', 'Feb', 'Mar']<br>
                                ventas = [10, 20, 15]<br><br>
                                plt.<span class="text-blue-600 font-bold">plot</span>(meses, ventas)<br><br>
                                <span class="text-slate-400"># Configuración de metadatos</span><br>
                                plt.<span class="text-blue-600 font-bold">title</span>('<span id="c-ti" class="text-green-600 font-bold">Ventas Mensuales</span>')<br>
                                plt.<span class="text-blue-600 font-bold">xlabel</span>('<span id="c-x" class="text-green-600 font-bold">Mes</span>')<br>
                                plt.<span class="text-blue-600 font-bold">ylabel</span>('<span id="c-y" class="text-green-600 font-bold">Monto ($)</span>')<br>
                                plt.<span class="text-blue-600 font-bold">show</span>()
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <!-- Visual Indicators -->
                        <div id="ind-ti" class="hidden absolute -top-2 left-1/2 -translate-x-1/2 z-10 text-brand-accent animate-bounce-soft">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div id="ind-x" class="hidden absolute bottom-10 left-1/2 -translate-x-1/2 z-10 text-brand-accent animate-bounce-soft">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div id="ind-y" class="hidden absolute left-14 top-1/2 -translate-y-1/2 z-10 text-brand-accent animate-bounce-lateral">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"></path></svg>
                        </div>

                        <div class="w-full h-full relative">
                            <canvas id="chart-labels"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const update = () => {
                        const t = document.getElementById('l-ti').value;
                        const x = document.getElementById('l-x').value;
                        const y = document.getElementById('l-y').value;

                        document.getElementById('c-ti') && (document.getElementById('c-ti').textContent = t);
                        document.getElementById('c-x') && (document.getElementById('c-x').textContent = x);
                        document.getElementById('c-y') && (document.getElementById('c-y').textContent = y);

                        if (chartInstance) {
                            chartInstance.options.plugins.title.text = t;
                            chartInstance.options.scales.x.title.text = x;
                            chartInstance.options.scales.y.title.text = y;
                            chartInstance.update();
                        } else {
                            initChart('chart-labels', {
                                type: 'line',
                                data: {
                                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May'],
                                    datasets: [{
                                        data: [10, 25, 45, 60, 85],
                                        borderColor: '#0055ad',
                                        backgroundColor: 'rgba(0, 85, 173, 0.1)',
                                        pointBackgroundColor: '#0055ad',
                                        tension: 0.1,
                                        fill: true
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        title: { display: true, text: t, font: { size: 16 } },
                                        legend: { display: false }
                                    },
                                    scales: {
                                        x: { display: true, title: { display: true, text: x }, grid: { color: '#f1f5f9' } },
                                        y: { display: true, title: { display: true, text: y }, grid: { color: '#f1f5f9' } }
                                    }
                                }
                            });
                        }
                    };

                    const setupIndicators = () => {
                        const pairs = [
                            { id: 'l-ti', ind: 'ind-ti' },
                            { id: 'l-x', ind: 'ind-x' },
                            { id: 'l-y', ind: 'ind-y' }
                        ];
                        pairs.forEach(p => {
                            const input = document.getElementById(p.id);
                            const indicator = document.getElementById(p.ind);
                            input.addEventListener('focus', () => indicator.classList.remove('hidden'));
                            input.addEventListener('blur', () => indicator.classList.add('hidden'));
                        });
                    };

                    ['l-ti', 'l-x', 'l-y'].forEach(id => {
                        document.getElementById(id).addEventListener('input', update);
                    });
                    setupIndicators();
                    update();
                }
            },
            {
                id: 'grid-legend', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-grid" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Leyendas y Cuadrícula</h3>
                                <button id="hide-code-grid" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    meses = [1, 2, 3, 4, 5, 6]<br>
                                    ventas = [200, 350, 280, 500, 450, 600]<br>
                                    gastos = [150, 200, 220, 300, 280, 350]<br><br>
                                    plt.<span class="text-blue-600 font-bold">plot</span>(meses, ventas, color='green', marker='o', label='<span id="c-lg1" class="text-green-600 font-bold">Ventas</span>')<br>
                                    plt.<span class="text-blue-600 font-bold">plot</span>(meses, gastos, color='red', marker='o', label='<span id="c-lg2" class="text-red-600 font-bold">Gastos</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Análisis Mensual: Ventas vs Gastos')<br>
                                    plt.<span class="text-blue-600 font-bold">legend</span>(show=<span id="c-show-l" class="text-purple-600 font-bold">True</span>)<br>
                                    plt.<span class="text-blue-600 font-bold">grid</span>(<span id="c-gd" class="text-purple-600 font-bold">True</span>, linestyle='--', alpha=0.5)<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Cuadrículas y Leyendas</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Visualización Avanzada:</strong> Para que un gráfico sea interpretable, necesitamos herramientas que ayuden a leer los valores con precisión y a diferenciar entre múltiples series de datos.
                            </p>
                            <ul class="space-y-2 text-xs">
                                <li><strong class="text-brand-accent">plt.grid():</strong> Dibuja líneas de guía (cuadrícula) que facilitan la proyección de los puntos sobre los ejes.</li>
                                <li><strong class="text-brand-accent">plt.legend():</strong> Muestra una caja con los nombres de las series (definidos con el parámetro <code class="bg-gray-100 px-1 rounded">label</code> en el plot).</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                            <div class="grid grid-cols-2 gap-4">
                                <label class="flex items-center gap-2 cursor-pointer font-semibold text-xs text-slate-700">
                                    <input type="checkbox" id="chk-g" checked class="w-4 h-4 text-brand-primary rounded border-gray-300"> 
                                    Activar Cuadrícula
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer font-semibold text-xs text-slate-700">
                                    <input type="checkbox" id="chk-l" checked class="w-4 h-4 text-brand-primary rounded border-gray-300"> 
                                    Mostrar Leyenda
                                </label>
                            </div>
                            <div class="space-y-3 pt-2 border-t border-gray-200">
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Serie 1 (Verde)</label>
                                    <input type="text" id="inp-lg1" value="Ventas" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Serie 2 (Rojo)</label>
                                    <input type="text" id="inp-lg2" value="Gastos" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                            </div>
                        </div>

                        <button id="show-code-grid" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-gl"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-grid');
                    document.getElementById('show-code-grid').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-grid').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const g = document.getElementById('chk-g').checked;
                        const l = document.getElementById('chk-l').checked;
                        const t1 = document.getElementById('inp-lg1').value;
                        const t2 = document.getElementById('inp-lg2').value;

                        document.getElementById('c-gd') && (document.getElementById('c-gd').textContent = g ? 'True' : 'False');
                        document.getElementById('c-show-l') && (document.getElementById('c-show-l').textContent = l ? 'True' : 'False');
                        document.getElementById('c-lg1') && (document.getElementById('c-lg1').textContent = t1);
                        document.getElementById('c-lg2') && (document.getElementById('c-lg2').textContent = t2);

                        if (chartInstance) {
                            chartInstance.options.scales.x.grid.display = g;
                            chartInstance.options.scales.y.grid.display = g;
                            chartInstance.data.datasets[0].label = t1;
                            chartInstance.data.datasets[1].label = t2;
                            chartInstance.options.plugins.legend.display = l;
                            chartInstance.update();
                        } else {
                            initChart('chart-gl', {
                                type: 'line',
                                data: {
                                    labels: ['1', '2', '3', '4', '5', '6'],
                                    datasets: [
                                        {
                                            label: t1,
                                            data: [200, 350, 280, 500, 450, 600],
                                            borderColor: '#22c55e',
                                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                            pointBackgroundColor: '#15803d',
                                            pointRadius: 5,
                                            fill: false,
                                            tension: 0.1
                                        },
                                        {
                                            label: t2,
                                            data: [150, 200, 220, 300, 280, 350],
                                            borderColor: '#ef4444',
                                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                            pointBackgroundColor: '#b91c1c',
                                            pointRadius: 5,
                                            fill: false,
                                            tension: 0.1
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: l, position: 'top', onClick: null },
                                        title: { display: true, text: 'Análisis Mensual: Ventas vs Gastos', font: { size: 14 } }
                                    },
                                    scales: {
                                        x: { grid: { display: g, color: '#e2e8f0' } },
                                        y: { grid: { display: g, color: '#e2e8f0' }, beginAtZero: true }
                                    }
                                }
                            });
                        }
                    };
                    ['chk-g', 'chk-l', 'inp-lg1', 'inp-lg2'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'bar-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Barras — plt.bar()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de barras representa datos mediante barras rectangulares cuya altura indica el valor. Se crea utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.bar()</code>.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Comparar cantidades entre distintas categorías o grupos de forma clara y directa.</p>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <p>Cada punto o barra del gráfico representa un par de valores:</p>
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> representa categorías o grupos (etiquetas discretas).
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene los valores numéricos asociados a cada categoría.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada barra corresponde a un par (categoría, valor).</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Comparación</h3>
                                <p>Las barras no están conectadas, ya que representan valores independientes entre sí. Esto facilita la distinción entre grupos.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos no representan categorías discretas, sino pares de valores numéricos relacionados entre sí, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-bar-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-bar-intro', {
                    type: 'bar',
                    data: {
                        labels: ['Prod A', 'Prod B', 'Prod C', 'Prod D'],
                        datasets: [{
                            data: [45, 75, 55, 90],
                            backgroundColor: '#0055ad',
                            borderRadius: 6,
                            barThickness: 40
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' }, ticks: { font: { weight: 'bold' } } },
                            x: { grid: { display: false }, ticks: { font: { weight: 'bold' } } }
                        }
                    }
                })
            },
            {
                id: 'bar', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-bar" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Gráfico de Barras Avanzado</h3>
                                <button id="hide-code-bar" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    frutas = [<span id="c-b-c" class="text-green-600 font-bold">'Manzanas', 'Bananas', 'Cerezas'</span>]<br>
                                    cantidad = [<span id="c-b-v" class="text-green-600 font-bold">15, 30, 22</span>]<br><br>
                                    colores = [<span id="c-b-colors" class="text-green-600 font-bold">'#FF6B6B', '#FFD93D', '#C0392B'</span>]<br><br>
                                    plt.<span class="text-blue-600 font-bold">bar</span>(frutas, cantidad, <br>
                                    &nbsp;&nbsp;color=colores, <br>
                                    &nbsp;&nbsp;edgecolor='<span class="text-pink-600 font-bold">black</span>', <br>
                                    &nbsp;&nbsp;linewidth=<span class="text-purple-600 font-bold">1.5</span>, <br>
                                    &nbsp;&nbsp;width=<span class="text-purple-600 font-bold">0.6</span>)<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Cantidad de Frutas')<br>
                                    plt.<span class="text-blue-600 font-bold">xlabel</span>('Frutas')<br>
                                    plt.<span class="text-blue-600 font-bold">ylabel</span>('Cantidad')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Personalización con .bar()</h2>
                        
                        <div class="space-y-4 text-[13px] text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Definición:</strong> Un gráfico de barras representa datos categóricos mediante rectángulos verticales sobre un plano cartesiano. Usamos <code class="bg-gray-100 px-1 rounded font-bold text-xs">plt.bar(x, height, ...)</code>.
                            </p>
                            <p>Solo las listas <strong>x</strong> e <strong>height</strong> son obligatorias; los demás parámetros permiten estilizar el gráfico:</p>
                            <ul class="list-none space-y-1 ml-1 text-xs">
                                <li><span class="text-brand-accent font-bold">• color:</span> define el color de relleno. Acepta un solo color o una lista para cada barra.</li>
                                <li><span class="text-brand-accent font-bold">• edgecolor:</span> define el color del borde exterior de cada barra.</li>
                                <li><span class="text-brand-accent font-bold">• linewidth:</span> controla el grosor del borde de cada barra.</li>
                                <li><span class="text-brand-accent font-bold">• width:</span> ajusta el ancho de las barras (0 a 1).</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3 shrink-0">
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Categorías (separadas por coma)</label>
                                <input type="text" id="b-c" value="Manzanas, Bananas, Cerezas" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Valores (separados por coma)</label>
                                <input type="text" id="b-v" value="15, 30, 22" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Colores Normales o Hex (separados por coma)</label>
                                <input type="text" id="b-colors" value="#FF6B6B, #FFD93D, #C0392B" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                        </div>

                        <button id="show-code-bar" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-bar"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-bar');
                    document.getElementById('show-code-bar').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-bar').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const labels = document.getElementById('b-c').value.split(',').map(s => s.trim());
                        const values = document.getElementById('b-v').value.split(',').map(Number);
                        const colors = document.getElementById('b-colors').value.split(',').map(s => s.trim());

                        // Update Code Overlay
                        document.getElementById('c-b-c').textContent = labels.map(l => `'${l}'`).join(', ');
                        document.getElementById('c-b-v').textContent = values.join(', ');
                        document.getElementById('c-b-colors').textContent = colors.map(c => `'${c}'`).join(', ');

                        if (chartInstance) {
                            chartInstance.data.labels = labels;
                            chartInstance.data.datasets[0].data = values;
                            chartInstance.data.datasets[0].backgroundColor = colors;
                            chartInstance.update();
                        } else {
                            initChart('chart-bar', {
                                type: 'bar',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        data: values,
                                        backgroundColor: colors,
                                        borderColor: 'black',
                                        borderWidth: 1.5,
                                        borderRadius: 0, // Matplotlib typical look
                                        barPercentage: 0.6,
                                        categoryPercentage: 1.0
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: false },
                                        title: { display: true, text: 'Cantidad de Frutas' }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            grid: { color: '#e2e8f0' },
                                            title: { display: true, text: 'Cantidad' }
                                        },
                                        x: {
                                            grid: { display: false },
                                            title: { display: true, text: 'Frutas' }
                                        }
                                    }
                                }
                            });
                        }
                    };
                    ['b-c', 'b-v', 'b-colors'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'barh', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-barh" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Barras Horizontales</h3>
                                <button id="hide-code-barh" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    proyectos = [<span id="c-bh-c" class="text-green-600 font-bold">'Proyecto A', 'Proyecto B', 'Proyecto C', 'Proyecto D'</span>]<br>
                                    avance = [<span id="c-bh-v" class="text-green-600 font-bold">45, 72, 38, 55</span>]<br><br>
                                    <span class="text-slate-400"># Usamos .barh() para orientación horizontal</span><br>
                                    plt.<span class="text-blue-600 font-bold">barh</span>(proyectos, avance, color='<span class="text-brand-accent font-bold">#06717e</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Avance Proyectos')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Barras Horizontales (.barh)</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Legibilidad de Categorías:</strong> El método <code class="bg-gray-100 px-1 rounded font-bold">plt.barh()</code> funciona igual que <code class="bg-gray-100 px-1 rounded">bar()</code>, pero intercambia los ejes.
                            </p>
                            <p>
                                Es especialmente útil cuando los nombres de las categorías son <strong>muy largos</strong>. Al invertir los ejes, las etiquetas se muestran verticalmente, mejorando la legibilidad.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3 shrink-0">
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Categorías (Eje Vertical)</label>
                                <input type="text" id="bh-c" value="Proyecto A, Proyecto B, Proyecto C, Proyecto D" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Valores (Longitud de Barra)</label>
                                <input type="text" id="bh-v" value="45, 72, 38, 55" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                        </div>

                        <button id="show-code-barh" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-barh"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-barh');
                    document.getElementById('show-code-barh').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-barh').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const labels = document.getElementById('bh-c').value.split(',').map(s => s.trim());
                        const values = document.getElementById('bh-v').value.split(',').map(Number);

                        // Update Code Overlay
                        document.getElementById('c-bh-c').textContent = labels.map(l => `'${l}'`).join(', ');
                        document.getElementById('c-bh-v').textContent = values.join(', ');

                        if (chartInstance) {
                            chartInstance.data.labels = labels;
                            chartInstance.data.datasets[0].data = values;
                            chartInstance.update();
                        } else {
                            initChart('chart-barh', {
                                type: 'bar',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        data: values,
                                        backgroundColor: '#06717e',
                                        borderRadius: 4
                                    }]
                                },
                                options: {
                                    indexAxis: 'y',
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        x: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                                        y: { grid: { display: false } }
                                    }
                                }
                            });
                        }
                    };
                    ['bh-c', 'bh-v'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'scatter-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Dispersión con plt.scatter()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de dispersión se crea en Matplotlib utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.scatter()</code>. Representa datos como puntos individuales en el plano cartesiano, sin unirlos.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Mostrar cómo se relacionan dos variables numéricas y detectar patrones entre ellas.</p>
                                <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Por ejemplo:</p>
                                <ul class="list-disc list-inside space-y-1 text-slate-700 ml-2">
                                    <li>Horas de estudio y nota obtenida.</li>
                                    <li>Edad y salario.</li>
                                </ul>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> contiene una variable numérica.
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene otra variable numérica asociada.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada punto representa una observación completa (un caso con ambos valores).</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Interpretación</h3>
                                <p>La distribución de los puntos permite observar si existe relación: si tienden a subir juntos, bajar o no mostrar un patrón claro.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos representan una evolución continua o una comparación de categorías, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-scatter-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-scatter-intro', {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            data: Array.from({ length: 40 }, () => ({
                                x: Math.random() * 10,
                                y: Math.random() * 10
                            })),
                            backgroundColor: '#0055ad',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                            x: { beginAtZero: true, grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'scatter', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-scatter" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Dispersión Avanzada</h3>
                                <button id="hide-code-scatter" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    x = [<span id="c-s-x" class="text-green-600 font-bold">1, 2, 3, 4, 5</span>]<br>
                                    y = [<span id="c-s-y" class="text-green-600 font-bold">10, 25, 15, 30, 20</span>]<br>
                                    tamaños = [<span id="c-s-s" class="text-green-600 font-bold">50, 200, 100, 400, 150</span>]<br>
                                    colores = [<span id="c-s-c" class="text-green-600 font-bold">'#FF6B6B', '#FFD93D', '#6BCB77', '#4D96FF', '#C77DFF'</span>]<br><br>
                                    plt.<span class="text-blue-600 font-bold">scatter</span>(x, y, <br>
                                    &nbsp;&nbsp;s=tamaños, <br>
                                    &nbsp;&nbsp;c=colores, <br>
                                    &nbsp;&nbsp;alpha=<span id="c-s-a" class="text-purple-600 font-bold">0.8</span>, <br>
                                    &nbsp;&nbsp;edgecolors='<span id="c-s-ec" class="text-pink-600 font-bold">black</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Gráfico de Dispersión')<br>
                                    plt.<span class="text-blue-600 font-bold">xlabel</span>('X')<br>
                                    plt.<span class="text-blue-600 font-bold">ylabel</span>('Y')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Personalización de .scatter()</h2>
                        
                        <div class="space-y-4 text-[13px] text-text-deep leading-relaxed shrink-0">
                            <p>
                                <code class="bg-gray-100 px-1 rounded font-bold text-xs">.scatter()</code> está diseñado para mostrar puntos individuales, por eso tiene parámetros que <code class="bg-gray-100 px-1 rounded text-xs">.plot()</code> no tiene:
                            </p>
                            <ul class="list-none space-y-1 ml-1 text-xs">
                                <li><span class="text-brand-accent font-bold">• s:</span> tamaño de cada punto. Acepta un valor o una lista.</li>
                                <li><span class="text-brand-accent font-bold">• c:</span> color de cada punto. Acepta una lista de colores.</li>
                                <li><span class="text-brand-accent font-bold">• alpha:</span> transparencia (0 a 1). Útil si hay superposición.</li>
                                <li><span class="text-brand-accent font-bold">• cmap:</span> mapa de colores para valores numéricos en <code class="bg-gray-100 px-0.5 rounded text-[10px]">c</code>.</li>
                                <li><span class="text-brand-accent font-bold">• edgecolors:</span> color del borde de cada punto.</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3 shrink-0">
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Puntos X</label>
                                    <input type="text" id="s-x" value="1, 2, 3, 4, 5" class="w-full border rounded text-[11px] p-1.5 outline-none">
                                </div>
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Puntos Y</label>
                                    <input type="text" id="s-y" value="10, 25, 15, 30, 20" class="w-full border rounded text-[11px] p-1.5 outline-none">
                                </div>
                            </div>
                            <div>
                                <label class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Tamaños (parámetro s)</label>
                                <input type="text" id="s-s" value="50, 200, 100, 400, 150" class="w-full border rounded text-[11px] p-1.5 outline-none">
                            </div>
                            <div>
                                <label class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Colores (parámetro c)</label>
                                <input type="text" id="s-c" value="#FF6B6B, #FFD93D, #6BCB77, #4D96FF, #C77DFF" class="w-full border rounded text-[11px] p-1.5 outline-none">
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Alpha</label>
                                    <input type="range" id="s-a" min="0" max="1" step="0.1" value="0.8" class="w-full h-2">
                                </div>
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Color Borde</label>
                                    <input type="text" id="s-ec" value="black" class="w-full border rounded text-[11px] p-1.5 outline-none">
                                </div>
                            </div>
                        </div>

                        <button id="show-code-scatter" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-sc"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-scatter');
                    document.getElementById('show-code-scatter').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-scatter').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const labelsX = document.getElementById('s-x').value.split(',').map(s => s.trim());
                        const valuesY = document.getElementById('s-y').value.split(',').map(Number);
                        const sizes = document.getElementById('s-s').value.split(',').map(Number);
                        const colors = document.getElementById('s-c').value.split(',').map(s => s.trim());
                        const alpha = document.getElementById('s-a').value;
                        const ec = document.getElementById('s-ec').value;

                        const data = labelsX.map((x, i) => ({ x: Number(x), y: valuesY[i] || 0 }));

                        // Helper to hex to rgba
                        const hexToRgba = (hex, a) => {
                            if (!hex.startsWith('#')) return hex;
                            const r = parseInt(hex.slice(1, 3), 16);
                            const g = parseInt(hex.slice(3, 5), 16);
                            const b = parseInt(hex.slice(5, 7), 16);
                            return `rgba(${r}, ${g}, ${b}, ${a})`;
                        };

                        const backgroundColors = colors.map(c => hexToRgba(c, alpha));

                        // Update Code Overlay
                        document.getElementById('c-s-x').textContent = labelsX.join(', ');
                        document.getElementById('c-s-y').textContent = valuesY.join(', ');
                        document.getElementById('c-s-s').textContent = sizes.join(', ');
                        document.getElementById('c-s-c').textContent = colors.map(c => `'${c}'`).join(', ');
                        document.getElementById('c-s-a').textContent = alpha;
                        document.getElementById('c-s-ec').textContent = ec;

                        if (chartInstance) {
                            chartInstance.data.datasets[0].data = data;
                            chartInstance.data.datasets[0].pointRadius = sizes.map(s => Math.sqrt(s));
                            chartInstance.data.datasets[0].backgroundColor = backgroundColors;
                            chartInstance.data.datasets[0].borderColor = ec;
                            chartInstance.update();
                        } else {
                            initChart('chart-sc', {
                                type: 'scatter',
                                data: {
                                    datasets: [{
                                        data: data,
                                        backgroundColor: backgroundColors,
                                        borderColor: ec,
                                        borderWidth: 1.5,
                                        pointRadius: sizes.map(s => Math.sqrt(s)),
                                        pointHoverRadius: sizes.map(s => Math.sqrt(s) + 2)
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: false },
                                        title: { display: true, text: 'Gráfico de Dispersión Personalizado' }
                                    },
                                    scales: {
                                        x: { type: 'linear', position: 'bottom', grid: { color: '#f1f5f9' }, title: { display: true, text: 'Eje X' } },
                                        y: { grid: { color: '#f1f5f9' }, title: { display: true, text: 'Eje Y' } }
                                    }
                                }
                            });
                        }
                    };
                    ['s-x', 's-y', 's-s', 's-c', 's-a', 's-ec'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'area-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Área con plt.fill_between()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de área se crea en Matplotlib utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.fill_between()</code>. Representa datos rellenando el espacio entre una línea y el eje X (u otra línea).
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Destacar visualmente la magnitud o acumulación de valores a lo largo de una secuencia.</p>
                                <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Por ejemplo:</p>
                                <ul class="list-disc list-inside space-y-1 text-slate-700 ml-2">
                                    <li>Consumo eléctrico diario.</li>
                                    <li>Ventas acumuladas en el mes.</li>
                                    <li>Cantidad de usuarios activos en el tiempo.</li>
                                </ul>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> define el orden o referencia (tiempo o secuencia).
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene los valores numéricos asociados.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">El área sombreada representa visualmente la cantidad comprendida entre los valores.</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Interpretación</h3>
                                <p>El relleno enfatiza cuánto representan los valores en conjunto, no solo los puntos individuales.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si solo se necesita observar puntos específicos o comparar categorías sin resaltar volumen o acumulación, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-area-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-area-intro', {
                    type: 'line',
                    data: {
                        labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
                        datasets: [{
                            data: [30, 45, 35, 60, 55, 80, 70],
                            borderColor: '#0055ad',
                            backgroundColor: 'rgba(0, 85, 173, 0.25)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                            x: { grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'area', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-area" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Área entre Curvas</h3>
                                <button id="hide-code-area" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    x = [<span id="c-ar-x" class="text-green-600 font-bold">1, 2, 3, 4</span>]<br>
                                    y_min = [<span id="c-ar-ymin" class="text-green-600 font-bold">10, 20, 15, 25</span>]<br>
                                    y_max = [<span id="c-ar-ymax" class="text-green-600 font-bold">30, 40, 35, 45</span>]<br><br>
                                    <span class="text-slate-400"># Relleno entre curvas</span><br>
                                    plt.<span class="text-blue-600 font-bold">fill_between</span>(x, y_min, y_max, <br>
                                    &nbsp;&nbsp;alpha=<span id="c-ar-a" class="text-purple-600 font-bold">0.3</span>, <br>
                                    &nbsp;&nbsp;color='<span id="c-ar-c" class="text-green-600 font-bold">#4D96FF</span>', <br>
                                    &nbsp;&nbsp;edgecolor='<span id="c-ar-ec" class="text-pink-600 font-bold">black</span>', <br>
                                    &nbsp;&nbsp;linewidth=<span id="c-ar-lw" class="text-purple-600 font-bold">1.5</span>, <br>
                                    &nbsp;&nbsp;label='<span id="c-ar-l" class="text-orange-600 font-bold">Rango</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Rango entre dos curvas')<br>
                                    plt.<span class="text-blue-600 font-bold">legend</span>()<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Personalización de .fill_between()</h2>
                        
                        <div class="space-y-4 text-xs text-text-deep leading-relaxed shrink-0">
                            <p>
                                <code class="bg-gray-100 px-1 rounded font-bold">.fill_between()</code> rellena el área entre dos curvas o entre una curva y el eje X:
                            </p>
                            <ul class="list-none space-y-1 ml-1">
                                <li><span class="text-brand-accent font-bold">• x:</span> valores horizontales (obligatorio).</li>
                                <li><span class="text-brand-accent font-bold">• y1:</span> curva o límite superior (obligatorio).</li>
                                <li><span class="text-brand-accent font-bold">• y2:</span> curva o límite inferior (defecto: 0).</li>
                                <li><span class="text-brand-accent font-bold">• alpha:</span> transparencia (0 a 1).</li>
                                <li><span class="text-brand-accent font-bold">• color:</span> color del área rellena.</li>
                                <li><span class="text-brand-accent font-bold">• edgecolor:</span> color del borde.</li>
                                <li><span class="text-brand-accent font-bold">• linewidth:</span> grosor del borde.</li>
                                <li><span class="text-brand-accent font-bold">• label:</span> identificación para la leyenda.</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-3 rounded-lg border border-border-light space-y-2 shrink-0">
                            <div class="grid grid-cols-1 gap-2">
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Valores X / Y_MIN (Eje Inferior)</label>
                                    <div class="flex gap-2">
                                        <input type="text" id="ar-x" value="1, 2, 3, 4" class="w-1/2 border rounded text-[10px] p-1 outline-none">
                                        <input type="text" id="ar-ymin" value="10, 20, 15, 25" class="w-1/2 border rounded text-[10px] p-1 outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Valores Y_MAX (Eje Superior)</label>
                                    <input type="text" id="ar-ymax" value="30, 40, 35, 45" class="w-full border rounded text-[10px] p-1 outline-none">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Color / Borde</label>
                                    <div class="flex gap-1">
                                        <input type="color" id="ar-c" value="#4D96FF" class="w-1/2 h-7 rounded p-0 border-none cursor-pointer">
                                        <input type="text" id="ar-ec" value="black" class="w-1/2 border rounded text-[10px] p-1 outline-none" placeholder="Borde">
                                    </div>
                                </div>
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Alpha / Grosor</label>
                                    <div class="flex gap-1">
                                        <input type="number" id="ar-a" value="0.3" step="0.1" min="0" max="1" class="w-1/2 border rounded text-[10px] p-1 outline-none">
                                        <input type="number" id="ar-lw" value="1.5" step="0.5" min="0" class="w-1/2 border rounded text-[10px] p-1 outline-none">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="text-[9px] font-bold text-slate-500 uppercase">Etiqueta (label)</label>
                                <input type="text" id="ar-l" value="Rango" class="w-full border rounded text-[10px] p-1 outline-none">
                            </div>
                        </div>

                        <button id="show-code-area" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative border border-slate-100">
                        <div class="w-full h-full relative">
                            <canvas id="chart-ar"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-area');
                    document.getElementById('show-code-area').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-area').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const xLabels = document.getElementById('ar-x').value.split(',').map(s => s.trim());
                        const ymin = document.getElementById('ar-ymin').value.split(',').map(Number);
                        const ymax = document.getElementById('ar-ymax').value.split(',').map(Number);
                        const a = parseFloat(document.getElementById('ar-a').value) || 0;
                        const c = document.getElementById('ar-c').value;
                        const ec = document.getElementById('ar-ec').value;
                        const lw = parseFloat(document.getElementById('ar-lw').value) || 0;
                        const l = document.getElementById('ar-l').value;

                        // Helper to hex to rgba
                        const hexToRgba = (hex, alpha) => {
                            if (!hex.startsWith('#')) return hex;
                            const r = parseInt(hex.slice(1, 3), 16);
                            const g = parseInt(hex.slice(3, 5), 16);
                            const b = parseInt(hex.slice(5, 7), 16);
                            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                        };

                        const rgba = hexToRgba(c, a);

                        // Update Code Overlay
                        document.getElementById('c-ar-x').textContent = xLabels.join(', ');
                        document.getElementById('c-ar-ymin').textContent = ymin.join(', ');
                        document.getElementById('c-ar-ymax').textContent = ymax.join(', ');
                        document.getElementById('c-ar-a').textContent = a;
                        document.getElementById('c-ar-c').textContent = c;
                        document.getElementById('c-ar-ec').textContent = ec;
                        document.getElementById('c-ar-lw').textContent = lw;
                        document.getElementById('c-ar-l').textContent = l;

                        if (chartInstance) {
                            chartInstance.data.labels = xLabels;
                            chartInstance.data.datasets[0].data = ymin;
                            chartInstance.data.datasets[1].data = ymax;
                            chartInstance.data.datasets[1].backgroundColor = rgba;
                            chartInstance.data.datasets[1].borderColor = ec === 'none' ? 'transparent' : ec;
                            chartInstance.data.datasets[1].borderWidth = lw;
                            chartInstance.data.datasets[1].label = l;
                            chartInstance.update();
                        } else {
                            initChart('chart-ar', {
                                type: 'line',
                                data: {
                                    labels: xLabels,
                                    datasets: [
                                        {
                                            label: 'Base',
                                            data: ymin,
                                            borderColor: 'transparent',
                                            pointRadius: 0,
                                            fill: false
                                        },
                                        {
                                            label: l,
                                            data: ymax,
                                            borderColor: ec === 'none' ? 'transparent' : ec,
                                            borderWidth: lw,
                                            backgroundColor: rgba,
                                            fill: 0,
                                            tension: 0,
                                            pointRadius: 0 // No dots as requested ("no se vea la recta")
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            display: true,
                                            position: 'top',
                                            onClick: null // Legend items are non-clickable
                                        },
                                        title: { display: true, text: 'Rango entre Curvas (.fill_between)' }
                                    },
                                    scales: {
                                        x: { grid: { color: '#f1f5f9' }, title: { display: true, text: 'X' } },
                                        y: { beginAtZero: false, grid: { color: '#f1f5f9' }, title: { display: true, text: 'Y' } }
                                    }
                                }
                            });
                        }
                    };
                    ['ar-x', 'ar-ymin', 'ar-ymax', 'ar-a', 'ar-c', 'ar-ec', 'ar-lw', 'ar-l'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'step-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico Escalonado con plt.step()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico escalonado se crea en Matplotlib utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.step()</code>. Representa datos mediante líneas horizontales y verticales que forman “escalones”.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Mostrar cambios que ocurren por intervalos o en momentos específicos, donde el valor se mantiene constante hasta el siguiente cambio.</p>
                                <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Por ejemplo:</p>
                                <ul class="list-disc list-inside space-y-1 text-slate-700 ml-2">
                                    <li>Tarifas que cambian por tramo de consumo.</li>
                                    <li>Estados de un sistema (activo/inactivo).</li>
                                </ul>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> define el orden o momento del cambio.
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene el valor que se mantiene hasta el siguiente punto.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada escalón representa un valor constante durante un intervalo.</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Interpretación</h3>
                                <p>El gráfico no muestra transición gradual, sino cambios abruptos entre niveles.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos cambian de manera continua y progresiva, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-step-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-step-intro', {
                    type: 'line',
                    data: {
                        labels: ['0', '1', '2', '3', '4', '5', '6'],
                        datasets: [{
                            data: [10, 15, 10, 20, 20, 25, 25],
                            borderColor: '#0055ad',
                            backgroundColor: 'transparent',
                            stepped: true,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#0055ad'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                            x: { grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'step', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-step" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Gráficos de Escalera</h3>
                                <button id="hide-code-step" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    dias = [<span id="c-st-x" class="text-green-600 font-bold">1, 2, 3, 4, 5, 6, 7</span>]<br>
                                    precio = [<span id="c-st-y" class="text-green-600 font-bold">100, 100, 120, 120, 95, 95, 110</span>]<br><br>
                                    plt.<span class="text-blue-600 font-bold">step</span>(dias, precio, <br>
                                    &nbsp;&nbsp;where='<span id="c-st-w" class="text-green-600 font-bold">post</span>', <br>
                                    &nbsp;&nbsp;color='<span id="c-st-c" class="text-green-600 font-bold">#4D96FF</span>', <br>
                                    &nbsp;&nbsp;linewidth=<span id="c-st-lw" class="text-purple-600 font-bold">2.5</span>, <br>
                                    &nbsp;&nbsp;linestyle='<span id="c-st-ls" class="text-pink-600 font-bold">-</span>', <br>
                                    &nbsp;&nbsp;label='<span id="c-st-l" class="text-orange-600 font-bold">Precio del producto</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Variación de Precio del Producto')<br>
                                    plt.<span class="text-blue-600 font-bold">xlabel</span>('Días')<br>
                                    plt.<span class="text-blue-600 font-bold">ylabel</span>('Precio ($)')<br>
                                    plt.<span class="text-blue-600 font-bold">legend</span>()<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Personalización de .step()</h2>
                        
                        <div class="space-y-4 text-xs text-text-deep leading-relaxed shrink-0">
                            <p>
                                <code class="bg-gray-100 px-1 rounded font-bold">.step()</code> muestra datos que cambian abruptamente, manteniendo el valor constante hasta el siguiente punto:
                            </p>
                            <ul class="list-none space-y-1 ml-1">
                                <li><span class="text-brand-accent font-bold">• x / y:</span> listas de valores (obligatorios).</li>
                                <li><span class="text-brand-accent font-bold">• where:</span> dónde ocurre el escalón ('pre', 'post', 'mid').</li>
                                <li><span class="text-brand-accent font-bold">• color:</span> color de la línea.</li>
                                <li><span class="text-brand-accent font-bold">• linewidth:</span> grosor de la línea.</li>
                                <li><span class="text-brand-accent font-bold">• linestyle:</span> estilo (sólida, punteada, etc).</li>
                                <li><span class="text-brand-accent font-bold">• label:</span> identificación para la leyenda.</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-3 rounded-lg border border-border-light space-y-2 shrink-0">
                            <div class="grid grid-cols-1 gap-2">
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Días (X) / Precio (Y)</label>
                                    <div class="flex gap-2">
                                        <input type="text" id="st-x" value="1, 2, 3, 4, 5, 6, 7" class="w-1/2 border rounded text-[10px] p-1 outline-none">
                                        <input type="text" id="st-y" value="100, 100, 120, 120, 95, 95, 110" class="w-1/2 border rounded text-[10px] p-1 outline-none">
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Transición (where) / Color</label>
                                    <div class="flex gap-1">
                                        <select id="st-w" class="w-1/2 border rounded text-[10px] p-1 outline-none bg-white">
                                            <option value="pre">pre</option>
                                            <option value="post" selected>post</option>
                                            <option value="mid">mid</option>
                                        </select>
                                        <input type="color" id="st-c" value="#4D96FF" class="w-1/2 h-7 rounded p-0 border-none cursor-pointer">
                                    </div>
                                </div>
                                <div>
                                    <label class="text-[9px] font-bold text-slate-500 uppercase">Grosor / Estilo</label>
                                    <div class="flex gap-1">
                                        <input type="number" id="st-lw" value="2.5" step="0.5" min="0" class="w-1/2 border rounded text-[10px] p-1 outline-none">
                                        <select id="st-ls" class="w-1/2 border rounded text-[10px] p-1 outline-none bg-white">
                                            <option value="-">- (Solid)</option>
                                            <option value="--">-- (Dashed)</option>
                                            <option value="-.">-. (Dashdot)</option>
                                            <option value=":">: (Dotted)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="text-[9px] font-bold text-slate-500 uppercase">Etiqueta (label)</label>
                                <input type="text" id="st-l" value="Precio del producto" class="w-full border rounded text-[10px] p-1 outline-none">
                            </div>
                        </div>

                        <button id="show-code-step" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-st"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-step');
                    document.getElementById('show-code-step').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-step').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const x = document.getElementById('st-x').value.split(',').map(s => s.trim());
                        const y = document.getElementById('st-y').value.split(',').map(Number);
                        const w = document.getElementById('st-w').value;
                        const c = document.getElementById('st-c').value;
                        const lw = parseFloat(document.getElementById('st-lw').value) || 0;
                        const ls = document.getElementById('st-ls').value;
                        const l = document.getElementById('st-l').value;

                        // Map where to Chart.js
                        const cjsW = w === 'pre' ? 'before' : (w === 'post' ? 'after' : 'middle');

                        // Map linestyle to borderDash
                        const dashMap = { '-': [], '--': [10, 5], '-.': [10, 5, 2, 5], ':': [3, 3] };
                        const dash = dashMap[ls] || [];

                        // Update Code Overlay
                        document.getElementById('c-st-x').textContent = x.join(', ');
                        document.getElementById('c-st-y').textContent = y.join(', ');
                        document.getElementById('c-st-w').textContent = w;
                        document.getElementById('c-st-c').textContent = c;
                        document.getElementById('c-st-lw').textContent = lw;
                        document.getElementById('c-st-ls').textContent = ls;
                        document.getElementById('c-st-l').textContent = l;

                        if (chartInstance) {
                            chartInstance.data.labels = x;
                            chartInstance.data.datasets[0].data = y;
                            chartInstance.data.datasets[0].stepped = cjsW;
                            chartInstance.data.datasets[0].borderColor = c;
                            chartInstance.data.datasets[0].borderWidth = lw;
                            chartInstance.data.datasets[0].borderDash = dash;
                            chartInstance.data.datasets[0].label = l;
                            chartInstance.update();
                        } else {
                            initChart('chart-st', {
                                type: 'line',
                                data: {
                                    labels: x,
                                    datasets: [{
                                        label: l,
                                        data: y,
                                        borderColor: c,
                                        borderWidth: lw,
                                        borderDash: dash,
                                        stepped: cjsW,
                                        pointRadius: 0, // Hidden points
                                        fill: false,
                                        tension: 0
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            display: true,
                                            position: 'top',
                                            onClick: null // Non-clickable
                                        },
                                        title: { display: true, text: 'Variación de Precio del Producto' }
                                    },
                                    scales: {
                                        y: { beginAtZero: false, grid: { color: '#f1f5f9' }, title: { display: true, text: 'Precio ($)' } },
                                        x: { grid: { color: '#f1f5f9' }, title: { display: true, text: 'Días' } }
                                    }
                                }
                            });
                        }
                    };
                    ['st-x', 'st-y', 'st-w', 'st-c', 'st-lw', 'st-ls', 'st-l'].forEach(id => {
                        const el = document.getElementById(id);
                        el.addEventListener(el.tagName === 'SELECT' ? 'change' : 'input', update);
                    });
                    update();
                }
            },
            {
                id: 'figsize-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text -->
                    <div class="md:w-1/2 space-y-5 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Entendiendo figsize</h2>
                        
                        <div class="space-y-4 text-xs md:text-sm leading-relaxed">
                            <p>
                                El parámetro <code class="bg-gray-100 px-1 rounded font-bold">figsize=(ancho, alto)</code> define el tamaño total del "lienzo" (figure) en pulgadas. 
                                Todos los gráficos creados dentro de la figura comparten ese mismo espacio.
                            </p>
                            <p class="text-slate-600 italic">
                                <strong>figsize</strong> no cambia los datos ni el tipo de gráfico. Solo controla cuánto espacio físico hay disponible para mostrarlos.
                            </p>

                            <div class="space-y-2">
                                <h3 class="text-base font-bold text-brand-primary border-b border-border-light pb-1">¿Qué controla?</h3>
                                <ul class="list-none space-y-2">
                                    <li class="bg-white p-2 rounded border border-border-light shadow-sm">
                                        <span class="text-brand-accent font-bold block">Ancho (Width) → Espacio horizontal total.</span>
                                        <span class="text-slate-500 text-xs">Afecta cuánto se “estiran” los gráficos hacia los lados.</span>
                                    </li>
                                    <li class="bg-white p-2 rounded border border-border-light shadow-sm">
                                        <span class="text-brand-accent font-bold block">Alto (Height) → Espacio vertical total.</span>
                                        <span class="text-slate-500 text-xs">Afecta cuánto espacio tienen títulos y ejes en altura.</span>
                                    </li>
                                </ul>
                            </div>

                             <div class="space-y-2">
                                <h3 class="text-base font-bold text-brand-primary border-b border-border-light pb-1">¿Por qué es importante?</h3>
                                <p>Cuando trabajas con múltiples gráficos (ej: 2x2), cada subplot recibe solo una parte del lienzo.</p>
                                <div class="grid grid-cols-2 gap-2 text-xs">
                                    <div class="bg-red-50 p-2 rounded text-red-800 border border-red-100">
                                        <strong>Si es pequeño:</strong><br>
                                        • Gráficos comprimidos.<br>
                                        • Etiquetas superpuestas.<br>
                                        • Lectura difícil.
                                    </div>
                                    <div class="bg-green-50 p-2 rounded text-green-800 border border-green-100">
                                        <strong>Si es adecuado:</strong><br>
                                        • Cada gráfico respira.<br>
                                        • Información clara.<br>
                                        • Legible.
                                    </div>
                                </div>
                            </div>

                            <div class="p-3 bg-amber-50 border-l-4 border-amber-400 text-amber-900 text-xs italic">
                                <strong>Advertencia:</strong> Si agregas muchos gráficos sin aumentar <code>figsize</code>, el problema no es el código, sino la falta de espacio. 
                            </div>

                            <div class="bg-surface-muted p-3 rounded-lg border border-border-light space-y-3">
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500 uppercase flex justify-between">Ancho (Pulgadas) <span id="val-w">8</span></label>
                                    <input type="range" id="size-w" min="4" max="14" value="8" step="0.5" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500 uppercase flex justify-between">Alto (Pulgadas) <span id="val-h">5</span></label>
                                    <input type="range" id="size-h" min="3" max="10" value="5" step="0.5" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-slate-100 rounded-xl p-4 flex items-center justify-center relative overflow-hidden border border-slate-200">
                        <div id="fig-container" class="bg-white shadow-lg border border-slate-300 transition-all duration-300 grid grid-cols-2 grid-rows-2 gap-1 p-1" style="width: 480px; height: 300px;">
                            <!-- Placeholder Charts representing a 2x2 grid -->
                            <div class="bg-blue-50 border border-blue-100 flex items-center justify-center text-[8px] text-blue-300">Plot 1</div>
                            <div class="bg-blue-50 border border-blue-100 flex items-center justify-center text-[8px] text-blue-300">Plot 2</div>
                            <div class="bg-blue-50 border border-blue-100 flex items-center justify-center text-[8px] text-blue-300">Plot 3</div>
                            <div class="bg-blue-50 border border-blue-100 flex items-center justify-center text-[8px] text-blue-300">Plot 4</div>
                        </div>
                        <div class="absolute bottom-2 right-2 text-[10px] text-slate-400 font-mono">Simulación Visual</div>
                    </div>
                </div>`,
                script: () => {
                    const wInput = document.getElementById('size-w');
                    const hInput = document.getElementById('size-h');
                    const container = document.getElementById('fig-container');
                    const valW = document.getElementById('val-w');
                    const valH = document.getElementById('val-h');

                    const update = () => {
                        const w = parseFloat(wInput.value);
                        const h = parseFloat(hInput.value);

                        valW.textContent = w;
                        valH.textContent = h;

                        // Increased Scale for visualization (60px per inch for fit)
                        container.style.width = `${w * 60}px`;
                        container.style.height = `${h * 60}px`;
                    };

                    wInput.addEventListener('input', update);
                    hInput.addEventListener('input', update);
                    update();
                }
            },
            {
                id: 'subplots-structure', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text -->
                    <div class="md:w-1/2 space-y-5 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Entendiendo plt.subplots()</h2>
                        
                        <div class="space-y-4 text-xs md:text-sm leading-relaxed">
                            <p>
                                <code class="bg-gray-100 px-1 rounded font-bold">fig, axes = plt.subplots()</code> es la forma moderna y recomendada para crear múltiples gráficos organizados dentro de un mismo lienzo.
                            </p>
                            <p class="text-slate-600">
                                En lugar de crear figuras separadas, permite dividir el espacio en una estructura clara y controlada.
                            </p>

                            <div class="space-y-2">
                                <h3 class="text-base font-bold text-brand-primary border-b border-border-light pb-1">¿Qué representa cada elemento?</h3>
                                <ul class="list-none space-y-2">
                                    <li class="bg-white p-2 rounded border border-border-light shadow-sm">
                                        <span class="text-brand-accent font-bold">fig</span> → El lienzo completo donde viven todos los gráficos.
                                    </li>
                                    <li class="bg-white p-2 rounded border border-border-light shadow-sm">
                                        <span class="text-brand-accent font-bold">axes</span> → Las áreas individuales donde se dibuja cada gráfico.
                                        <span class="block text-xs text-slate-500 mt-1">Cuando hay más de un gráfico, <code>axes</code> se organiza como una estructura indexable (por ejemplo, una matriz).</span>
                                    </li>
                                </ul>
                            </div>

                            <div class="space-y-2">
                                <h3 class="text-base font-bold text-brand-primary border-b border-border-light pb-1">¿Cómo se accede?</h3>
                                <p>Debes usar indexación con corchetes:</p>
                                <div class="flex gap-4">
                                    <code class="bg-gray-100 px-2 py-1 rounded font-bold text-blue-600">axes[0]</code>
                                    <code class="bg-gray-100 px-2 py-1 rounded font-bold text-blue-600">axes[0, 1]</code>
                                </div>
                                <p class="text-xs text-slate-500">Cada índice corresponde a una posición dentro de la grilla.</p>
                            </div>

                            <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-900 text-xs italic space-y-1">
                                <strong>Advertencias importantes:</strong>
                                <ul class="list-disc list-inside">
                                    <li>Si el índice no existe, se producirá un error.</li>
                                    <li>Crear múltiples <code>plt.figure()</code> genera gráficos separados y desorganizados.</li>
                                    <li><code>plt.subplots()</code> mantiene todo estructurado dentro de un mismo objeto.</li>
                                </ul>
                            </div>

                            <div class="bg-surface-muted p-4 rounded-lg border border-border-light">
                                <label class="text-[10px] font-bold text-slate-500 uppercase block mb-2">Estructura de Ejemplo</label>
                                <div class="flex gap-2">
                                    <button class="px-3 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50 focus:ring-2 focus:ring-brand-primary/50" onclick="updateStruct(1, 2)">1x2 (Fila)</button>
                                    <button class="px-3 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50 focus:ring-2 focus:ring-brand-primary/50" onclick="updateStruct(2, 1)">2x1 (Columna)</button>
                                    <button class="px-3 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50 focus:ring-2 focus:ring-brand-primary/50" onclick="updateStruct(2, 2)">2x2 (Grilla)</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-slate-100 rounded-xl p-8 flex items-center justify-center relative overflow-hidden border border-slate-200">
                        <div id="struct-container" class="bg-white shadow-lg border-2 border-slate-800 w-full max-w-[300px] aspect-square p-2 gap-2 grid">
                            <!-- Dynamic Content -->
                        </div>
                        <div class="absolute top-2 left-2 text-[10px] font-mono font-bold text-slate-800">fig (Canvas)</div>
                    </div>
                </div>`,
                script: () => {
                    window.updateStruct = (rows, cols) => {
                        const container = document.getElementById('struct-container');
                        container.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
                        container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                        container.innerHTML = '';

                        for (let r = 0; r < rows; r++) {
                            for (let c = 0; c < cols; c++) {
                                const div = document.createElement('div');
                                div.className = "bg-blue-50 border-2 border-dashed border-blue-300 rounded flex items-center justify-center text-blue-600 font-mono text-sm font-bold relative group hover:bg-blue-100 transition-colors cursor-default";

                                let label = "";
                                if (rows === 1 && cols === 1) label = "axes";
                                else if (rows === 1 || cols === 1) label = `axes[${Math.max(r, c)}]`;
                                else label = `axes[${r}, ${c}]`;

                                div.innerHTML = `<span class="group-hover:scale-110 transition-transform">${label}</span>`;
                                container.appendChild(div);
                            }
                        }
                    };
                    window.updateStruct(1, 2); // Default
                }
            },
            {
                id: 'subplots', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-3 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-subplots" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Subplots Dinámicos</h3>
                                <button id="hide-code-subplots" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg border shadow-inner bg-slate-50 font-mono text-xs p-4 flex-grow overflow-y-auto custom-scroll">
                                <div id="dynamic-code-subplots" class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <!-- Dynamic Code Generated Here -->
                                </div>
                            </div>
                        </div>

                        <h2 class="text-xl font-bold text-brand-primary shrink-0">Laboratorio de Subplots</h2>
                        <p class="text-[11px] text-text-deep leading-relaxed shrink-0 mb-1">
                            Configura la grilla del lienzo, ajusta el tamaño visual (figsize) y observa cómo se organizan los gráficos según el espacio disponible.
                        </p>
                        <div class="bg-surface-muted p-3 rounded-lg border border-border-light space-y-3 shrink-0">
                             <div class="flex justify-between items-center">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Configuración Grilla</label>
                                <div class="flex bg-slate-200 p-0.5 rounded-lg text-[9px] font-bold">
                                    <button id="mode-auto" class="px-2 py-1 rounded-md bg-white shadow-sm transition-all">AUTO</button>
                                    <button id="mode-manual" class="px-2 py-1 rounded-md text-slate-500 hover:text-slate-700 transition-all">MANUAL</button>
                                </div>
                             </div>

                             <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="text-[9px] font-bold text-slate-400 uppercase block mb-1">Filas</label>
                                    <select id="sp-rows" class="w-full border rounded text-xs p-1.5 focus:ring-2 focus:ring-brand-primary/20 outline-none bg-white">
                                        <option value="1" selected>1 Fila</option>
                                        <option value="2">2 Filas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-[9px] font-bold text-slate-400 uppercase block mb-1">Columnas</label>
                                    <select id="sp-cols" class="w-full border rounded text-xs p-1.5 focus:ring-2 focus:ring-brand-primary/20 outline-none bg-white">
                                        <option value="1">1 Col</option>
                                        <option value="2" selected>2 Cols</option>
                                        <option value="3">3 Cols</option>
                                    </select>
                                </div>
                             </div>

                             <!-- Manual Figsize Sliders (Hidden by default) -->
                             <div id="figsize-controls" class="hidden pt-2 border-t border-slate-200 space-y-2">
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500 uppercase flex justify-between">Ancho (Pulgadas) <span id="sp-val-w">10</span></label>
                                    <input type="range" id="sp-size-w" min="4" max="15" value="10" step="0.5" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500 uppercase flex justify-between">Alto (Pulgadas) <span id="sp-val-h">6</span></label>
                                    <input type="range" id="sp-size-h" min="2" max="10" value="6" step="0.5" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                                </div>
                             </div>
                        </div>

                        <div class="bg-surface-muted p-3 rounded-lg border border-border-light shrink-0">
                             <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider block mb-2 shrink-0">Contenido por Eje</label>
                             <div id="axes-controls" class="space-y-1.5 max-h-[180px] overflow-y-auto custom-scroll pr-1">
                                <!-- Per-axis type selectors here -->
                             </div>
                        </div>

                        <button id="show-code-subplots" class="shrink-0 w-full py-2.5 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2 text-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-slate-100 rounded-xl p-4 flex items-center justify-center relative overflow-hidden border border-slate-200">
                        <div id="subplots-container-outer" class="bg-white shadow-lg border border-slate-300 transition-all duration-300 overflow-hidden relative">
                            <div id="subplots-container" class="grid w-full h-full relative p-2" style="background: white;">
                                <!-- Dynamic Canvas Grid Here -->
                            </div>
                        </div>
                        <div class="absolute bottom-2 right-2 text-[10px] text-slate-300 font-mono italic">Previsualización de Figura</div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-subplots');
                    document.getElementById('show-code-subplots').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-subplots').addEventListener('click', () => overlay.classList.add('hidden'));

                    const rowsSel = document.getElementById('sp-rows');
                    const colsSel = document.getElementById('sp-cols');
                    const outerContainer = document.getElementById('subplots-container-outer');
                    const container = document.getElementById('subplots-container');
                    const controls = document.getElementById('axes-controls');
                    const codeDisplay = document.getElementById('dynamic-code-subplots');

                    const btnAuto = document.getElementById('mode-auto');
                    const btnManual = document.getElementById('mode-manual');
                    const figsizeControls = document.getElementById('figsize-controls');
                    const wInput = document.getElementById('sp-size-w');
                    const hInput = document.getElementById('sp-size-h');
                    const valW = document.getElementById('sp-val-w');
                    const valH = document.getElementById('sp-val-h');

                    let figsizeMode = 'auto'; // 'auto' or 'manual'

                    const toggleMode = (mode) => {
                        figsizeMode = mode;
                        if (mode === 'auto') {
                            btnAuto.className = "px-2 py-1 rounded-md bg-white shadow-sm transition-all";
                            btnManual.className = "px-2 py-1 rounded-md text-slate-500 hover:text-slate-700 transition-all";
                            figsizeControls.classList.add('hidden');
                        } else {
                            btnManual.className = "px-2 py-1 rounded-md bg-white shadow-sm transition-all";
                            btnAuto.className = "px-2 py-1 rounded-md text-slate-500 hover:text-slate-700 transition-all";
                            figsizeControls.classList.remove('hidden');
                        }
                        update();
                    };

                    btnAuto.addEventListener('click', () => toggleMode('auto'));
                    btnManual.addEventListener('click', () => toggleMode('manual'));

                    const colors = ['#0055ad', '#06717e', '#ff5722', '#6b21a8', '#059669', '#dc2626'];
                    const getChartData = (type, idx) => {
                        const variety = idx % 4;
                        const color = colors[idx % colors.length];
                        const alphaColor = color + '22';

                        if (type === 'line') {
                            const dataVarieties = [[10, 25, 15, 30, 20], [30, 10, 25, 5, 15], [5, 15, 5, 20, 10], [20, 25, 30, 25, 20]];
                            return { type: 'line', data: { labels: ['T1', 'T2', 'T3', 'T4', 'T5'], datasets: [{ data: dataVarieties[variety], borderColor: color, backgroundColor: alphaColor, tension: 0.3, fill: false, pointRadius: 4 }] } };
                        }
                        if (type === 'bar') {
                            const dataVarieties = [[15, 30, 20, 25], [35, 15, 25, 10], [10, 10, 40, 30], [25, 35, 15, 20]];
                            return { type: 'bar', data: { labels: ['A', 'B', 'C', 'D'], datasets: [{ data: dataVarieties[variety], backgroundColor: color, borderRadius: 4 }] } };
                        }
                        if (type === 'scatter') {
                            const dataVarieties = [[{ x: 1, y: 10 }, { x: 2, y: 22 }, { x: 3, y: 15 }, { x: 4, y: 28 }], [{ x: 1, y: 30 }, { x: 2, y: 12 }, { x: 3, y: 25 }, { x: 4, y: 8 }], [{ x: 1, y: 5 }, { x: 2, y: 8 }, { x: 3, y: 6 }, { x: 4, y: 12 }], [{ x: 1, y: 15 }, { x: 2, y: 15 }, { x: 3, y: 15 }, { x: 4, y: 15 }]];
                            return { type: 'scatter', data: { datasets: [{ data: dataVarieties[variety], backgroundColor: color, pointRadius: 6 }] }, options: { scales: { x: { type: 'linear', position: 'bottom' } } } };
                        }
                    };

                    const update = () => {
                        const R = parseInt(rowsSel.value);
                        const C = parseInt(colsSel.value);
                        const total = R * C;

                        const figW = figsizeMode === 'manual' ? parseFloat(wInput.value) : C * 5;
                        const figH = figsizeMode === 'manual' ? parseFloat(hInput.value) : R * 4;

                        valW.textContent = figW;
                        valH.textContent = figH;

                        // Scaling for visualization (45px per inch)
                        const scale = 60;
                        const visW = figW * scale;
                        const visH = figH * scale;

                        outerContainer.style.width = `${visW}px`;
                        outerContainer.style.height = `${visH}px`;

                        // Overlap Logic: Use negative gap/margin when size is small
                        const isSmallW = figW / C < 3.5;
                        const isSmallH = figH / R < 3;
                        const gap = (isSmallW || isSmallH) ? -12 : 10;

                        container.style.gridTemplateRows = `repeat(${R}, 1fr)`;
                        container.style.gridTemplateColumns = `repeat(${C}, 1fr)`;
                        container.style.gap = `${gap}px`;

                        const currentTypes = Array.from(controls.querySelectorAll('select')).map(s => s.value);
                        container.innerHTML = '';
                        controls.innerHTML = '';
                        subChartInstances.forEach(c => c.destroy());
                        subChartInstances = [];

                        let pythonCode = `<span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>`;
                        pythonCode += `<span class="text-slate-400"># Definimos la estructura ${R}x${C} y tamaño de figura</span><br>`;
                        pythonCode += `fig, axes = plt.<span class="text-blue-600 font-bold">subplots</span>(${R}, ${C}, figsize=(${figW}, ${figH}))<br><br>`;

                        for (let i = 0; i < total; i++) {
                            const type = currentTypes[i] || (i % 3 === 0 ? 'line' : (i % 3 === 1 ? 'bar' : 'scatter'));

                            const ctrlDiv = document.createElement('div');
                            ctrlDiv.className = "flex items-center gap-1.5";
                            ctrlDiv.innerHTML = `<label class="text-[8px] font-bold text-slate-400 w-10 shrink-0 italic">AX[${i}]</label>
                                                 <select class="axis-type flex-grow border rounded text-[10px] p-1 bg-white outline-none">
                                                    <option value="line" ${type === 'line' ? 'selected' : ''}>Línea</option>
                                                    <option value="bar" ${type === 'bar' ? 'selected' : ''}>Barras</option>
                                                    <option value="scatter" ${type === 'scatter' ? 'selected' : ''}>Disp.</option>
                                                 </select>`;
                            controls.appendChild(ctrlDiv);

                            const canvasDiv = document.createElement('div');
                            canvasDiv.className = "bg-white rounded border border-slate-200 relative p-1 h-full flex flex-col min-h-[40px] shadow-sm transition-all duration-300";
                            // Force some "identity" to overlapping boxes
                            canvasDiv.style.zIndex = 10 + i;
                            if (gap < 0) {
                                canvasDiv.style.boxShadow = "0 4px 12px rgba(0,0,0,0.15)";
                                canvasDiv.style.borderColor = "#94a3b8"; // Darker border when overlapping
                            }

                            canvasDiv.innerHTML = `<div class="absolute top-0 right-1 text-[9px] text-slate-400 font-bold font-mono">ax[${i}]</div>
                                                   <canvas id="c-dynamic-${i}" style="width:100%; height:100%"></canvas>`;
                            container.appendChild(canvasDiv);

                            const axisIndex = total === 1 ? 'axes' : (R === 1 || C === 1 ? `axes[${i}]` : `axes[${Math.floor(i / C)}, ${i % C}]`);
                            const method = type === 'line' ? 'plot' : (type === 'bar' ? 'bar' : 'scatter');
                            const colorName = colors[i % colors.length];

                            let dataStr = "";
                            const varIdx = i % 4;
                            if (type === 'line') { dataStr = `[${[[10, 25, 15, 30, 20], [30, 10, 25, 5, 15], [5, 15, 5, 20, 10], [20, 25, 30, 25, 20]][varIdx].join(', ')}]`; }
                            else if (type === 'bar') { dataStr = `['A','B','C','D'], [${[[15, 30, 20, 25], [35, 15, 25, 10], [10, 10, 40, 30], [25, 35, 15, 20]][varIdx].join(', ')}]`; }
                            else if (type === 'scatter') { const d = [[{ x: 1, y: 10 }, { x: 2, y: 22 }, { x: 3, y: 15 }, { x: 4, y: 28 }], [{ x: 1, y: 30 }, { x: 2, y: 12 }, { x: 3, y: 25 }, { x: 4, y: 8 }], [{ x: 1, y: 5 }, { x: 2, y: 8 }, { x: 3, y: 6 }, { x: 4, y: 12 }], [{ x: 1, y: 15 }, { x: 2, y: 15 }, { x: 3, y: 15 }, { x: 4, y: 15 }]][varIdx]; dataStr = `[${d.map(p => p.x).join(',')}], [${d.map(p => p.y).join(',')}]`; }

                            pythonCode += `<span class="text-slate-400"># Plot ${i + 1}</span><br>${axisIndex}.<span class="text-blue-600 font-bold">${method}</span>(${dataStr}, color='${colorName}')<br><br>`;
                        }

                        pythonCode += `plt.tight_layout()<br>plt.show()`;
                        codeDisplay.innerHTML = pythonCode;
                        controls.querySelectorAll('.axis-type').forEach(s => s.addEventListener('change', update));

                        setTimeout(() => {
                            const axisSelects = controls.querySelectorAll('.axis-type');
                            for (let i = 0; i < total; i++) {
                                const type = axisSelects[i].value;
                                const config = getChartData(type, i);
                                config.options = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: config.options?.scales || { y: { display: false }, x: { display: false } } };
                                const canvas = document.getElementById(`c-dynamic-${i}`);
                                if (canvas) subChartInstances.push(new Chart(canvas, config));
                            }
                        }, 50);
                    };

                    rowsSel.addEventListener('change', update);
                    colsSel.addEventListener('change', update);
                    wInput.addEventListener('input', update);
                    hInput.addEventListener('input', update);
                    update();
                }
            },
            {
                id: 'end', render: () => `
                <div class="flex flex-col h-full bg-white px-8 py-12">
                    <div class="flex-grow flex flex-col items-center justify-center text-center space-y-4">
                        <div class="w-16 h-16 border-2 border-brand-primary text-brand-primary rounded-full flex items-center justify-center mb-4">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        
                        <div class="space-y-1">
                            <h2 class="text-slate-400 font-bold uppercase tracking-[0.15em] text-xs">Fin Unidad 3</h2>
                            <h1 class="text-4xl font-bold text-slate-900 tracking-tight">Módulo 01: <span class="text-brand-primary">pyplot</span></h1>
                            <p class="text-lg text-slate-500">Introducción práctica a matplotlib.pyplot</p>
                        </div>

                        <div class="flex gap-4 pt-6">
                            <button onclick="goToSlide(0)" class="px-8 py-2 border border-slate-300 text-slate-600 rounded-lg hover:bg-slate-50 transition-all font-bold text-sm">Reiniciar Módulo</button>
                        </div>
                    </div>

                    <!-- Simplified Footer -->
                    <div class="mt-auto pt-6 border-t border-slate-100 flex justify-between items-center text-slate-600">
                        <div class="text-left">
                            <span class="block text-sm font-bold text-slate-800">Universidad de Valparaíso</span>
                            <span class="text-[10px] uppercase font-bold tracking-widest opacity-60">Escuela de Ingeniería Civil</span>
                        </div>

                        <div class="text-right">
                            <span class="block text-[11px] font-bold uppercase tracking-widest text-brand-primary">Programación 1 | PRO121</span>
                            <span class="text-[10px] italic">Unidad 3: pyplot (Finalizado)</span>
                        </div>
                    </div>
                </div>`
            }
        ];

        function renderSlide(idx) {
            if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
            subChartInstances.forEach(c => c.destroy()); subChartInstances = [];
            const d = slides[idx];
            document.getElementById('slide-container').innerHTML = d.render();
            if (d.script) setTimeout(d.script, 0);
            document.getElementById('slide-counter').textContent = `Diapositiva ${idx + 1} de ${slides.length}`;
            document.getElementById('prev-btn').disabled = idx === 0;
            document.getElementById('next-btn').disabled = idx === slides.length - 1;
        }

        window.nextSlide = () => { if (currentSlide < slides.length - 1) renderSlide(++currentSlide); };
        window.prevSlide = () => { if (currentSlide > 0) renderSlide(--currentSlide); };
        window.goToSlide = (idx) => { currentSlide = idx; renderSlide(idx); };
        document.getElementById('next-btn').addEventListener('click', window.nextSlide);
        document.getElementById('prev-btn').addEventListener('click', window.prevSlide);
        document.addEventListener('keydown', e => { if (e.key === 'ArrowRight') window.nextSlide(); if (e.key === 'ArrowLeft') window.prevSlide(); });

        // Global Chart Init Helper
        function initChart(canvasId, config) {
            const el = document.getElementById(canvasId);
            if (!el) return;
            const ctx = el.getContext('2d');
            chartInstance = new Chart(ctx, config);
        }

        // Init
        renderSlide(0);
    </script>
</body>

</html>