<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 01: Gráficos Matemáticos con pyplot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        surface: { main: '#ffffff', muted: '#f1f5f9', dark: '#0f6cbf' },
                        brand: { primary: '#003c58', accent: '#06717e' },
                        action: { default: '#0055ad', hover: '#399be2' },
                        text: { sky: '#6ea2ee', muted: '#6da8e9', deep: '#1e293b' },
                        border: { light: '#e2e8f0' }
                    },
                    fontFamily: { mono: ['Courier New', 'Consolas', 'monospace'] }
                }
            }
        }
    </script>
    <style>
        .code-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .code-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .code-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #0055ad;
            cursor: pointer;
            margin-top: -6px;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
    </style>
</head>

<body class="bg-surface-main text-text-deep font-sans min-h-screen flex flex-col overflow-hidden">
    <main id="app" class="flex-grow flex flex-col relative h-screen">
        <div id="slide-container" class="flex-grow flex flex-col p-4 md:px-8 md:pt-4 md:pb-20 overflow-y-auto"></div>
        <footer
            class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur border-t border-border-light p-4 flex justify-between items-center z-50">
            <button id="prev-btn"
                class="px-4 py-2 bg-slate-200 text-slate-600 rounded hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed font-medium">&larr;
                Anterior</button>
            <span class="text-text-muted text-sm font-medium" id="slide-counter">Diapositiva 1 de 13</span>
            <button id="next-btn"
                class="px-4 py-2 bg-action-default text-white rounded hover:bg-action-hover disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-sm">Siguiente
                &rarr;</button>
        </footer>
    </main>
    <script>
        let currentSlide = 0;
        let chartInstance = null;
        let subChartInstances = [];

        const slides = [
            {
                id: 'intro', render: () => `
                <div class="flex flex-col items-center justify-center h-full text-center space-y-4">
                    <div class="w-20 h-20 bg-brand-primary/10 rounded-full flex items-center justify-center mb-2">
                        <svg class="w-10 h-10 text-brand-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                    </div>
                    <div class="space-y-1">
                        <h3 class="text-base font-bold text-brand-accent uppercase tracking-widest">Unidad 3</h3>
                        <h1 class="text-4xl md:text-5xl font-extrabold text-brand-primary">Módulo 01: pyplot</h1>
                    </div>
                    <h2 class="text-xl md:text-2xl text-text-deep font-semibold max-w-2xl">Introducción práctica a matplotlib.pyplot</h2>
                    <p class="text-text-deep/80 max-w-lg text-lg">Aprende a crear gráficos de líneas, barras, dispersión y más de forma interactiva.</p>
                    <button onclick="nextSlide()" class="mt-6 px-10 py-4 bg-action-default text-white rounded-xl hover:bg-action-hover shadow-xl font-bold text-lg transition-transform hover:scale-105 active:scale-95">Comenzar</button>
                </div>`
            },
            {
                id: 'what-is', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8">
                    <div class="md:w-1/2 space-y-6 flex flex-col justify-center text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">¿Qué es pyplot?</h2>
                        <div class="space-y-4">
                            <p class="text-lg leading-relaxed">
                                <code class="bg-gray-100 px-2 py-1 rounded text-brand-accent font-bold">pyplot</code> es un sub-módulo de <span class="font-bold">Matplotlib</span> diseñado para crear gráficos de forma secuencial.
                            </p>
                            <p class="text-lg leading-relaxed">
                                Funciona como una <strong>máquina de estados</strong>: cada comando sobre <code class="font-mono text-brand-primary">plt</code> modifica la figura actual agregando líneas, etiquetas o títulos.
                            </p>
                        </div>
                        
                        <div class="rounded-lg overflow-hidden border border-border-light shadow-sm bg-white font-mono text-sm mt-4">
                            <div class="bg-gray-100 px-4 py-2 flex gap-2 border-b border-gray-200">
                                <div class="w-3 h-3 rounded-full bg-red-400"></div>
                                <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                                <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            </div>
                            <div class="p-4 overflow-x-auto code-scroll">
                                <div class="text-gray-400 mb-1"># Importamos y definimos datos</div>
                                <div><span class="text-blue-600">import</span> matplotlib.pyplot <span class="text-blue-600">as</span> plt</div>
                                <div>datos = [10, 20, 15, 30, 25]</div>
                                <br>
                                <div class="text-gray-400 mb-1"># Trazamos y agregamos eje Y</div>
                                <div>plt.<span class="text-blue-600">plot</span>(datos)</div>
                                <div>plt.<span class="text-blue-600">ylabel</span>(<span class="text-green-600">'Valores'</span>)</div>
                                <div>plt.<span class="text-blue-600">show</span>()</div>
                            </div>
                        </div>
                    </div>
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-[350px] relative">
                            <canvas id="chart-basic"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-basic', {
                    type: 'line',
                    data: {
                        labels: [0, 1, 2, 3, 4],
                        datasets: [{
                            label: 'Datos Generales',
                            data: [10, 20, 15, 30, 25],
                            borderColor: '#0055ad',
                            backgroundColor: 'rgba(0, 85, 173, 0.1)',
                            borderWidth: 3,
                            pointRadius: 6,
                            pointBackgroundColor: '#0055ad',
                            tension: 0.2,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { display: true, title: { display: true, text: 'Valores', font: { size: 14, weight: 'bold' } }, grid: { color: '#e2e8f0' } },
                            x: { grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'workflow', render: () => `
                <div class="flex flex-col h-full space-y-8">
                    <div class="text-center space-y-2">
                        <h2 class="text-3xl font-bold text-brand-primary">El Ciclo de Vida de un Gráfico</h2>
                        <p class="text-lg text-text-deep/80">Crear una visualización en <code class="font-mono">pyplot</code> sigue siempre un orden lógico de 5 pasos.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 relative">
                        <!-- Step 1 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">1</div>
                            <h3 class="font-bold text-brand-primary">Importar</h3>
                            <p class="text-xs text-text-deep">Traer el submódulo <code class="text-brand-accent">plt</code>.</p>
                        </div>
                        <!-- Step 2 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">2</div>
                            <h3 class="font-bold text-brand-primary">Datos</h3>
                            <p class="text-xs text-text-deep">Definir listas para los ejes <code class="text-brand-accent">X</code> e <code class="text-brand-accent">Y</code>.</p>
                        </div>
                        <!-- Step 3 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">3</div>
                            <h3 class="font-bold text-brand-primary">Trazar</h3>
                            <p class="text-xs text-text-deep">Usar <code class="text-blue-600">.plot()</code> para cargar los datos.</p>
                        </div>
                        <!-- Step 4 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-primary text-white rounded-full flex items-center justify-center font-bold">4</div>
                            <h3 class="font-bold text-brand-primary">Configurar</h3>
                            <p class="text-xs text-text-deep">Añadir títulos, etiquetas y estilos.</p>
                        </div>
                        <!-- Step 5 -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm flex flex-col items-center text-center space-y-3 z-10">
                            <div class="w-10 h-10 bg-brand-accent text-white rounded-full flex items-center justify-center font-bold">5</div>
                            <h3 class="font-bold text-brand-primary">Mostrar</h3>
                            <p class="text-xs text-text-deep">Ejecutar <code class="text-blue-600">.show()</code> para ver el resultado.</p>
                        </div>
                        <!-- Connector line (desktop only) -->
                        <div class="hidden md:block absolute top-1/2 left-0 right-0 h-0.5 bg-border-light -translate-y-12 z-0"></div>
                    </div>

                    <div class="rounded-lg overflow-hidden border border-border-light shadow-md bg-white font-mono text-sm max-w-2xl mx-auto w-full">
                        <div class="bg-slate-800 px-4 py-2 flex gap-2">
                            <div class="w-3 h-3 rounded-full bg-red-400"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                            <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            <span class="text-slate-400 text-xs ml-2">script.py</span>
                        </div>
                        <div class="p-6 space-y-2 bg-slate-900 text-slate-300">
                            <div><span class="text-pink-400">import</span> matplotlib.pyplot <span class="text-pink-400">as</span> plt <span class="text-slate-500 italic ml-4"># 1. Importar</span></div>
                            <br>
                            <div>xParams = [<span class="text-purple-400">1, 2, 3</span>] <span class="text-slate-500 italic ml-4"># 2. Datos</span></div>
                            <div>yParams = [<span class="text-purple-400">10, 20, 15</span>]</div>
                            <br>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">plot</span>(xParams, yParams) <span class="text-slate-500 italic ml-4"># 3. Trazar</span></div>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">title</span>(<span class="text-green-400">'Mi Gráfico'</span>) <span class="text-slate-500 italic ml-4"># 4. Configurar</span></div>
                            <div><span class="text-blue-400">plt</span>.<span class="text-yellow-200">show</span>() <span class="text-slate-500 italic ml-4 text-brand-accent font-bold"># 5. Mostrar</span></div>
                        </div>
                    </div>
                </div>`
            },
            {
                id: 'chart-types', render: () => `
                <div class="flex flex-col h-full space-y-6">
                    <div class="text-center space-y-2">
                        <h2 class="text-3xl font-bold text-brand-primary">Variedad de Gráficos</h2>
                        <p class="text-lg text-text-deep/80 text-balance max-w-2xl mx-auto">
                            Pyplot permite cambiar radicalmente la visualización simplemente llamando a un método distinto bajo la sintaxis <code class="font-mono text-brand-accent font-bold">plt.metodo()</code>.
                        </p>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 flex-grow overflow-y-auto custom-scroll p-1 content-center">
                        <!-- plot -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-blue-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.plot()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Líneas</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">El más común. Ideal para mostrar tendencias y cambios a lo largo del tiempo o de una secuencia numérica.</p>
                        </div>
                        <!-- bar -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-teal-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.bar()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Barras</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Perfecto para comparar cantidades o magnitudes entre diferentes categorías discretas.</p>
                        </div>
                        <!-- barh -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-indigo-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.barh()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Barras Horizontales</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Útil cuando los nombres de las categorías son largos o para mostrar rankings de mayor a menor.</p>
                        </div>
                        <!-- scatter -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-orange-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.scatter()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Dispersión</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Muestra la relación o correlación entre dos variables numéricas mediante puntos aislados.</p>
                        </div>
                        <!-- fill_between -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-cyan-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.fill_between()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Área</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Rellena el espacio bajo una línea. Ideal para resaltar volúmenes acumulados o áreas de interés.</p>
                        </div>
                        <!-- step -->
                        <div class="bg-white border border-border-light p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border-t-4 border-t-purple-500">
                            <div class="text-brand-primary font-bold text-lg mb-1 italic">.step()</div>
                            <div class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-tight">Gráfico de Escalones</div>
                            <p class="text-[11px] text-slate-600 leading-relaxed">Muestra cambios que ocurren en puntos específicos del tiempo, como señales o stock.</p>
                        </div>
                    </div>
                </div>`
            },
            {
                id: 'data-input', render: () => `
                <div class="flex flex-col md:flex-row gap-6 min-h-0">
                    <div class="md:w-2/5 space-y-6 flex flex-col">
                        <h2 class="text-2xl font-bold text-brand-primary">Datos a graficar</h2>
                        <div class="space-y-3">
                            <p class="text-base leading-relaxed text-text-deep">
                                En <code class="bg-gray-100 px-1 rounded">pyplot</code>, los datos se pasan como listas o arreglos. El <strong>eje X</strong> suele representar categorías o tiempo, mientras que el <strong>eje Y</strong> contiene los valores numéricos correspondientes.
                            </p>
                            <div class="p-3 bg-amber-50 border-l-4 border-amber-400 rounded text-sm text-amber-800 italic">
                                <strong>Importante:</strong> Ambas listas deben tener exactamente la misma longitud.
                            </div>
                        </div>

                        <div class="space-y-4 bg-white p-4 rounded-lg border border-border-light shadow-sm">
                            <div>
                                <label class="flex justify-between text-sm font-semibold mb-1">
                                    <span>Eje X (Categorías)</span>
                                    <span id="size-x-container" class="text-xs transition-colors">Cant: <span id="size-x">5</span></span>
                                </label>
                                <input type="text" id="input-x" value="1, 2, 3, 4, 5" class="w-full p-2 border rounded font-mono text-sm focus:ring-2 focus:ring-action-default outline-none">
                            </div>
                            <div>
                                <label class="flex justify-between text-sm font-semibold mb-1">
                                    <span>Eje Y (Valores)</span>
                                    <span id="size-y-container" class="text-xs transition-colors">Cant: <span id="size-y">5</span></span>
                                </label>
                                <input type="text" id="input-y" value="2, 3, 5, 7, 11" class="w-full p-2 border rounded font-mono text-sm focus:ring-2 focus:ring-action-default outline-none">
                            </div>
                        </div>

                        <!-- Inline Code Block (Slide 6 Style) -->
                        <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 shrink-0 custom-scroll">
                            <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                x = [<span id="code-x" class="text-green-600 font-bold">1, 2, 3, 4, 5</span>]<br>
                                y = [<span id="code-y" class="text-green-600 font-bold">2, 3, 5, 7, 11</span>]<br><br>
                                plt.<span class="text-blue-600 font-bold">plot</span>(x, y)<br>
                                plt.<span class="text-blue-600 font-bold">show</span>()
                            </div>
                        </div>
                    </div>
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-6 flex items-center justify-center min-h-[350px] relative self-start md:self-stretch">
                        <div class="w-full h-full relative">
                            <canvas id="chart-data"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const ctx = document.getElementById('chart-data').getContext('2d');
                    const updateData = () => {
                        const valX = document.getElementById('input-x').value.split(',').filter(s => s.trim() !== "").map(s => s.trim());
                        const valY = document.getElementById('input-y').value.split(',').filter(s => s.trim() !== "").map(s => parseFloat(s.trim()));

                        const lenX = valX.length;
                        const lenY = valY.length;

                        // UI Feedback
                        const szX = document.getElementById('size-x');
                        const szY = document.getElementById('size-y');
                        const contX = document.getElementById('size-x-container');
                        const contY = document.getElementById('size-y-container');

                        szX.textContent = lenX;
                        szY.textContent = lenY;

                        if (lenX !== lenY) {
                            contX.classList.add('text-red-500', 'font-bold');
                            contY.classList.add('text-red-500', 'font-bold');
                        } else {
                            contX.classList.remove('text-red-500', 'font-bold');
                            contY.classList.remove('text-red-500', 'font-bold');
                            contX.classList.add('text-text-muted');
                            contY.classList.add('text-text-muted');
                        }

                        // Update Code
                        document.getElementById('code-x').textContent = valX.join(', ');
                        document.getElementById('code-y').textContent = valY.filter(n => !isNaN(n)).join(', ');

                        if (lenX > 0 && lenY > 0 && lenX === lenY) {
                            if (chartInstance) {
                                chartInstance.data.labels = valX;
                                chartInstance.data.datasets[0].data = valY;
                                chartInstance.update('none');
                            } else {
                                initChart('chart-data', {
                                    type: 'line',
                                    data: {
                                        labels: valX,
                                        datasets: [{
                                            label: 'Valores',
                                            data: valY,
                                            borderColor: '#0055ad',
                                            borderWidth: 3,
                                            pointRadius: 5,
                                            tension: 0.1,
                                            fill: false
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: { legend: { display: false } },
                                        scales: {
                                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                                            x: { grid: { color: '#e2e8f0' } }
                                        }
                                    }
                                });
                            }
                        }
                    };
                    document.getElementById('input-x').addEventListener('input', updateData);
                    document.getElementById('input-y').addEventListener('input', updateData);
                    updateData();
                }
            },
            {
                id: 'line-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Líneas — plt.plot()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de líneas representa datos conectando puntos mediante segmentos rectos.
                                Se utiliza para mostrar cómo cambian los valores en un orden específico.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Visualizar evolución o tendencia, especialmente a lo largo del tiempo o en secuencias lógicas.</p>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <p>Cada punto del gráfico representa un par de valores:</p>
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> representa el orden (tiempo, etapas o secuencia).
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene los valores numéricos asociados.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada punto corresponde a un par (X, Y).</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Continuidad</h3>
                                <p>Al conectar los puntos se asume que existe una relación continua entre ellos, permitiendo observar tendencias generales.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos no representan algo continuo, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-line-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-line-intro', {
                    type: 'line',
                    data: {
                        labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                        datasets: [{
                            data: [12, 19, 15, 25, 22, 30],
                            borderColor: '#0055ad',
                            borderWidth: 4,
                            pointRadius: 6,
                            pointBackgroundColor: '#fff',
                            pointBorderWidth: 3,
                            tension: 0.3,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { grid: { color: '#e2e8f0' }, ticks: { font: { weight: 'bold' } } },
                            x: { grid: { color: '#e2e8f0' }, ticks: { font: { weight: 'bold' } } }
                        }
                    }
                })
            },
            {
                id: 'plot-params', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls (Scrollable) -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay (Hidden by default) -->
                        <div id="code-overlay" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código Generado</h3>
                                <button id="hide-code" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    x = [1, 2, 3, 4, 5]<br>
                                    y = [5, 15, 10, 25, 20]<br><br>
                                    plt.<span class="text-blue-600 font-bold">plot</span>(x, y, <br>
                                    &nbsp;&nbsp;color='<span id="c-color" class="text-green-600 font-bold">blue</span>', <br>
                                    &nbsp;&nbsp;marker='<span id="c-marker" class="text-orange-600 font-bold">o</span>', <br>
                                    &nbsp;&nbsp;linestyle='<span id="c-style" class="text-orange-600 font-bold">-</span>', <br>
                                    &nbsp;&nbsp;linewidth=<span id="c-lw" class="text-purple-600 font-bold">3</span>, <br>
                                    &nbsp;&nbsp;markersize=<span id="c-ms" class="text-purple-600 font-bold">10</span>)<br><br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Personalización con .plot()</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Definición:</strong> Un <strong>gráfico de línea</strong> conecta puntos de datos con una línea continua sobre un plano cartesiano.
                            </p>
                            <p>
                                Usamos <code class="bg-gray-100 px-1 rounded font-bold">plt.plot(x, y, ...)</code>. Solo las listas <strong>X e Y son obligatorias</strong>; el resto permite estilizar el gráfico.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3 shrink-0">
                            <div class="grid grid-cols-2 gap-3">
                                <div><label class="text-xs font-semibold block mb-1">Color</label><select id="p-color" class="w-full border rounded text-sm p-1"><option value="#0055ad">blue</option><option value="#ef4444">red</option><option value="#22c55e">green</option><option value="#a855f7">purple</option></select></div>
                                <div><label class="text-xs font-semibold block mb-1">Marker</label><select id="p-marker" class="w-full border rounded text-sm p-1"><option value="circle">o (Círculo)</option><option value="rect">s (Cuadrado)</option><option value="triangle">^ (Triángulo)</option><option value="star">★ (Estrella)</option></select></div>
                            </div>
                            <div><label class="text-xs font-semibold block mb-1">Linestyle</label><select id="p-style" class="w-full border rounded text-sm p-1"><option value="solid">- (Sólido)</option><option value="dashed">-- (Dashed)</option><option value="dotted">: (Dotted)</option></select></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-xs font-semibold flex justify-between text-[10px]">Linewidth: <span id="v-lw">3</span></label><input type="range" id="p-lw" min="1" max="10" value="3" class="w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer"></div>
                                <div><label class="text-xs font-semibold flex justify-between text-[10px]">Markersize: <span id="v-ms">10</span></label><input type="range" id="p-ms" min="2" max="25" value="10" class="w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer"></div>
                            </div>
                        </div>

                        <button id="show-code" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm transition-all flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization (Fixed Height on Mobile, Flexible on Desktop) -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-params"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay');
                    document.getElementById('show-code').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const color = document.getElementById('p-color').value;
                        const marker = document.getElementById('p-marker').value;
                        const style = document.getElementById('p-style').value;
                        const lw = document.getElementById('p-lw').value;
                        const ms = document.getElementById('p-ms').value;

                        // UI Update
                        document.getElementById('v-lw').textContent = lw;
                        document.getElementById('v-ms').textContent = ms;
                        document.getElementById('c-lw').textContent = lw;
                        document.getElementById('c-ms').textContent = ms;

                        document.getElementById('c-color').textContent = document.getElementById('p-color').options[document.getElementById('p-color').selectedIndex].text;
                        document.getElementById('c-marker').textContent = marker === 'circle' ? 'o' : (marker === 'rect' ? 's' : (marker === 'triangle' ? '^' : '*'));
                        document.getElementById('c-style').textContent = style === 'solid' ? '-' : (style === 'dashed' ? '--' : ':');

                        const lDash = style === 'dashed' ? [10, 5] : (style === 'dotted' ? [2, 2] : []);

                        if (chartInstance) {
                            chartInstance.data.datasets[0].borderColor = color;
                            chartInstance.data.datasets[0].backgroundColor = color;
                            chartInstance.data.datasets[0].pointBackgroundColor = color;
                            chartInstance.data.datasets[0].pointBorderColor = color;
                            chartInstance.data.datasets[0].pointStyle = marker;
                            chartInstance.data.datasets[0].borderDash = lDash;
                            chartInstance.data.datasets[0].borderWidth = parseInt(lw);
                            chartInstance.data.datasets[0].pointRadius = parseInt(ms);
                            chartInstance.data.datasets[0].pointHoverRadius = parseInt(ms) + 2;
                            chartInstance.update();
                        } else {
                            initChart('chart-params', {
                                type: 'line',
                                data: {
                                    labels: [1, 2, 3, 4, 5],
                                    datasets: [{
                                        data: [5, 15, 10, 25, 20],
                                        borderColor: color,
                                        backgroundColor: color,
                                        pointStyle: marker,
                                        pointRadius: parseInt(ms),
                                        borderDash: lDash,
                                        borderWidth: parseInt(lw),
                                        fill: false
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        y: { grid: { color: '#e2e8f0' } },
                                        x: { grid: { color: '#e2e8f0' } }
                                    }
                                }
                            });
                        }
                    };
                    ['p-color', 'p-marker', 'p-style', 'p-lw', 'p-ms'].forEach(id => {
                        document.getElementById(id).addEventListener('input', update);
                    });
                    update();
                }
            },
            {
                id: 'labels', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Títulos y Etiquetas</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Importancia Contextual:</strong> Un gráfico sin etiquetas es solo una línea sin significado. Los títulos y etiquetas de los ejes (labels) proporcionan el contexto necesario para interpretar qué datos estamos observando.
                            </p>
                            <ul class="space-y-2 text-xs">
                                <li><strong class="text-brand-accent">plt.title():</strong> Define el título principal de la visualización.</li>
                                <li><strong class="text-brand-accent">plt.xlabel() / plt.ylabel():</strong> Identifican la magnitud de los ejes horizontal y vertical.</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Título del Gráfico</label>
                                <input type="text" id="l-ti" value="Rendimiento del Proyecto" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Eje X</label>
                                    <input type="text" id="l-x" value="Tiempo (meses)" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Eje Y</label>
                                    <input type="text" id="l-y" value="Progreso (%)" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- Inline Code Block -->
                        <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 shrink-0 custom-scroll">
                            <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                meses = ['Ene', 'Feb', 'Mar']<br>
                                ventas = [10, 20, 15]<br><br>
                                plt.<span class="text-blue-600 font-bold">plot</span>(meses, ventas)<br><br>
                                <span class="text-slate-400"># Configuración de metadatos</span><br>
                                plt.<span class="text-blue-600 font-bold">title</span>('<span id="c-ti" class="text-green-600 font-bold">Ventas Mensuales</span>')<br>
                                plt.<span class="text-blue-600 font-bold">xlabel</span>('<span id="c-x" class="text-green-600 font-bold">Mes</span>')<br>
                                plt.<span class="text-blue-600 font-bold">ylabel</span>('<span id="c-y" class="text-green-600 font-bold">Monto ($)</span>')<br>
                                plt.<span class="text-blue-600 font-bold">show</span>()
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-labels"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const update = () => {
                        const t = document.getElementById('l-ti').value;
                        const x = document.getElementById('l-x').value;
                        const y = document.getElementById('l-y').value;

                        document.getElementById('c-ti') && (document.getElementById('c-ti').textContent = t);
                        document.getElementById('c-x') && (document.getElementById('c-x').textContent = x);
                        document.getElementById('c-y') && (document.getElementById('c-y').textContent = y);

                        if (chartInstance) {
                            chartInstance.options.plugins.title.text = t;
                            chartInstance.options.scales.x.title.text = x;
                            chartInstance.options.scales.y.title.text = y;
                            chartInstance.update();
                        } else {
                            initChart('chart-labels', {
                                type: 'line',
                                data: {
                                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May'],
                                    datasets: [{
                                        data: [10, 25, 45, 60, 85],
                                        borderColor: '#0055ad',
                                        backgroundColor: 'rgba(0, 85, 173, 0.1)',
                                        pointBackgroundColor: '#0055ad',
                                        tension: 0.1,
                                        fill: true
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        title: { display: true, text: t, font: { size: 16 } },
                                        legend: { display: false }
                                    },
                                    scales: {
                                        x: { display: true, title: { display: true, text: x }, grid: { color: '#f1f5f9' } },
                                        y: { display: true, title: { display: true, text: y }, grid: { color: '#f1f5f9' } }
                                    }
                                }
                            });
                        }
                    };
                    ['l-ti', 'l-x', 'l-y'].forEach(id => {
                        document.getElementById(id).addEventListener('input', update);
                    });
                    update();
                }
            },
            {
                id: 'grid-legend', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-grid" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Leyendas y Cuadrícula</h3>
                                <button id="hide-code-grid" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    meses = [1, 2, 3, 4, 5, 6]<br>
                                    ventas = [200, 350, 280, 500, 450, 600]<br>
                                    gastos = [150, 200, 220, 300, 280, 350]<br><br>
                                    plt.<span class="text-blue-600 font-bold">plot</span>(meses, ventas, color='green', marker='o', label='<span id="c-lg1" class="text-green-600 font-bold">Ventas</span>')<br>
                                    plt.<span class="text-blue-600 font-bold">plot</span>(meses, gastos, color='red', marker='o', label='<span id="c-lg2" class="text-red-600 font-bold">Gastos</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Ventas vs Gastos')<br>
                                    plt.<span class="text-blue-600 font-bold">legend</span>(show=<span id="c-show-l" class="text-purple-600 font-bold">True</span>)<br>
                                    plt.<span class="text-blue-600 font-bold">grid</span>(<span id="c-gd" class="text-purple-600 font-bold">True</span>, linestyle='--', alpha=0.5)<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Cuadrículas y Leyendas</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Visualización Avanzada:</strong> Para que un gráfico sea interpretable, necesitamos herramientas que ayuden a leer los valores con precisión y a diferenciar entre múltiples series de datos.
                            </p>
                            <ul class="space-y-2 text-xs">
                                <li><strong class="text-brand-accent">plt.grid():</strong> Dibuja líneas de guía (cuadrícula) que facilitan la proyección de los puntos sobre los ejes.</li>
                                <li><strong class="text-brand-accent">plt.legend():</strong> Muestra una caja con los nombres de las series (definidos con el parámetro <code class="bg-gray-100 px-1 rounded">label</code> en el plot).</li>
                            </ul>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                            <div class="grid grid-cols-2 gap-4">
                                <label class="flex items-center gap-2 cursor-pointer font-semibold text-xs text-slate-700">
                                    <input type="checkbox" id="chk-g" checked class="w-4 h-4 text-brand-primary rounded border-gray-300"> 
                                    Activar Cuadrícula
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer font-semibold text-xs text-slate-700">
                                    <input type="checkbox" id="chk-l" checked class="w-4 h-4 text-brand-primary rounded border-gray-300"> 
                                    Mostrar Leyenda
                                </label>
                            </div>
                            <div class="space-y-3 pt-2 border-t border-gray-200">
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Serie 1 (Verde)</label>
                                    <input type="text" id="inp-lg1" value="Ventas" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Etiqueta Serie 2 (Rojo)</label>
                                    <input type="text" id="inp-lg2" value="Gastos" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                            </div>
                        </div>

                        <button id="show-code-grid" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-gl"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-grid');
                    document.getElementById('show-code-grid').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-grid').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const g = document.getElementById('chk-g').checked;
                        const l = document.getElementById('chk-l').checked;
                        const t1 = document.getElementById('inp-lg1').value;
                        const t2 = document.getElementById('inp-lg2').value;

                        document.getElementById('c-gd') && (document.getElementById('c-gd').textContent = g ? 'True' : 'False');
                        document.getElementById('c-show-l') && (document.getElementById('c-show-l').textContent = l ? 'True' : 'False');
                        document.getElementById('c-lg1') && (document.getElementById('c-lg1').textContent = t1);
                        document.getElementById('c-lg2') && (document.getElementById('c-lg2').textContent = t2);

                        if (chartInstance) {
                            chartInstance.options.scales.x.grid.display = g;
                            chartInstance.options.scales.y.grid.display = g;
                            chartInstance.data.datasets[0].label = t1;
                            chartInstance.data.datasets[1].label = t2;
                            chartInstance.options.plugins.legend.display = l;
                            chartInstance.update();
                        } else {
                            initChart('chart-gl', {
                                type: 'line',
                                data: {
                                    labels: ['1', '2', '3', '4', '5', '6'],
                                    datasets: [
                                        {
                                            label: t1,
                                            data: [200, 350, 280, 500, 450, 600],
                                            borderColor: '#22c55e',
                                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                            pointBackgroundColor: '#15803d',
                                            pointRadius: 5,
                                            fill: false,
                                            tension: 0.1
                                        },
                                        {
                                            label: t2,
                                            data: [150, 200, 220, 300, 280, 350],
                                            borderColor: '#ef4444',
                                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                            pointBackgroundColor: '#b91c1c',
                                            pointRadius: 5,
                                            fill: false,
                                            tension: 0.1
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: l, position: 'top' },
                                        title: { display: true, text: 'Análisis Mensual: Ventas vs Gastos', font: { size: 14 } }
                                    },
                                    scales: {
                                        x: { grid: { display: g, color: '#e2e8f0' } },
                                        y: { grid: { display: g, color: '#e2e8f0' }, beginAtZero: true }
                                    }
                                }
                            });
                        }
                    };
                    ['chk-g', 'chk-l', 'inp-lg1', 'inp-lg2'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'bar-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Barras — plt.bar()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de barras representa datos mediante barras rectangulares cuya altura indica el valor. Se crea utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.bar()</code>.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Comparar cantidades entre distintas categorías o grupos de forma clara y directa.</p>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <p>Cada punto o barra del gráfico representa un par de valores:</p>
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> representa categorías o grupos (etiquetas discretas).
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene los valores numéricos asociados a cada categoría.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada barra corresponde a un par (categoría, valor).</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Comparación</h3>
                                <p>Las barras no están conectadas, ya que representan valores independientes entre sí. Esto facilita la distinción entre grupos.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos no representan categorías discretas, sino pares de valores numéricos relacionados entre sí, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-bar-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-bar-intro', {
                    type: 'bar',
                    data: {
                        labels: ['Prod A', 'Prod B', 'Prod C', 'Prod D'],
                        datasets: [{
                            data: [45, 75, 55, 90],
                            backgroundColor: '#0055ad',
                            borderRadius: 6,
                            barThickness: 40
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' }, ticks: { font: { weight: 'bold' } } },
                            x: { grid: { display: false }, ticks: { font: { weight: 'bold' } } }
                        }
                    }
                })
            },
            {
                id: 'bar', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-bar" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Gráfico de Barras</h3>
                                <button id="hide-code-bar" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    categorias = ['A', 'B', 'C']<br>
                                    valores = [10, 25, 15]<br><br>
                                    <span class="text-slate-400"># Usamos .bar() en lugar de .plot()</span><br>
                                    plt.<span class="text-blue-600 font-bold">bar</span>(categorias, valores, color='<span class="text-green-600 font-bold">#0055ad</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Comparativa de Categorías')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Gráficos de Barras (.bar)</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">¿Qué cambia?</strong> A diferencia de <code class="bg-gray-100 px-1 rounded">plt.plot()</code>, que es ideal para datos continuos (como el tiempo), <code class="bg-gray-100 px-1 rounded">plt.bar()</code> se utiliza para comparar cantidades entre <strong>categorías discretas</strong>.
                            </p>
                            <p>
                                El eje X suele contener etiquetas textuales, y la altura de cada barra representa la magnitud del valor asociado. Es la herramienta estándar para comparativas directas.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3 shrink-0">
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Categorías (separadas por coma)</label>
                                <input type="text" id="b-c" value="Manzanas, Bananas, Cerezas" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Valores (separados por coma)</label>
                                <input type="text" id="b-v" value="15, 30, 22" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                        </div>

                        <button id="show-code-bar" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-bar"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-bar');
                    document.getElementById('show-code-bar').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-bar').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const labels = document.getElementById('b-c').value.split(',').map(s => s.trim());
                        const values = document.getElementById('b-v').value.split(',').map(Number);

                        if (chartInstance) {
                            chartInstance.data.labels = labels;
                            chartInstance.data.datasets[0].data = values;
                            chartInstance.update();
                        } else {
                            initChart('chart-bar', {
                                type: 'bar',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        data: values,
                                        backgroundColor: '#0055ad',
                                        borderRadius: 6
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                                        x: { grid: { display: false } }
                                    }
                                }
                            });
                        }
                    };
                    ['b-c', 'b-v'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'barh', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-barh" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Barras Horizontales</h3>
                                <button id="hide-code-barh" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    categorias = ['A', 'B', 'C', 'D']<br>
                                    valores = [15, 30, 45, 10]<br><br>
                                    <span class="text-slate-400"># Usamos .barh() para orientación horizontal</span><br>
                                    plt.<span class="text-blue-600 font-bold">barh</span>(categorias, valores, color='<span class="text-brand-accent font-bold">#06717e</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Inversión de Ejes')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Barras Horizontales (.barh)</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Legibilidad de Categorías:</strong> El método <code class="bg-gray-100 px-1 rounded font-bold">plt.barh()</code> funciona igual que <code class="bg-gray-100 px-1 rounded">bar()</code>, pero intercambia los ejes.
                            </p>
                            <p>
                                Es especialmente útil cuando los nombres de las categorías son <strong>muy largos</strong>. Al invertir los ejes, las etiquetas se muestran verticalmente, mejorando la legibilidad y evitando solapamientos.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-3 shrink-0">
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Categorías (Eje Vertical)</label>
                                <input type="text" id="bh-c" value="Proyecto A, Proyecto B, Proyecto C, Proyecto D" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Valores (Longitud de Barra)</label>
                                <input type="text" id="bh-v" value="45, 72, 38, 55" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                            </div>
                        </div>

                        <button id="show-code-barh" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-barh"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-barh');
                    document.getElementById('show-code-barh').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-barh').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const labels = document.getElementById('bh-c').value.split(',').map(s => s.trim());
                        const values = document.getElementById('bh-v').value.split(',').map(Number);

                        if (chartInstance) {
                            chartInstance.data.labels = labels;
                            chartInstance.data.datasets[0].data = values;
                            chartInstance.update();
                        } else {
                            initChart('chart-barh', {
                                type: 'bar',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        data: values,
                                        backgroundColor: '#06717e',
                                        borderRadius: 4
                                    }]
                                },
                                options: {
                                    indexAxis: 'y',
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        x: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                                        y: { grid: { display: false } }
                                    }
                                }
                            });
                        }
                    };
                    ['bh-c', 'bh-v'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'scatter-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Dispersión con plt.scatter()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de dispersión se crea en Matplotlib utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.scatter()</code>. Representa datos como puntos individuales en el plano cartesiano, sin unirlos.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Mostrar cómo se relacionan dos variables numéricas y detectar patrones entre ellas.</p>
                                <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Por ejemplo:</p>
                                <ul class="list-disc list-inside space-y-1 text-slate-700 ml-2">
                                    <li>Horas de estudio y nota obtenida.</li>
                                    <li>Edad y salario.</li>
                                </ul>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> contiene una variable numérica.
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene otra variable numérica asociada.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada punto representa una observación completa (un caso con ambos valores).</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Interpretación</h3>
                                <p>La distribución de los puntos permite observar si existe relación: si tienden a subir juntos, bajar o no mostrar un patrón claro.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos representan una evolución continua o una comparación de categorías, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-scatter-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-scatter-intro', {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            data: Array.from({ length: 40 }, () => ({
                                x: Math.random() * 10,
                                y: Math.random() * 10
                            })),
                            backgroundColor: '#0055ad',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                            x: { beginAtZero: true, grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'scatter', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-scatter" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Gráfico de Dispersión</h3>
                                <button id="hide-code-scatter" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    x = [1, 2, 3, 4, 5]<br>
                                    y = [5, 4, 6, 2, 7]<br>
                                    tamanos = [<span id="c-s-val" class="text-purple-600 font-bold">50</span>] * 5<br><br>
                                    plt.<span class="text-blue-600 font-bold">scatter</span>(x, y, s=tamanos, color='<span class="text-orange-600 font-bold">#ff5722</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Análisis de Correlación')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Gráficos de Dispersión (.scatter)</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Análisis de Distribución:</strong> El gráfico de dispersión (scatter plot) se utiliza para observar la relación entre dos variables numéricas. A diferencia de las líneas, aquí cada punto es independiente.
                            </p>
                            <p>
                                Es ideal para identificar <strong>correlaciones</strong>, tendencias o agrupaciones (clusters) en conjuntos de datos complejos. El parámetro <code class="bg-gray-100 px-1 rounded">s</code> permite variar el tamaño de los puntos según una tercera dimensión.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Tamaño de los puntos (parámetro s)</label>
                                <input type="range" id="s-s" min="10" max="1000" value="200" class="w-full">
                                <div class="text-[10px] text-right text-slate-400 font-mono">valor: <span id="v-s-val">200</span></div>
                            </div>
                            <div class="grid grid-cols-1 gap-3">
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Puntos X (Eje Horizontal)</label>
                                    <input type="text" id="s-x" value="1, 2.5, 3, 4.2, 5.5, 6.1" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Puntos Y (Eje Vertical)</label>
                                    <input type="text" id="s-y" value="2, 4.5, 3.8, 6.1, 5.2, 7.8" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none">
                                </div>
                            </div>
                        </div>

                        <button id="show-code-scatter" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-sc"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-scatter');
                    document.getElementById('show-code-scatter').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-scatter').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const xs = document.getElementById('s-x').value.split(',').map(Number);
                        const ys = document.getElementById('s-y').value.split(',').map(Number);
                        const s = document.getElementById('s-s').value;
                        const data = xs.map((v, i) => ({ x: v, y: ys[i] || 0 }));

                        document.getElementById('v-s-val').textContent = s;
                        document.getElementById('c-s-val') && (document.getElementById('c-s-val').textContent = s);

                        if (chartInstance) {
                            chartInstance.data.datasets[0].data = data;
                            chartInstance.data.datasets[0].pointRadius = Math.sqrt(s);
                            chartInstance.update();
                        } else {
                            initChart('chart-sc', {
                                type: 'scatter',
                                data: {
                                    datasets: [{
                                        data: data,
                                        backgroundColor: '#ff5722',
                                        pointRadius: Math.sqrt(s),
                                        pointHoverRadius: Math.sqrt(s) + 2
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        x: { type: 'linear', position: 'bottom', grid: { color: '#f1f5f9' } },
                                        y: { grid: { color: '#f1f5f9' } }
                                    }
                                }
                            });
                        }
                    };
                    ['s-x', 's-y', 's-s'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'area-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico de Área con plt.fill_between()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico de área se crea en Matplotlib utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.fill_between()</code>. Representa datos rellenando el espacio entre una línea y el eje X (u otra línea).
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Destacar visualmente la magnitud o acumulación de valores a lo largo de una secuencia.</p>
                                <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Por ejemplo:</p>
                                <ul class="list-disc list-inside space-y-1 text-slate-700 ml-2">
                                    <li>Consumo eléctrico diario.</li>
                                    <li>Ventas acumuladas en el mes.</li>
                                    <li>Cantidad de usuarios activos en el tiempo.</li>
                                </ul>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> define el orden o referencia (tiempo o secuencia).
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene los valores numéricos asociados.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">El área sombreada representa visualmente la cantidad comprendida entre los valores.</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Interpretación</h3>
                                <p>El relleno enfatiza cuánto representan los valores en conjunto, no solo los puntos individuales.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si solo se necesita observar puntos específicos o comparar categorías sin resaltar volumen o acumulación, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-area-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-area-intro', {
                    type: 'line',
                    data: {
                        labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
                        datasets: [{
                            data: [30, 45, 35, 60, 55, 80, 70],
                            borderColor: '#0055ad',
                            backgroundColor: 'rgba(0, 85, 173, 0.25)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                            x: { grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'area', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-area" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Gráficos de Área</h3>
                                <button id="hide-code-area" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    x = [0, 1, 2, 3, 4]<br>
                                    y = [1, 3, 2, 5, 4]<br><br>
                                    plt.<span class="text-blue-600 font-bold">plot</span>(x, y, color='<span id="c-ac-line" class="text-blue-600 font-bold">#0f6cbf</span>')<br>
                                    plt.<span class="text-blue-600 font-bold">fill_between</span>(x, y, color='<span id="c-ac" class="text-blue-600 font-bold">#0f6cbf</span>', alpha=<span id="c-ac-alpha" class="text-purple-600 font-bold">0.3</span>)<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Visualización de Área')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Área y Relleno (.fill_between)</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Énfasis en Volumen:</strong> El gráfico de área utiliza el método <code class="bg-gray-100 px-1 rounded">plt.fill_between()</code> para rellenar el espacio entre una línea y el eje (u otra línea).
                            </p>
                            <p>
                                Esta técnica es útil para resaltar la <strong>magnitud acumulada</strong> o para representar rangos de incertidumbre (desviación estándar) alrededor de una tendencia central. El parámetro <code class="bg-gray-100 px-1 rounded">alpha</code> es clave para controlar la transparencia.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Transparencia (alpha)</label>
                                <input type="range" id="a-al" min="0.1" max="1" step="0.1" value="0.3" class="w-full">
                                <div class="text-[10px] text-right text-slate-400 font-mono">valor: <span id="v-a">0.3</span></div>
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Color de Relleno</label>
                                <input type="color" id="a-c" value="#0f6cbf" class="w-full h-10 cursor-pointer rounded-lg border-2 border-white shadow-sm">
                            </div>
                        </div>

                        <button id="show-code-area" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-ar"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-area');
                    document.getElementById('show-code-area').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-area').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const a = document.getElementById('a-al').value;
                        const c = document.getElementById('a-c').value;

                        document.getElementById('v-a').textContent = a;
                        document.getElementById('c-ac') && (document.getElementById('c-ac').textContent = c);
                        document.getElementById('c-ac-line') && (document.getElementById('c-ac-line').textContent = c);
                        document.getElementById('c-ac-alpha') && (document.getElementById('c-ac-alpha').textContent = a);

                        const rgba = `rgba(${parseInt(c.slice(1, 3), 16)}, ${parseInt(c.slice(3, 5), 16)}, ${parseInt(c.slice(5, 7), 16)}, ${a})`;

                        if (chartInstance) {
                            chartInstance.data.datasets[0].backgroundColor = rgba;
                            chartInstance.data.datasets[0].borderColor = c;
                            chartInstance.update();
                        } else {
                            initChart('chart-ar', {
                                type: 'line',
                                data: {
                                    labels: ['0', '1', '2', '3', '4', '5'],
                                    datasets: [{
                                        data: [1, 3, 2, 5, 4, 6],
                                        borderColor: c,
                                        backgroundColor: rgba,
                                        fill: true,
                                        tension: 0.4,
                                        pointRadius: 4,
                                        pointBackgroundColor: c
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        x: { grid: { color: '#f1f5f9' } },
                                        y: { beginAtZero: true, grid: { color: '#f1f5f9' } }
                                    }
                                }
                            });
                        }
                    };
                    ['a-al', 'a-c'].forEach(id => document.getElementById(id).addEventListener('input', update));
                    update();
                }
            },
            {
                id: 'step-concept', render: () => `
                <div class="flex flex-col md:flex-row h-full gap-8 overflow-hidden">
                    <!-- Left Column: Detailed Text (Scrollable) -->
                    <div class="md:w-1/2 space-y-6 flex flex-col pr-2 overflow-y-auto custom-scroll text-text-deep">
                        <h2 class="text-3xl font-bold text-brand-primary">Gráfico Escalonado con plt.step()</h2>
                        
                        <div class="space-y-4 text-sm leading-relaxed">
                            <p class="text-base">
                                Un gráfico escalonado se crea en Matplotlib utilizando la función <code class="bg-gray-100 px-1 rounded font-bold">plt.step()</code>. Representa datos mediante líneas horizontales y verticales que forman “escalones”.
                            </p>

                            <div class="space-y-3">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Uso principal</h3>
                                <p>Mostrar cambios que ocurren por intervalos o en momentos específicos, donde el valor se mantiene constante hasta el siguiente cambio.</p>
                                <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Por ejemplo:</p>
                                <ul class="list-disc list-inside space-y-1 text-slate-700 ml-2">
                                    <li>Tarifas que cambian por tramo de consumo.</li>
                                    <li>Estados de un sistema (activo/inactivo).</li>
                                </ul>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Relación X–Y</h3>
                                <div class="space-y-2">
                                    <ul class="list-none space-y-2">
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje X:</span> define el orden o momento del cambio.
                                        </li>
                                        <li class="bg-white p-3 rounded-lg border border-border-light shadow-sm">
                                            <span class="text-brand-accent font-bold">Eje Y:</span> contiene el valor que se mantiene hasta el siguiente punto.
                                        </li>
                                    </ul>
                                    <p class="text-xs italic text-slate-500 text-center">Cada escalón representa un valor constante durante un intervalo.</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-brand-primary border-b border-border-light pb-1">Interpretación</h3>
                                <p>El gráfico no muestra transición gradual, sino cambios abruptos entre niveles.</p>
                                <div class="p-3 bg-red-50 border-l-4 border-red-400 text-red-800 text-xs italic">
                                    Nota: Si los datos cambian de manera continua y progresiva, quizá otro tipo de gráfico sea más adecuado.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-1/2 bg-surface-muted rounded-xl p-8 flex flex-col items-center justify-center relative min-h-[400px]">
                        <div class="w-full h-full relative">
                            <canvas id="chart-step-intro"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => initChart('chart-step-intro', {
                    type: 'line',
                    data: {
                        labels: ['0', '1', '2', '3', '4', '5', '6'],
                        datasets: [{
                            data: [10, 15, 10, 20, 20, 25, 25],
                            borderColor: '#0055ad',
                            backgroundColor: 'transparent',
                            stepped: true,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#0055ad'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#e2e8f0' } },
                            x: { grid: { color: '#e2e8f0' } }
                        }
                    }
                })
            },
            {
                id: 'step', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-step" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Gráficos de Escalera</h3>
                                <button id="hide-code-step" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg overflow-x-auto border shadow-inner bg-slate-50 font-mono text-[11px] p-4 flex-grow custom-scroll">
                                <div class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>
                                    x = [1, 2, 3, 4, 5]<br>
                                    y = [10, 15, 10, 20, 25]<br><br>
                                    <span class="text-slate-400"># Gráfico escalonado</span><br>
                                    plt.<span class="text-blue-600 font-bold">step</span>(x, y, where='<span id="c-w" class="text-green-600 font-bold">mid</span>')<br><br>
                                    plt.<span class="text-blue-600 font-bold">title</span>('Cambios Discretos')<br>
                                    plt.<span class="text-blue-600 font-bold">show</span>()
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Gráficos de Escalera (.step)</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Datos Discretos:</strong> Mientras que <code class="bg-gray-100 px-1 rounded">plt.plot()</code> interpola valores suavemente entre puntos, <code class="bg-gray-100 px-1 rounded">plt.step()</code> mantiene el valor constante hasta el siguiente punto.
                            </p>
                            <p>
                                Es fundamental para visualizar procesos que cambian en momentos específicos (como stocks de inventario o estados de una máquina) en lugar de cambios graduales. El parámetro <code class="bg-gray-100 px-1 rounded">where</code> define dónde ocurre el salto.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Punto de transición (where)</label>
                                <select id="st-w" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none bg-white">
                                    <option value="mid">En medio (mid)</option>
                                    <option value="before">Antes del punto (pre)</option>
                                    <option value="after">Después del punto (post)</option>
                                </select>
                            </div>
                        </div>

                        <button id="show-code-step" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[350px] md:h-auto relative">
                        <div class="w-full h-full relative">
                            <canvas id="chart-st"></canvas>
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-step');
                    document.getElementById('show-code-step').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-step').addEventListener('click', () => overlay.classList.add('hidden'));

                    const update = () => {
                        const w = document.getElementById('st-w').value;
                        const cjsW = w === 'before' ? 'before' : (w === 'after' ? 'after' : 'middle');
                        document.getElementById('c-w') && (document.getElementById('c-w').textContent = w);

                        if (chartInstance) {
                            chartInstance.data.datasets[0].stepped = cjsW;
                            chartInstance.update();
                        } else {
                            initChart('chart-st', {
                                type: 'line',
                                data: {
                                    labels: ['T1', 'T2', 'T3', 'T4', 'T5'],
                                    datasets: [{
                                        data: [10, 15, 12, 22, 20],
                                        borderColor: '#6ea2ee',
                                        backgroundColor: 'rgba(110, 162, 238, 0.1)',
                                        stepped: cjsW,
                                        pointRadius: 6,
                                        pointBackgroundColor: '#003c58',
                                        fill: false
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: {
                                        y: { beginAtZero: true, grid: { color: '#f1f5f9' } },
                                        x: { grid: { display: false } }
                                    }
                                }
                            });
                        }
                    };
                    document.getElementById('st-w').addEventListener('change', update);
                    update();
                }
            },
            {
                id: 'subplots', render: () => `
                <div class="flex flex-col md:flex-row gap-6 h-full min-h-0 bg-white rounded-2xl p-2 md:px-6 md:pb-6 md:pt-4 overflow-hidden">
                    <!-- Left Column: Explanation and Controls -->
                    <div class="flex-1 md:w-2/5 space-y-4 overflow-y-auto pr-2 custom-scroll flex flex-col min-h-0 relative">
                        <!-- Code Overlay -->
                        <div id="code-overlay-subplots" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-4">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 class="font-bold text-brand-primary">Código: Subplots Dinámicos</h3>
                                <button id="hide-code-subplots" class="text-xs px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-md font-semibold text-slate-600 transition-colors">Volver &larr;</button>
                            </div>
                            <div class="rounded-lg border shadow-inner bg-slate-50 font-mono text-[10px] p-4 flex-grow overflow-y-auto custom-scroll">
                                <div id="dynamic-code-subplots" class="leading-relaxed text-slate-700 whitespace-nowrap">
                                    <!-- Dynamic Code Generated Here -->
                                </div>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-brand-primary shrink-0">Laboratorio de Subplots</h2>
                        
                        <div class="space-y-4 text-sm text-text-deep leading-relaxed shrink-0">
                            <p>
                                <strong class="text-brand-primary">Control Total:</strong> La función <code class="bg-gray-100 px-1 rounded">plt.subplots(rows, cols)</code> permite crear grillas complejas. El parámetro <code class="bg-gray-100 px-1 rounded font-bold">figsize=(ancho, alto)</code> define el tamaño total del lienzo en pulgadas.
                            </p>
                        </div>

                        <div class="bg-surface-muted p-4 rounded-lg border border-border-light space-y-4 shrink-0">
                             <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider block mb-1">Filas (rows)</label>
                                    <select id="sp-rows" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none bg-white">
                                        <option value="1">1 Fila</option>
                                        <option value="2">2 Filas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider block mb-1">Columnas (cols)</label>
                                    <select id="sp-cols" class="w-full border rounded text-xs p-2 focus:ring-2 focus:ring-brand-primary/20 outline-none bg-white">
                                        <option value="1">1 Columna</option>
                                        <option value="2" selected>2 Columnas</option>
                                        <option value="3">3 Columnas</option>
                                    </select>
                                </div>
                             </div>
                             
                             <div id="axes-controls" class="space-y-2 pt-2 border-t border-slate-200">
                                <!-- Per-axis type selectors here -->
                             </div>
                        </div>

                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 text-[11px] text-blue-800 shrink-0">
                            <strong>Dato:</strong> Si tienes una sola fila, usas <code class="bg-white/50 px-1 rounded">axes[i]</code>. Si tienes varias, usas <code class="bg-white/50 px-1 rounded">axes[fila, col]</code>.
                        </div>

                        <button id="show-code-subplots" class="mt-auto shrink-0 w-full py-3 bg-brand-primary text-white rounded-lg font-bold hover:bg-brand-primary/90 shadow-sm flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            Ver Código Python
                        </button>
                    </div>
                    
                    <!-- Right Column: Visualization -->
                    <div class="md:w-3/5 bg-surface-muted rounded-xl p-4 flex flex-col justify-center min-h-[300px] h-[450px] md:h-auto overflow-hidden">
                        <div id="subplots-container" class="grid gap-4 w-full h-full relative p-2">
                            <!-- Dynamic Canvas Grid Here -->
                        </div>
                    </div>
                </div>`,
                script: () => {
                    const overlay = document.getElementById('code-overlay-subplots');
                    document.getElementById('show-code-subplots').addEventListener('click', () => overlay.classList.remove('hidden'));
                    document.getElementById('hide-code-subplots').addEventListener('click', () => overlay.classList.add('hidden'));

                    const rowsSel = document.getElementById('sp-rows');
                    const colsSel = document.getElementById('sp-cols');
                    const container = document.getElementById('subplots-container');
                    const controls = document.getElementById('axes-controls');
                    const codeDisplay = document.getElementById('dynamic-code-subplots');

                    const colors = ['#0055ad', '#06717e', '#ff5722', '#6b21a8', '#059669', '#dc2626'];
                    const getChartData = (type, idx) => {
                        const variety = idx % 4;
                        const color = colors[idx % colors.length];
                        const alphaColor = color + '22'; // 13% opacity hex

                        if (type === 'line') {
                            const dataVarieties = [
                                [10, 25, 15, 30, 20],
                                [30, 10, 25, 5, 15],
                                [5, 15, 5, 20, 10],
                                [20, 25, 30, 25, 20]
                            ];
                            return {
                                type: 'line',
                                data: { labels: ['T1', 'T2', 'T3', 'T4', 'T5'], datasets: [{ data: dataVarieties[variety], borderColor: color, backgroundColor: alphaColor, tension: 0.3, fill: false, pointRadius: 4 }] }
                            };
                        }
                        if (type === 'bar') {
                            const dataVarieties = [
                                [15, 30, 20, 25],
                                [35, 15, 25, 10],
                                [10, 10, 40, 30],
                                [25, 35, 15, 20]
                            ];
                            return {
                                type: 'bar',
                                data: { labels: ['A', 'B', 'C', 'D'], datasets: [{ data: dataVarieties[variety], backgroundColor: color, borderRadius: 4 }] }
                            };
                        }
                        if (type === 'scatter') {
                            const dataVarieties = [
                                [{ x: 1, y: 10 }, { x: 2, y: 22 }, { x: 3, y: 15 }, { x: 4, y: 28 }],
                                [{ x: 1, y: 30 }, { x: 2, y: 12 }, { x: 3, y: 25 }, { x: 4, y: 8 }],
                                [{ x: 1, y: 5 }, { x: 2, y: 8 }, { x: 3, y: 6 }, { x: 4, y: 12 }],
                                [{ x: 1, y: 15 }, { x: 2, y: 15 }, { x: 3, y: 15 }, { x: 4, y: 15 }]
                            ];
                            return {
                                type: 'scatter',
                                data: { datasets: [{ data: dataVarieties[variety], backgroundColor: color, pointRadius: 6 }] },
                                options: { scales: { x: { type: 'linear', position: 'bottom' } } }
                            };
                        }
                    };

                    const update = () => {
                        const R = parseInt(rowsSel.value);
                        const C = parseInt(colsSel.value);
                        const total = R * C;

                        // Save current types
                        const currentTypes = Array.from(controls.querySelectorAll('select')).map(s => s.value);

                        // Rebuild Visualization Grid
                        container.className = `grid gap-3 w-full h-full relative p-2`;
                        container.style.gridTemplateRows = `repeat(${R}, minmax(0, 1fr))`;
                        container.style.gridTemplateColumns = `repeat(${C}, minmax(0, 1fr))`;

                        container.innerHTML = '';
                        controls.innerHTML = '';
                        subChartInstances.forEach(c => c.destroy());
                        subChartInstances = [];

                        let pythonCode = `<span class="text-pink-600 font-bold">import</span> matplotlib.pyplot <span class="text-pink-600 font-bold">as</span> plt<br><br>`;
                        pythonCode += `<span class="text-slate-400"># Definimos la estructura ${R}x${C} y tamaño de figura</span><br>`;
                        pythonCode += `fig, axes = plt.<span class="text-blue-600 font-bold">subplots</span>(${R}, ${C}, figsize=(${C * 5}, ${R * 4}))<br><br>`;

                        for (let i = 0; i < total; i++) {
                            const type = currentTypes[i] || (i % 3 === 0 ? 'line' : (i % 3 === 1 ? 'bar' : 'scatter'));

                            // Add Controls
                            const div = document.createElement('div');
                            div.className = "flex items-center gap-2";
                            div.innerHTML = `<label class="text-[9px] font-bold text-slate-400 w-12 shrink-0 italic">AX[${i}]</label>
                                             <select class="axis-type flex-grow border rounded text-[10px] p-1 bg-white outline-none">
                                                <option value="line" ${type === 'line' ? 'selected' : ''}>Línea (.plot)</option>
                                                <option value="bar" ${type === 'bar' ? 'selected' : ''}>Barras (.bar)</option>
                                                <option value="scatter" ${type === 'scatter' ? 'selected' : ''}>Dispersión (.scatter)</option>
                                             </select>`;
                            controls.appendChild(div);

                            // Add Canvas
                            const canvasDiv = document.createElement('div');
                            canvasDiv.className = "bg-white rounded border border-slate-200 relative p-1 h-full flex flex-col min-h-0";
                            canvasDiv.innerHTML = `<div class="absolute top-0.5 right-1.5 text-[8px] font-mono text-slate-300 font-bold">axes[${i}]</div>
                                                   <canvas id="c-dynamic-${i}" class="flex-grow"></canvas>`;
                            container.appendChild(canvasDiv);

                            // Python Code Generation
                            const axisIndex = total === 1 ? 'axes' : (R === 1 || C === 1 ? `axes[${i}]` : `axes[${Math.floor(i / C)}, ${i % C}]`);
                            const method = type === 'line' ? 'plot' : (type === 'bar' ? 'bar' : 'scatter');
                            const colorName = colors[i % colors.length];

                            pythonCode += `<span class="text-slate-400"># Gráfico ${i + 1}</span><br>`;
                            pythonCode += `${axisIndex}.<span class="text-blue-600 font-bold">${method}</span>(datos, color='${colorName}')<br>`;
                            pythonCode += `${axisIndex}.set_title('Subplot ${i + 1}')<br><br>`;
                        }

                        pythonCode += `plt.<span class="text-blue-600 font-bold">tight_layout</span>()<br>`;
                        pythonCode += `plt.<span class="text-blue-600 font-bold">show</span>()`;
                        codeDisplay.innerHTML = pythonCode;

                        // Add Listeners to new axis selects
                        controls.querySelectorAll('.axis-type').forEach(s => s.addEventListener('change', update));

                        // Wait for DOM then Init Charts
                        setTimeout(() => {
                            const axisSelects = controls.querySelectorAll('.axis-type');
                            for (let i = 0; i < total; i++) {
                                const type = axisSelects[i].value;
                                const config = getChartData(type, i);
                                config.options = {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } },
                                    scales: config.options?.scales || {
                                        y: { beginAtZero: true, ticks: { display: false }, grid: { display: false } },
                                        x: { ticks: { display: false }, grid: { display: false } }
                                    }
                                };
                                const canvas = document.getElementById(`c-dynamic-${i}`);
                                if (canvas) subChartInstances.push(new Chart(canvas, config));
                            }
                        }, 60);
                    };

                    rowsSel.addEventListener('change', update);
                    colsSel.addEventListener('change', update);
                    update();
                }
            },
            {
                id: 'end', render: () => `
                <div class="flex flex-col items-center justify-center h-full text-center space-y-6">
                    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-4xl mb-4">✓</div>
                    <h1 class="text-4xl font-bold text-brand-primary">¡Módulo Completado!</h1>
                    <button onclick="goToSlide(0)" class="mt-8 px-8 py-3 bg-action-default text-white rounded-lg hover:bg-action-hover shadow-lg font-bold">Volver al Inicio</button>
                </div>`
            }
        ];

        function renderSlide(idx) {
            if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
            subChartInstances.forEach(c => c.destroy()); subChartInstances = [];
            const d = slides[idx];
            document.getElementById('slide-container').innerHTML = d.render();
            if (d.script) setTimeout(d.script, 0);
            document.getElementById('slide-counter').textContent = `Diapositiva ${idx + 1} de ${slides.length}`;
            document.getElementById('prev-btn').disabled = idx === 0;
            document.getElementById('next-btn').disabled = idx === slides.length - 1;
        }

        window.nextSlide = () => { if (currentSlide < slides.length - 1) renderSlide(++currentSlide); };
        window.prevSlide = () => { if (currentSlide > 0) renderSlide(--currentSlide); };
        window.goToSlide = (idx) => { currentSlide = idx; renderSlide(idx); };
        document.getElementById('next-btn').addEventListener('click', window.nextSlide);
        document.getElementById('prev-btn').addEventListener('click', window.prevSlide);
        document.addEventListener('keydown', e => { if (e.key === 'ArrowRight') window.nextSlide(); if (e.key === 'ArrowLeft') window.prevSlide(); });

        // Global Chart Init Helper
        function initChart(canvasId, config) {
            const el = document.getElementById(canvasId);
            if (!el) return;
            const ctx = el.getContext('2d');
            chartInstance = new Chart(ctx, config);
        }

        // Init
        renderSlide(0);
    </script>
</body>

</html>